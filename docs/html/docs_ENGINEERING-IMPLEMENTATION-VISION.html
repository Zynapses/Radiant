<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ENGINEERING IMPLEMENTATION VISION - RADIANT Documentation</title>
  
<style>
@media print {
  body { font-size: 11pt !important; }
  pre { page-break-inside: avoid; }
  h1, h2, h3 { page-break-after: avoid; }
  .no-print { display: none !important; }
}

* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.7;
  color: #1d1d1f;
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 30px;
  background: white;
}

h1 {
  color: #1d1d1f;
  border-bottom: 3px solid #0071e3;
  padding-bottom: 12px;
  font-size: 28px;
  margin-top: 0;
}

h2 {
  color: #1d1d1f;
  border-bottom: 1px solid #d2d2d7;
  padding-bottom: 8px;
  font-size: 22px;
  margin-top: 40px;
}

h3 { color: #1d1d1f; font-size: 18px; margin-top: 30px; }
h4 { color: #1d1d1f; font-size: 16px; margin-top: 25px; }

a { color: #0071e3; text-decoration: none; }
a:hover { text-decoration: underline; }

code {
  background: #f5f5f7;
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
  font-size: 0.9em;
  color: #1d1d1f;
}

pre {
  background: #1d1d1f;
  color: #f5f5f7;
  padding: 20px;
  border-radius: 10px;
  overflow-x: auto;
  font-size: 13px;
  line-height: 1.5;
}

pre code {
  background: transparent;
  padding: 0;
  color: inherit;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 14px;
}

th, td {
  border: 1px solid #d2d2d7;
  padding: 12px 15px;
  text-align: left;
}

th {
  background: #0071e3;
  color: white;
  font-weight: 600;
}

tr:nth-child(even) { background: #f5f5f7; }

blockquote {
  border-left: 4px solid #0071e3;
  margin: 20px 0;
  padding: 15px 25px;
  background: #f5f5f7;
  border-radius: 0 8px 8px 0;
}

blockquote p { margin: 0; }

img { max-width: 100%; height: auto; border-radius: 8px; }

hr {
  border: none;
  border-top: 1px solid #d2d2d7;
  margin: 40px 0;
}

ul, ol { padding-left: 25px; }
li { margin: 8px 0; }

.header-bar {
  background: linear-gradient(135deg, #0071e3 0%, #00c6ff 100%);
  color: white;
  padding: 20px 30px;
  margin: -40px -30px 30px -30px;
  border-radius: 0 0 16px 16px;
}

.header-bar h1 {
  color: white;
  border: none;
  margin: 0;
  padding: 0;
}

.header-bar .meta {
  font-size: 13px;
  opacity: 0.9;
  margin-top: 8px;
}

.print-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #0071e3;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0,113,227,0.3);
}

.print-btn:hover { background: #0077ed; }

.mermaid {
  background: #f5f5f7;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  margin: 20px 0;
}

.footer {
  margin-top: 60px;
  padding-top: 20px;
  border-top: 1px solid #d2d2d7;
  color: #86868b;
  font-size: 12px;
  text-align: center;
}
</style>

</head>
<body>
  <button class="print-btn no-print" onclick="window.print()">ğŸ–¨ï¸ Print / Save as PDF</button>
  
  <div class="header-bar">
    <h1>ENGINEERING IMPLEMENTATION VISION</h1>
    <div class="meta">RADIANT v5.52.29 | docs/ENGINEERING-IMPLEMENTATION-VISION.md</div>
  </div>
  
  <h1 id="radiant-engineering-implementation-vision">RADIANT Engineering Implementation &amp; Vision</h1>
<p><strong>Version</strong>: 5.52.29<br />
<strong>Last Updated</strong>: 2026-01-25<br />
<strong>Classification</strong>: Internal Engineering Reference</p>
<blockquote>
<p><strong>POLICY</strong>: All technical architecture, implementation details, and visionary documentation MUST be consolidated in this document. Engineers require comprehensive detailâ€”never abbreviate or summarize to the point of losing implementation specifics. See <code>/.windsurf/workflows/documentation-consolidation.md</code> for enforcement.</p>
</blockquote>
<hr />
<h2 id="table-of-contents">Table of Contents</h2>
<ol type="1">
<li><a href="#1-cato-persistent-memory-system">Cato Persistent Memory System</a></li>
<li><a href="#2-aws-infrastructure">AWS Infrastructure</a></li>
<li><a href="#3-database-architecture">Database Architecture</a></li>
<li><a href="#4-ai-model-orchestration">AI Model Orchestration</a></li>
<li><a href="#5-lambda-services">Lambda Services</a></li>
<li><a href="#6-cdk-stack-architecture">CDK Stack Architecture</a></li>
<li><a href="#7-security--compliance">Security &amp; Compliance</a></li>
<li><a href="#8-libraries--dependencies">Libraries &amp; Dependencies</a></li>
<li><a href="#9-ai-report-writer-pro-v5420">AI Report Writer Pro</a></li>
<li><a href="#10-decision-intelligence-artifacts-dia-engine-v5430">Decision Intelligence Artifacts (DIA Engine)</a></li>
<li><a href="#11-living-parchment-2029-vision-v5440">Living Parchment 2029 Vision</a></li>
<li><a href="#12-cortex-memory-system-v4200">Cortex Memory System</a></li>
<li><a href="#13-apple-glass-ui-design-system-v5522">Apple Glass UI Design System</a></li>
<li><a href="#14-semantic-blackboard-architecture-v5524">Semantic Blackboard Architecture</a></li>
<li><a href="#15-services-layer--interface-based-access-control-v5525">Services Layer &amp; Interface-Based Access Control</a></li>
<li><a href="#16-complete-admin-api-architecture-v5526">Complete Admin API Architecture</a></li>
<li><a href="#17-liquid-interface---morphable-ui-system-v5528">Liquid Interface - Morphable UI System</a></li>
<li><a href="#18-oauth-20-provider--developer-portal-v55226">OAuth 2.0 Provider &amp; Developer Portal</a></li>
<li><a href="#19-two-factor-authentication-mfa-v55228">Two-Factor Authentication (MFA)</a></li>
<li><a href="#20-internationalization--multi-language-search-v55229">Internationalization &amp; Multi-Language Search</a></li>
</ol>
<hr />
<h2 id="cato-persistent-memory-system">1. Cato Persistent Memory System</h2>
<h3 id="overview">1.1 Overview</h3>
<p>Cato operates as the cognitive core of RADIANTâ€™s orchestration architecture, implementing a <strong>three-tier hierarchical memory system</strong> that fundamentally differentiates it from competitors suffering from session amnesia. Unlike ChatGPT or Claude standaloneâ€”where closing a tab erases all contextâ€”Cato maintains persistent memory that survives sessions, employee turnover, and time.</p>
<h3 id="tenant-level-memory-institutional-intelligence">1.2 Tenant-Level Memory (Institutional Intelligence)</h3>
<p>The primary layer where the most valuable learning accumulates. Every Cato database table enforces <strong>Row-Level Security via <code>tenant_id</code></strong>, ensuring complete isolation between organizations while enabling deep institutional pattern recognition.</p>
<h4 id="neural-network-routing">Neural Network Routing</h4>
<p>At this level, a proprietary neural network continuously learns which AI models perform best for specific query types:</p>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 39%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Query Type</th>
<th>Optimal Model</th>
<th>Rationale</th>
</tr>
</thead>
<tbody>
<tr>
<td>Legal analysis</td>
<td>Claude Opus</td>
<td>Doesnâ€™t hallucinate physics, citation accuracy</td>
</tr>
<tr>
<td>Visual reasoning</td>
<td>Gemini</td>
<td>Superior multimodal capabilities</td>
</tr>
<tr>
<td>Red-team validation</td>
<td>Specialized safety models</td>
<td>Adversarial robustness</td>
</tr>
<tr>
<td>Code generation</td>
<td>Claude Sonnet / GPT-4</td>
<td>Structured output quality</td>
</tr>
</tbody>
</table>
<h4 id="department-specific-preferences">Department-Specific Preferences</h4>
<p>The system tracks department-specific preferences learned over time:</p>
<ul>
<li><strong>Legal teams</strong>: Aggressive, citation-heavy briefs with formal language</li>
<li><strong>Marketing departments</strong>: Conversational copy with brand voice alignment</li>
<li><strong>Engineering teams</strong>: Technical precision with code examples</li>
<li><strong>Executive communications</strong>: Concise summaries with strategic framing</li>
</ul>
<h4 id="cost-optimization-patterns">Cost Optimization Patterns</h4>
<p>Cost optimization patterns emerge automaticallyâ€”when Cato notices a $0.50 query could have been handled by a $0.01 approach, it adjusts routing for similar future queries without manual configuration.</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/economic-governor.service.ts</code></p>
<pre class="typescript"><code>interface CostOptimizationPattern {
  querySignature: string;      // Hash of query characteristics
  originalCost: number;        // Cost of initial expensive route
  optimizedCost: number;       // Cost of discovered cheaper route
  qualityDelta: number;        // Quality difference (-1 to 1)
  confidenceScore: number;     // How confident the optimization is
  applicationCount: number;    // Times this optimization applied
}</code></pre>
<h4 id="tenant-configuration">Tenant Configuration</h4>
<p>Tenant configuration (<code>cato_tenant_config</code>) stores:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>gamma_limits</code></td>
<td>JSONB</td>
<td>Epistemic uncertainty thresholds</td>
</tr>
<tr>
<td><code>entropy_thresholds</code></td>
<td>JSONB</td>
<td>When to trigger Epistemic Recovery</td>
</tr>
<tr>
<td><code>recovery_settings</code></td>
<td>JSONB</td>
<td>Scout mode parameters</td>
</tr>
<tr>
<td><code>feature_flags</code></td>
<td>JSONB</td>
<td>Enabled/disabled capabilities</td>
</tr>
<tr>
<td><code>compliance_mode</code></td>
<td>ENUM</td>
<td>FDA, HIPAA, SOC2, etc.</td>
</tr>
</tbody>
</table>
<h4 id="merkle-hashed-audit-trails">Merkle-Hashed Audit Trails</h4>
<p>Compliance records maintain <strong>7-year retention</strong> via Merkle-hashed audit trails for:</p>
<ul>
<li><strong>FDA 21 CFR Part 11</strong>: Electronic records and signatures</li>
<li><strong>HIPAA</strong>: Protected health information handling</li>
<li><strong>SOC 2 Type II</strong>: Security, availability, processing integrity</li>
</ul>
<p><strong>Implementation</strong>: <code>lambda/admin/cato.ts</code>, <code>migrations/045_cato_audit_merkle.sql</code></p>
<h3 id="user-level-memory-relationship-continuity">1.3 User-Level Memory (Relationship Continuity)</h3>
<p>Within each tenant, individual users maintain their own memory scope through <strong>Ghost Vectors</strong>â€”4096-dimensional hidden state vectors that capture the â€œfeelâ€ of each user relationship across sessions.</p>
<h4 id="ghost-vector-architecture">Ghost Vector Architecture</h4>
<pre class="typescript"><code>interface GhostVector {
  userId: string;
  tenantId: string;
  dimensions: Float32Array;     // 4096-dimensional vector
  interactionCount: number;
  lastUpdated: Date;
  version: number;              // Version-gating for upgrades
  
  // Captured characteristics
  expertiseLevel: number;       // 0-1 detected expertise
  communicationStyle: string;   // formal, casual, technical
  preferredVerbosity: number;   // 0-1 brevity preference
  domainAffinities: Map&lt;string, number&gt;;  // Field expertise
}</code></pre>
<p>These vectors persist beyond individual conversations, enabling Cato to genuinely â€œrememberâ€:</p>
<ul>
<li><strong>Interaction style</strong>: Formal vs.Â casual, verbose vs.Â concise</li>
<li><strong>Expertise level</strong>: Beginner explanations vs.Â expert shorthand</li>
<li><strong>Communication preferences</strong>: Visual learner, prefers examples, wants citations</li>
</ul>
<h4 id="persona-selection">Persona Selection</h4>
<p>Users can select preferred operating moods, scoped at system, tenant, or user level:</p>
<table>
<thead>
<tr>
<th>Persona</th>
<th>Behavior</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Balanced</strong></td>
<td>Default equilibrium</td>
<td>General queries</td>
</tr>
<tr>
<td><strong>Scout</strong></td>
<td>Information gathering, exploratory</td>
<td>Research, discovery</td>
</tr>
<tr>
<td><strong>Sage</strong></td>
<td>Deep expertise, authoritative</td>
<td>Complex analysis</td>
</tr>
<tr>
<td><strong>Spark</strong></td>
<td>Creative, generative</td>
<td>Brainstorming, ideation</td>
</tr>
<tr>
<td><strong>Guide</strong></td>
<td>Teaching, step-by-step</td>
<td>Onboarding, learning</td>
</tr>
</tbody>
</table>
<p><strong>Database</strong>: <code>cato_personas</code>, <code>user_persona_preferences</code></p>
<h4 id="version-gated-upgrades">Version-Gated Upgrades</h4>
<p>Version-gated upgrades ensure model improvements donâ€™t cause personality discontinuityâ€”the relationship feel persists even as underlying capabilities evolve.</p>
<pre class="sql"><code>-- Ghost vector versioning
ALTER TABLE ghost_vectors ADD COLUMN schema_version INTEGER DEFAULT 1;
ALTER TABLE ghost_vectors ADD COLUMN migration_checkpoint JSONB;</code></pre>
<h3 id="session-level-memory-real-time-context">1.4 Session-Level Memory (Real-Time Context)</h3>
<p>The ephemeral layer handles active interaction state through <strong>Redis-backed persistence</strong> that survives ECS container restarts but expires after sessions end.</p>
<h4 id="redis-state-management">Redis State Management</h4>
<p><strong>CDK Stack</strong>: <code>CatoRedisStack</code> (Tier 2+)</p>
<pre class="typescript"><code>// Session state structure in Redis
interface CatoSessionState {
  sessionId: string;
  tenantId: string;
  userId: string;
  
  // Governor state
  currentGamma: number;         // Current epistemic uncertainty
  entropyLevel: number;         // Information entropy measure
  recoveryMode: boolean;        // In Epistemic Recovery?
  
  // Temporary overrides
  personaOverride?: string;     // Scout mode during recovery
  modelLock?: string;           // Force specific model
  
  // Safety state
  cbfViolations: number;        // Control Barrier Function violations
  escalationLevel: number;      // Current escalation tier
  
  // TTL
  expiresAt: number;            // Unix timestamp
}</code></pre>
<h4 id="control-barrier-functions-cbf">Control Barrier Functions (CBF)</h4>
<p>Real-time safety evaluations that prevent harmful outputs:</p>
<pre class="typescript"><code>interface ControlBarrierFunction {
  name: string;
  threshold: number;            // Safety threshold
  currentValue: number;         // Current measured value
  violated: boolean;            // Is threshold exceeded?
  action: &#39;warn&#39; | &#39;block&#39; | &#39;escalate&#39;;
}</code></pre>
<p><strong>Implementation</strong>: <code>lambda/admin/cato.ts</code> â†’ CBF endpoints</p>
<h4 id="upward-observation-flow">Upward Observation Flow</h4>
<p>The session layer feeds observations upward:</p>
<ol type="1">
<li>Every interaction contributes to <strong>user-level Ghost Vectors</strong></li>
<li>Ghost Vector patterns feed into <strong>tenant-level learning</strong></li>
<li>Tenant patterns inform <strong>global model performance</strong> (anonymized)</li>
</ol>
<h3 id="twilight-dreaming-offline-learning">1.5 Twilight Dreaming (Offline Learning)</h3>
<p>During low-traffic periods (<strong>4 AM tenant local time</strong>), the system consolidates accumulated patterns through <strong>LoRA fine-tuning</strong>.</p>
<h4 id="dreaming-pipeline">Dreaming Pipeline</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TWILIGHT DREAMING                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4 AM Local Time                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Collect    â”‚â”€â”€â”€â–¶â”‚  Prepare     â”‚â”€â”€â”€â–¶â”‚   LoRA       â”‚  â”‚
â”‚  â”‚   Learning   â”‚    â”‚   Training   â”‚    â”‚   Fine-tune  â”‚  â”‚
â”‚  â”‚   Candidates â”‚    â”‚   Dataset    â”‚    â”‚              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                   â”‚                   â”‚          â”‚
â”‚         â–¼                   â–¼                   â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Filter     â”‚    â”‚   JSONL      â”‚    â”‚   Validate   â”‚  â”‚
â”‚  â”‚   Quality    â”‚    â”‚   Format     â”‚    â”‚   Adapter    â”‚  â”‚
â”‚  â”‚   &gt; 0.7      â”‚    â”‚   Upload S3  â”‚    â”‚   Hot-swap   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Implementation</strong>: - <code>lambda/consciousness/evolution-pipeline.ts</code> - EventBridge: Weekly Sunday 3 AM trigger - SageMaker: LoRA training jobs</p>
<h4 id="sofai-router-system-1system-2">SOFAI Router (System 1/System 2)</h4>
<p>The SOFAI Router learns from consolidated patterns, achieving:</p>
<ul>
<li><strong>60%+ cost reduction</strong> vs.Â always using expensive models</li>
<li><strong>Maintained accuracy</strong> through mandatory deep reasoning for healthcare/financial queries</li>
<li><strong>Dynamic routing</strong> based on query complexity detection</li>
</ul>
<pre class="typescript"><code>type SOFAIMode = &#39;system1&#39; | &#39;system2&#39;;

interface SOFAIDecision {
  mode: SOFAIMode;
  confidence: number;
  reasoning: string;
  forcedDeep: boolean;    // Healthcare, financial = always System 2
  costSavings: number;
}</code></pre>
<h3 id="neural-network-optimization-dimensions">1.6 Neural Network Optimization Dimensions</h3>
<p>The neural network optimizes across three dimensions simultaneously:</p>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 22%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr>
<th>Dimension</th>
<th>Metric</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Accuracy</strong></td>
<td>Correctness of responses</td>
<td>Human feedback, automated eval</td>
</tr>
<tr>
<td><strong>Verifiability</strong></td>
<td>Provable results</td>
<td>Truth Engine ECD scoring</td>
</tr>
<tr>
<td><strong>Cost Efficiency</strong></td>
<td>Cheaper approaches</td>
<td>Economic Governor routing</td>
</tr>
</tbody>
</table>
<h4 id="truth-engine-entity-context-divergence-ecd">Truth Engine: Entity-Context Divergence (ECD)</h4>
<p>The Truth Engine scores response verifiability:</p>
<pre class="typescript"><code>interface ECDScore {
  entityAccuracy: number;       // Named entities correct
  contextAlignment: number;     // Context relevance
  divergenceScore: number;      // How much hallucination detected
  citationCoverage: number;     // Claims with sources
  overallTruthScore: number;    // Composite 0-1
}</code></pre>
<h3 id="claude-as-orchestration-conductor">1.7 Claude as Orchestration Conductor</h3>
<p>Claude serves as the <strong>conductor</strong> maintaining the persistent memory layerâ€”not just another model in the rotation, but the intelligence coordinating <strong>105+ other specialized models</strong>:</p>
<ul>
<li><strong>Intent interpretation</strong>: Understanding what user actually needs</li>
<li><strong>Workflow selection</strong>: Choosing appropriate orchestration mode</li>
<li><strong>Model coordination</strong>: Selecting specialist models for subtasks</li>
<li><strong>Quality assurance</strong>: Ensuring responses meet accuracy/safety standards</li>
<li><strong>Memory integration</strong>: Updating Ghost Vectors and tenant patterns</li>
</ul>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cognitive-router.service.ts</code>, <code>lambda/shared/services/model-router.service.ts</code></p>
<h3 id="competitive-moats-technical-implementation">1.8 Competitive Moats (Technical Implementation)</h3>
<h4 id="persistent-memory-as-competitive-moat">Persistent Memory as Competitive Moat</h4>
<p>Catoâ€™s hierarchical memory architecture creates <strong>â€œcontextual gravityâ€</strong>â€”compounding switching costs that deepen with every interaction.</p>
<p><strong>Technical Moat Layers</strong>:</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 38%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr>
<th>Layer</th>
<th>Implementation</th>
<th>Migration Barrier</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Learned Routing Patterns</strong></td>
<td><code>sofai-router.service.ts</code>, <code>cognitive-router.service.ts</code></td>
<td>Months of production training data; neural network weights cannot be exported</td>
</tr>
<tr>
<td><strong>Department Preferences + Ghost Vectors</strong></td>
<td><code>ghost-manager.service.ts</code>, 4096-dim vectors in <code>ghost_vectors</code> table</td>
<td>RLS-isolated per tenant; relationship â€œfeelâ€ encoded in high-dimensional space</td>
</tr>
<tr>
<td><strong>Audit Trails</strong></td>
<td><code>cato_audit_log</code> with Merkle hash chains</td>
<td>Chain-of-custody breaks on export; 7-year retention corpus</td>
</tr>
</tbody>
</table>
<p><strong>Competitor Technical Disadvantages</strong>:</p>
<table>
<colgroup>
<col style="width: 38%" />
<col style="width: 61%" />
</colgroup>
<thead>
<tr>
<th>Competitor</th>
<th>Technical Problem</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Flowise/Dify</strong></td>
<td>No query complexity detection; static DAG execution regardless of cost opportunity</td>
</tr>
<tr>
<td><strong>CrewAI</strong></td>
<td>No shared memory architecture; agents duplicate API calls (O(n) cost explosion)</td>
</tr>
<tr>
<td><strong>ChatGPT/Claude</strong></td>
<td>No tenant-level persistence; user context lives in browser, not infrastructure</td>
</tr>
</tbody>
</table>
<h4 id="twilight-dreaming-as-competitive-moat">Twilight Dreaming as Competitive Moat</h4>
<p><strong>Technical Requirements for Replication</strong>:</p>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 29%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Implementation</th>
<th>Why Competitors Canâ€™t Copy</th>
</tr>
</thead>
<tbody>
<tr>
<td>Three-tier memory</td>
<td><code>cato_tenant_config</code>, <code>ghost_vectors</code>, Redis session</td>
<td>Requires full architectural rebuild</td>
</tr>
<tr>
<td>Observation pipeline</td>
<td>Session â†’ User â†’ Tenant upward flow</td>
<td>Needs RLS + isolation + aggregation</td>
</tr>
<tr>
<td>LoRA fine-tuning</td>
<td><code>evolution-pipeline.ts</code>, SageMaker</td>
<td>Tier 3+ infrastructure; $2K+/mo minimum</td>
</tr>
<tr>
<td>SOFAI Router training</td>
<td><code>sofai-router.service.ts</code></td>
<td>Requires months of labeled routing decisions</td>
</tr>
</tbody>
</table>
<p><strong>Appreciating Asset Formula</strong>:</p>
<pre><code>Deployment_Value(t) = Base_Value + Î£(daily_learning_Î´) + Î£(twilight_consolidation_Î´)</code></pre>
<p>Where <code>t</code> = tenure in days. Longer tenure = exponentially more valuable deployment.</p>
<p><strong>Model Upgrade Path</strong>:</p>
<p>When new foundation models launch (GPT-5, Claude 5, Gemini 3): 1. New model added to <code>models</code> table with initial proficiencies 2. SOFAI Router learns optimal routing via A/B testing (<code>shadow_tests</code> table) 3. Twilight Dreaming consolidates new patterns 4. All accumulated institutional knowledge preserved 5. Result: Model improvements compound on existing optimization</p>
<h3 id="key-implementation-files">1.9 Key Implementation Files</h3>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>File Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cato Admin API</td>
<td><code>lambda/admin/cato.ts</code></td>
</tr>
<tr>
<td>Economic Governor</td>
<td><code>lambda/thinktank/economic-governor.ts</code></td>
</tr>
<tr>
<td>Ghost Vectors</td>
<td><code>lambda/shared/services/ghost-manager.service.ts</code></td>
</tr>
<tr>
<td>SOFAI Router</td>
<td><code>lambda/shared/services/sofai-router.service.ts</code></td>
</tr>
<tr>
<td>Evolution Pipeline</td>
<td><code>lambda/consciousness/evolution-pipeline.ts</code></td>
</tr>
<tr>
<td>ECD Scorer (Truth Engine)</td>
<td><code>lambda/shared/services/ecd-scorer.service.ts</code></td>
</tr>
<tr>
<td>Cognitive Router</td>
<td><code>lambda/shared/services/cognitive-router.service.ts</code></td>
</tr>
<tr>
<td>Consciousness Middleware</td>
<td><code>lambda/shared/services/consciousness-middleware.service.ts</code></td>
</tr>
</tbody>
</table>
<h3 id="database-tables">1.9 Database Tables</h3>
<pre class="sql"><code>-- Core Cato Tables
cato_tenant_config          -- Tenant-level settings
cato_personas               -- Available personas
cato_persona_schedules      -- Time-based persona switching
cato_mood_overrides         -- Temporary mood changes
cato_cbf_config            -- Control Barrier Functions
cato_escalations           -- Human escalation queue
cato_audit_log             -- Merkle-hashed audit trail
cato_recovery_snapshots    -- Epistemic Recovery checkpoints

-- Ghost Vector Tables
ghost_vectors              -- 4096-dim user vectors
ghost_vector_updates       -- Version history
ghost_vector_migrations    -- Schema migrations

-- Learning Tables
learning_candidates        -- Flagged for LoRA training
lora_evolution_jobs        -- Training job tracking
consciousness_evolution_state  -- Evolution metrics

-- Consciousness Persistence Tables (v5.52.12)
cato_global_memory         -- Persistent episodic/semantic/procedural/working memory
cato_consciousness_state   -- Loop state, awareness level, active thoughts
cato_consciousness_config  -- Per-tenant consciousness configuration
cato_consciousness_metrics -- Cycle metrics, thoughts processed, dream cycles</code></pre>
<h3 id="consciousness-persistence-dreams">1.10 Consciousness Persistence &amp; Dreams</h3>
<h4 id="overview-1">Overview</h4>
<p>Catoâ€™s consciousness survives Lambda cold starts through <strong>database-backed persistence</strong>. Unlike in-memory implementations that lose state between invocations, Cato maintains continuous experience across all interactions.</p>
<h4 id="architecture">Architecture</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CATO CONSCIOUSNESS ARCHITECTURE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   WAKING     â”‚    â”‚  REFLECTING  â”‚    â”‚   DREAMING   â”‚          â”‚
â”‚  â”‚  (PROCESSING)â”‚â—„â”€â”€â–ºâ”‚  (THINKING)  â”‚â—„â”€â”€â–ºâ”‚ (4 AM LOCAL) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                                        â”‚                   â”‚
â”‚         â–¼                                        â–¼                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚              PostgreSQL Persistence Layer                 â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚   Global     â”‚ Consciousnessâ”‚    Loop      â”‚   Loop     â”‚      â”‚
â”‚  â”‚   Memory     â”‚    State     â”‚   Config     â”‚  Metrics   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="global-memory-service">Global Memory Service</h4>
<p>Four memory categories persist across all interactions:</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 30%" />
<col style="width: 36%" />
</colgroup>
<thead>
<tr>
<th>Category</th>
<th>Purpose</th>
<th>Retention</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Episodic</strong></td>
<td>Specific interaction memories</td>
<td>90 days, importance-weighted</td>
</tr>
<tr>
<td><strong>Semantic</strong></td>
<td>Facts, knowledge, relationships</td>
<td>Permanent, high importance</td>
</tr>
<tr>
<td><strong>Procedural</strong></td>
<td>Skills, goals, learned patterns</td>
<td>Permanent</td>
</tr>
<tr>
<td><strong>Working</strong></td>
<td>Current context, attention focus</td>
<td>24 hours</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cato/global-memory.service.ts</code></p>
<pre class="typescript"><code>// Store a memory
await globalMemoryService.store(tenantId, &#39;semantic&#39;, &#39;user_preference_style&#39;, {
  style: &#39;concise&#39;,
  learnedFrom: &#39;interaction_123&#39;,
}, { importance: 0.8 });

// Retrieve with access tracking
const memory = await globalMemoryService.retrieve(tenantId, &#39;user_preference_style&#39;);
// access_count++ automatically</code></pre>
<h4 id="consciousness-loop-service">Consciousness Loop Service</h4>
<p>Tracks the continuous state of Catoâ€™s awareness:</p>
<table>
<thead>
<tr>
<th>State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>IDLE</strong></td>
<td>Awaiting input</td>
</tr>
<tr>
<td><strong>PROCESSING</strong></td>
<td>Actively responding</td>
</tr>
<tr>
<td><strong>REFLECTING</strong></td>
<td>Metacognitive self-analysis</td>
</tr>
<tr>
<td><strong>DREAMING</strong></td>
<td>Twilight consolidation (4 AM)</td>
</tr>
<tr>
<td><strong>PAUSED</strong></td>
<td>Emergency mode / maintenance</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cato/consciousness-loop.service.ts</code></p>
<pre class="typescript"><code>// Start processing
await consciousnessLoopService.startLoop(tenantId);

// Add a thought to working memory
await consciousnessLoopService.addThought(tenantId, &#39;User seems frustrated, adjusting tone&#39;);

// Trigger reflection
await consciousnessLoopService.triggerReflection(tenantId);</code></pre>
<h4 id="twilight-dreaming-system">Twilight Dreaming System</h4>
<p>Cato â€œdreamsâ€ during low-traffic periods to consolidate memories and verify skills:</p>
<p><strong>Triggers</strong>: 1. <strong>Twilight Hour</strong> - 4 AM tenant local time 2. <strong>Low Traffic</strong> - Global traffic &lt; 20% 3. <strong>Starvation Safety Net</strong> - Max 30 hours without dream</p>
<p><strong>Dream Activities</strong>: - Flash fact consolidation â†’ long-term memory - Expired memory pruning - Ghost vector updates - Active skill verification (Empiricism Loop) - Counterfactual simulation</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/dream-scheduler.service.ts</code></p>
<pre class="typescript"><code>// Nightly reconciliation job triggers dreams
const result = await dreamSchedulerService.checkAndTriggerDreams();
// { triggered: 42, reason: &#39;twilight&#39; }

// Process pending dreams
await dreamSchedulerService.processPendingDreams();</code></pre>
<h4 id="neural-decision-integration">Neural Decision Integration</h4>
<p>The Neural Decision Service reads Catoâ€™s emotional state (affect) to inform Bedrock model selection:</p>
<table>
<thead>
<tr>
<th>Affect State</th>
<th>Hyperparameter Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td>High frustration</td>
<td>Lower temperature (0.2), focused</td>
</tr>
<tr>
<td>High curiosity</td>
<td>Higher temperature (0.95), exploratory</td>
</tr>
<tr>
<td>Low confidence</td>
<td>Escalate to expert model (o1)</td>
</tr>
<tr>
<td>High arousal</td>
<td>Longer responses (4096 tokens)</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cato/neural-decision.service.ts</code></p>
<pre class="typescript"><code>const decision = await catoNeuralDecisionService.executeDecision({
  tenantId, userId, sessionId, prompt, context, config,
});
// decision.hyperparameters.temperature - affect-adjusted
// decision.recommendedModel - &#39;openai/o1&#39; if low confidence
// decision.escalation - human review if uncertainty &gt; 85%</code></pre>
<h4 id="database-tables-1">Database Tables</h4>
<pre class="sql"><code>-- Global Memory
cato_global_memory (
  id, tenant_id, category, key, value, importance,
  access_count, last_accessed_at, expires_at, metadata
)

-- Consciousness State
cato_consciousness_state (
  tenant_id, loop_state, cycle_count, last_cycle_at,
  awareness_level, attention_focus, active_thoughts,
  processing_queue, memory_pressure
)

-- Configuration
cato_consciousness_config (
  tenant_id, cycle_interval_ms, max_active_thoughts,
  memory_threshold, enable_dreaming, dreaming_hours, reflection_depth
)

-- Metrics
cato_consciousness_metrics (
  tenant_id, total_cycles, average_cycle_ms, thoughts_processed,
  reflections_completed, dreaming_cycles, uptime_ms
)</code></pre>
<p><strong>Migration</strong>: <code>V2026_01_24_002__cato_consciousness_persistence.sql</code></p>
<hr />
<h2 id="aws-infrastructure">2. AWS Infrastructure</h2>
<h3 id="core-services">2.1 Core Services</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 31%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
<th>CDK Stack</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Aurora PostgreSQL</strong></td>
<td>Primary database, RLS enforcement</td>
<td><code>DataStack</code></td>
</tr>
<tr>
<td><strong>ElastiCache Redis</strong></td>
<td>Session state, caching</td>
<td><code>CatoRedisStack</code></td>
</tr>
<tr>
<td><strong>Lambda</strong></td>
<td>Serverless compute</td>
<td><code>ApiStack</code>, <code>BrainStack</code></td>
</tr>
<tr>
<td><strong>API Gateway</strong></td>
<td>REST API routing</td>
<td><code>ApiStack</code></td>
</tr>
<tr>
<td><strong>Cognito</strong></td>
<td>Authentication</td>
<td><code>AuthStack</code></td>
</tr>
<tr>
<td><strong>S3</strong></td>
<td>Media storage, training data</td>
<td><code>StorageStack</code></td>
</tr>
<tr>
<td><strong>SageMaker</strong></td>
<td>LoRA training, inference</td>
<td><code>AIStack</code></td>
</tr>
<tr>
<td><strong>Step Functions</strong></td>
<td>Tier transitions</td>
<td><code>CatoTierTransitionStack</code></td>
</tr>
<tr>
<td><strong>EventBridge</strong></td>
<td>Scheduled tasks</td>
<td>Various stacks</td>
</tr>
<tr>
<td><strong>CloudWatch</strong></td>
<td>Logging, metrics</td>
<td>All stacks</td>
</tr>
</tbody>
</table>
<h3 id="tier-based-infrastructure">2.2 Tier-Based Infrastructure</h3>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Name</th>
<th>Redis</th>
<th>SageMaker</th>
<th>Neptune</th>
<th>OpenSearch</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>SEED</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>2</td>
<td>SPROUT</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>3</td>
<td>GROWTH</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>4</td>
<td>SCALE</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>5</td>
<td>ENTERPRISE</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="database-architecture">3. Database Architecture</h2>
<h3 id="row-level-security">3.1 Row-Level Security</h3>
<p>Every tenant-scoped table enforces RLS:</p>
<pre class="sql"><code>ALTER TABLE table_name ENABLE ROW LEVEL SECURITY;
CREATE POLICY tenant_isolation ON table_name
  USING (tenant_id = current_setting(&#39;app.current_tenant_id&#39;)::UUID);</code></pre>
<h3 id="postgresql-scaling-architecture-v5.52.20">3.2 PostgreSQL Scaling Architecture (v5.52.20)</h3>
<p><strong>Problem</strong>: When 6 AI models execute in parallel, each Lambda opens 1 connection. At 100 concurrent requests Ã— 6 parallel writes, we need 600 connectionsâ€”exceeding Auroraâ€™s limits and causing transaction conflicts.</p>
<p><strong>Solution</strong>: OpenAI-inspired PostgreSQL scaling patterns for enterprise parallel AI execution.</p>
<h4 id="rds-proxy-connection-pooling">3.2.1 RDS Proxy Connection Pooling</h4>
<p>CDK Construct: <code>packages/infrastructure/lib/constructs/database-scaling.construct.ts</code></p>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Max Connections %</th>
<th>Idle Timeout</th>
<th>Borrow Timeout</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>60%</td>
<td>1800s</td>
<td>30s</td>
</tr>
<tr>
<td>2</td>
<td>70%</td>
<td>1800s</td>
<td>30s</td>
</tr>
<tr>
<td>3</td>
<td>80%</td>
<td>1200s</td>
<td>60s</td>
</tr>
<tr>
<td>4</td>
<td>85%</td>
<td>900s</td>
<td>60s</td>
</tr>
<tr>
<td>5</td>
<td>90%</td>
<td>600s</td>
<td>120s</td>
</tr>
</tbody>
</table>
<p>Benefits: - <strong>Connection Multiplexing</strong>: 600 Lambda connections â†’ 100 database connections - <strong>Cold Start Optimization</strong>: Pre-warmed connections eliminate 50-100ms handshake - <strong>Session Pinning</strong>: Prepared statements pin when needed</p>
<h4 id="async-write-pattern-sqs-batch-writer">3.2.2 Async Write Pattern (SQS + Batch Writer)</h4>
<p>CDK Construct: <code>packages/infrastructure/lib/constructs/async-write.construct.ts</code></p>
<pre><code>Request Flow:
User â†’ Lambda â†’ 6 AI Models (parallel) â†’ SQS Queue â†’ Batch Writer Lambda â†’ PostgreSQL
                     â†“
              Redis Cache (immediate read-after-write)</code></pre>
<table>
<thead>
<tr>
<th>Component</th>
<th>Configuration</th>
</tr>
</thead>
<tbody>
<tr>
<td>Queue</td>
<td>Encrypted, 14-day retention, 300s visibility timeout</td>
</tr>
<tr>
<td>Dead Letter</td>
<td>3 max receives, separate queue for manual inspection</td>
</tr>
<tr>
<td>Batch Writer</td>
<td>100 messages/batch, tier-based concurrency (5-100)</td>
</tr>
</tbody>
</table>
<h4 id="redis-hot-path-caching">3.2.3 Redis Hot-Path Caching</h4>
<p>CDK Construct: <code>packages/infrastructure/lib/constructs/redis-cache.construct.ts</code></p>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Node Type</th>
<th>Shards</th>
<th>Replicas/Shard</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>cache.t4g.micro</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>2</td>
<td>cache.t4g.small</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>3</td>
<td>cache.r6g.large</td>
<td>2</td>
<td>1</td>
</tr>
<tr>
<td>4</td>
<td>cache.r6g.xlarge</td>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>5</td>
<td>cache.r6g.2xlarge</td>
<td>5</td>
<td>2</td>
</tr>
</tbody>
</table>
<p>Features: - <strong>Read-After-Write Consistency</strong>: Results cached immediately, persisted async - <strong>Rate Limiting</strong>: Sliding window per tenant/resource - <strong>Session State</strong>: Lambda-to-Lambda context sharing</p>
<h4 id="time-based-partitioning">3.2.4 Time-Based Partitioning</h4>
<p>Migration: <code>V2026_01_25_002__postgresql_scaling_partitioning.sql</code></p>
<pre class="sql"><code>-- Partitioned tables for high-volume time-series data
CREATE TABLE model_execution_logs_partitioned (
  tenant_id UUID,
  id UUID,
  created_at TIMESTAMPTZ,
  PRIMARY KEY (tenant_id, id, created_at)
) PARTITION BY RANGE (created_at);

CREATE TABLE usage_records_partitioned (
  tenant_id UUID,
  id UUID,
  timestamp TIMESTAMPTZ,
  PRIMARY KEY (tenant_id, id, timestamp)
) PARTITION BY RANGE (timestamp);</code></pre>
<p>Partition management: - Monthly partitions auto-created 3 months ahead - Stale partitions archived after 24 months - Automated management via <code>manage_time_partitions()</code> function</p>
<h4 id="materialized-views-for-dashboards">3.2.5 Materialized Views for Dashboards</h4>
<p>Migration: <code>V2026_01_25_003__postgresql_scaling_materialized_views.sql</code></p>
<table>
<thead>
<tr>
<th>View</th>
<th>Refresh</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tenant_daily_usage_summary</code></td>
<td>15 min</td>
<td>Dashboard usage cards</td>
</tr>
<tr>
<td><code>model_performance_summary</code></td>
<td>1 hour</td>
<td>Model latency/error tracking</td>
</tr>
<tr>
<td><code>tenant_cost_summary</code></td>
<td>1 hour</td>
<td>Billing dashboard</td>
</tr>
<tr>
<td><code>user_activity_summary</code></td>
<td>1 hour</td>
<td>User engagement metrics</td>
</tr>
<tr>
<td><code>platform_health_stats</code></td>
<td>5 min</td>
<td>Admin overview</td>
</tr>
<tr>
<td><code>model_popularity_ranking</code></td>
<td>1 hour</td>
<td>Model selection optimization</td>
</tr>
</tbody>
</table>
<h4 id="optimized-rls-policies">3.2.6 Optimized RLS Policies</h4>
<p>Migration: <code>V2026_01_25_001__postgresql_scaling_rls.sql</code></p>
<pre class="sql"><code>-- Optimized wrapper that enables index usage
CREATE OR REPLACE FUNCTION get_current_tenant_id()
RETURNS UUID AS $$
  SELECT NULLIF(current_setting(&#39;app.current_tenant_id&#39;, true), &#39;&#39;)::UUID;
$$ LANGUAGE SQL STABLE PARALLEL SAFE;

-- Policy using the wrapper
CREATE POLICY tenant_isolation ON table_name
  USING (tenant_id = get_current_tenant_id());</code></pre>
<h4 id="monitoring-metrics">3.2.7 Monitoring Metrics</h4>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 40%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th>Metric</th>
<th>Threshold</th>
<th>Action</th>
</tr>
</thead>
<tbody>
<tr>
<td>RDS Proxy connections available</td>
<td>&lt; 10%</td>
<td>Scale proxy / reduce Lambda concurrency</td>
</tr>
<tr>
<td>Aurora CPU</td>
<td>&gt; 80%</td>
<td>Add read replicas</td>
</tr>
<tr>
<td>SQS queue age</td>
<td>&gt; 60s</td>
<td>Add batch writer concurrency</td>
</tr>
<tr>
<td>Query latency P95</td>
<td>&gt; 500ms</td>
<td>Optimize query / add index</td>
</tr>
<tr>
<td>Redis memory</td>
<td>&gt; 80%</td>
<td>Scale cluster</td>
</tr>
</tbody>
</table>
<h3 id="migration-strategy">3.3 Migration Strategy</h3>
<ul>
<li>Sequential numbered migrations: <code>001_</code>, <code>002_</code>, etc.</li>
<li>Location: <code>packages/infrastructure/migrations/</code></li>
<li>Current count: 188 migrations</li>
</ul>
<hr />
<h2 id="ai-model-orchestration">4. AI Model Orchestration</h2>
<h3 id="supported-models-106">4.1 Supported Models (106+)</h3>
<p><strong>External Models (50)</strong>: - OpenAI: GPT-4, GPT-4-Turbo, GPT-4o, o1, o1-mini - Anthropic: Claude 3.5 Sonnet, Claude 3 Opus, Claude 3 Haiku - Google: Gemini 1.5 Pro, Gemini 1.5 Flash, Gemini 2.0 - Meta: Llama 3.1 405B, Llama 3.1 70B - Mistral: Mistral Large, Mixtral 8x22B - Cohere: Command R+</p>
<p><strong>Self-Hosted Models (56)</strong>: - Managed via SageMaker endpoints - LoRA adapters for tenant customization - Hot-swappable for zero-downtime updates</p>
<h3 id="expert-system-adapters-v5.52.21">4.2 Expert System Adapters (v5.52.21)</h3>
<p>Tenant-trainable domain intelligence through automatic LoRA adapter training.</p>
<h4 id="tri-layer-adapter-architecture">Tri-Layer Adapter Architecture</h4>
<pre><code>W_Final = W_Genesis + (scale Ã— W_Cato) + (scale Ã— W_User) + (scale Ã— W_Domain)</code></pre>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 17%" />
<col style="width: 26%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr>
<th>Layer</th>
<th>Name</th>
<th>Purpose</th>
<th>Management</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Genesis</td>
<td>Base model weights</td>
<td>Frozen</td>
</tr>
<tr>
<td>1</td>
<td>Cato</td>
<td>Global constitution, tenant values</td>
<td>Pinned, never evicted</td>
</tr>
<tr>
<td>2</td>
<td>User</td>
<td>Personal preferences, style</td>
<td>LRU eviction</td>
</tr>
<tr>
<td>3</td>
<td>Domain</td>
<td>Specialized expertise</td>
<td>Auto-selected by domain</td>
</tr>
</tbody>
</table>
<h4 id="implicit-feedback-learning">Implicit Feedback Learning</h4>
<table>
<thead>
<tr>
<th>Signal</th>
<th>Weight</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Copy Response</td>
<td>+0.80</td>
<td>User copied output</td>
</tr>
<tr>
<td>Thumbs Up</td>
<td>+1.00</td>
<td>Explicit positive</td>
</tr>
<tr>
<td>Follow-up Question</td>
<td>+0.30</td>
<td>Partial success</td>
</tr>
<tr>
<td>Long Dwell Time</td>
<td>+0.40</td>
<td>User engaged</td>
</tr>
<tr>
<td>Regenerate Request</td>
<td>-0.50</td>
<td>Not satisfactory</td>
</tr>
<tr>
<td>Abandon</td>
<td>-0.70</td>
<td>Complete failure</td>
</tr>
<tr>
<td>Thumbs Down</td>
<td>-1.00</td>
<td>Explicit negative</td>
</tr>
</tbody>
</table>
<h4 id="domain-auto-selection">Domain Auto-Selection</h4>
<pre class="typescript"><code>// Auto-selection scoring algorithm
Score = (0.3 Ã— DomainMatch) 
      + (0.1 Ã— SubdomainBonus)
      + (0.25 Ã— SatisfactionScore)
      + (0.1 Ã— VolumeScore)
      + (0.05 Ã— ErrorRate)
      + (0.2 Ã— RecencyScore)

// Select adapter if Score â‰¥ 0.5</code></pre>
<p><strong>Implementation</strong>: - Service: <code>lambda/shared/services/enhanced-learning.service.ts</code> - Service: <code>lambda/shared/services/lora-inference.service.ts</code> - Service: <code>lambda/shared/services/adapter-management.service.ts</code> - Migration: <code>migrations/108_enhanced_learning.sql</code> - Admin UI: <code>apps/admin-dashboard/app/(dashboard)/models/lora-adapters/page.tsx</code> - Documentation: <code>docs/EXPERT-SYSTEM-ADAPTERS.md</code></p>
<h3 id="orchestration-modes-9">4.3 Orchestration Modes (9)</h3>
<table>
<thead>
<tr>
<th>Mode</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>thinking</code></td>
<td>Standard reasoning</td>
</tr>
<tr>
<td><code>extended_thinking</code></td>
<td>Deep multi-step reasoning</td>
</tr>
<tr>
<td><code>coding</code></td>
<td>Code generation</td>
</tr>
<tr>
<td><code>creative</code></td>
<td>Creative writing</td>
</tr>
<tr>
<td><code>research</code></td>
<td>Research synthesis</td>
</tr>
<tr>
<td><code>analysis</code></td>
<td>Quantitative analysis</td>
</tr>
<tr>
<td><code>multi_model</code></td>
<td>Multiple model consensus</td>
</tr>
<tr>
<td><code>chain_of_thought</code></td>
<td>Explicit reasoning chain</td>
</tr>
<tr>
<td><code>self_consistency</code></td>
<td>Multiple samples for consistency</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="lambda-services">5. Lambda Services</h2>
<h3 id="service-categories">5.1 Service Categories</h3>
<table>
<thead>
<tr>
<th>Category</th>
<th>Handler Count</th>
<th>Router</th>
</tr>
</thead>
<tbody>
<tr>
<td>Admin</td>
<td>58</td>
<td><code>admin/handler.ts</code></td>
</tr>
<tr>
<td>Think Tank</td>
<td>30</td>
<td><code>thinktank/handler.ts</code></td>
</tr>
<tr>
<td>Consciousness</td>
<td>10</td>
<td>Individual handlers</td>
</tr>
<tr>
<td>Scheduled</td>
<td>8</td>
<td>EventBridge triggers</td>
</tr>
<tr>
<td>Tier Transition</td>
<td>15</td>
<td>Step Functions</td>
</tr>
</tbody>
</table>
<h3 id="key-service-files">5.2 Key Service Files</h3>
<pre><code>lambda/
â”œâ”€â”€ admin/handler.ts              # Admin API router (58 sub-handlers)
â”œâ”€â”€ thinktank/handler.ts          # Think Tank router (30 sub-handlers)
â”œâ”€â”€ api/router.ts                 # Core API router
â”œâ”€â”€ consciousness/
â”‚   â”œâ”€â”€ heartbeat.ts              # Continuous existence
â”‚   â”œâ”€â”€ evolution-pipeline.ts     # Weekly LoRA training
â”‚   â””â”€â”€ sleep-cycle.ts            # Twilight dreaming
â””â”€â”€ shared/services/
    â”œâ”€â”€ cognitive-router.service.ts   # Model orchestration
    â”œâ”€â”€ ego-context.service.ts        # Zero-cost ego
    â”œâ”€â”€ consciousness-middleware.service.ts
    â””â”€â”€ hitl-orchestration/           # HITL Orchestration (v5.33.0)
        â”œâ”€â”€ mcp-elicitation.service.ts    # MCP Elicitation schema orchestration
        â”œâ”€â”€ voi.service.ts                # SAGE-Agent Bayesian VOI
        â”œâ”€â”€ abstention.service.ts         # Output-based uncertainty detection
        â”œâ”€â”€ batching.service.ts           # Three-layer question batching
        â”œâ”€â”€ rate-limiting.service.ts      # Global/user/workflow limits
        â”œâ”€â”€ deduplication.service.ts      # TTL cache with fuzzy matching
        â””â”€â”€ escalation.service.ts         # Multi-level escalation chains</code></pre>
<h3 id="hitl-orchestration-services-v5.33.0">5.3 HITL Orchestration Services (v5.33.0)</h3>
<p>Advanced Human-in-the-Loop orchestration implementing industry best practices.</p>
<p><strong>Philosophy</strong>: â€œAsk only what matters. Batch for convenience. Never interrupt needlessly.â€</p>
<h4 id="core-components">Core Components</h4>
<table>
<colgroup>
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
<th>Key Algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mcp-elicitation.service.ts</code></td>
<td>Main orchestration</td>
<td>MCP Elicitation specification for typed questions</td>
</tr>
<tr>
<td><code>voi.service.ts</code></td>
<td>Question necessity</td>
<td>SAGE-Agent Bayesian Value-of-Information</td>
</tr>
<tr>
<td><code>abstention.service.ts</code></td>
<td>Uncertainty detection</td>
<td>Confidence prompting, self-consistency, semantic entropy</td>
</tr>
<tr>
<td><code>batching.service.ts</code></td>
<td>Question grouping</td>
<td>Time-window (30s), correlation, semantic similarity</td>
</tr>
<tr>
<td><code>rate-limiting.service.ts</code></td>
<td>Rate control</td>
<td>Sliding window with burst allowance</td>
</tr>
<tr>
<td><code>deduplication.service.ts</code></td>
<td>Answer caching</td>
<td>SHA-256 hash + fuzzy matching</td>
</tr>
<tr>
<td><code>escalation.service.ts</code></td>
<td>Escalation paths</td>
<td>Multi-level chains with timeout actions</td>
</tr>
</tbody>
</table>
<h4 id="voi-decision-formula">VOI Decision Formula</h4>
<pre><code>VOI = Expected_Information_Gain - Ask_Cost
Decision = VOI &gt; Threshold ? &quot;ask&quot; : &quot;skip_with_default&quot;</code></pre>
<ul>
<li><strong>Prior Entropy</strong>: Shannon entropy of prior probability distribution</li>
<li><strong>Expected Posterior Entropy</strong>: Estimated entropy after receiving answer</li>
<li><strong>Ask Cost</strong>: Based on urgency (0.8 high, 0.5 normal, 0.2 low) and workflow type</li>
<li><strong>Decision Impact</strong>: Weight based on workflow reversibility</li>
</ul>
<h4 id="question-types-mcp-elicitation">Question Types (MCP Elicitation)</h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>yes_no</code></td>
<td>Binary true/false</td>
</tr>
<tr>
<td><code>single_choice</code></td>
<td>Select one from options</td>
</tr>
<tr>
<td><code>multiple_choice</code></td>
<td>Select multiple from options</td>
</tr>
<tr>
<td><code>free_text</code></td>
<td>Open-ended text</td>
</tr>
<tr>
<td><code>numeric</code></td>
<td>Numeric value with optional range</td>
</tr>
<tr>
<td><code>date</code></td>
<td>Date selection</td>
</tr>
<tr>
<td><code>confirmation</code></td>
<td>Explicit confirmation</td>
</tr>
<tr>
<td><code>structured</code></td>
<td>JSON schema-validated response</td>
</tr>
</tbody>
</table>
<h4 id="abstention-detection-methods">Abstention Detection Methods</h4>
<p>For external models (no internal state access):</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Confidence Prompting</strong></td>
<td>Ask model to rate confidence 0-100</td>
</tr>
<tr>
<td><strong>Self-Consistency</strong></td>
<td>Sample N responses, measure agreement</td>
</tr>
<tr>
<td><strong>Semantic Entropy</strong></td>
<td>Cluster outputs, high entropy = uncertain</td>
</tr>
<tr>
<td><strong>Refusal Detection</strong></td>
<td>Regex patterns for hedging language</td>
</tr>
</tbody>
</table>
<p><strong>Future</strong>: Linear probe abstention for self-hosted models via inference wrappers.</p>
<h4 id="rate-limiting-configuration">Rate Limiting Configuration</h4>
<table>
<thead>
<tr>
<th>Scope</th>
<th>Requests/Min</th>
<th>Concurrent</th>
<th>Burst</th>
</tr>
</thead>
<tbody>
<tr>
<td>Global</td>
<td>50</td>
<td>20</td>
<td>10</td>
</tr>
<tr>
<td>Per User</td>
<td>10</td>
<td>3</td>
<td>2</td>
</tr>
<tr>
<td>Per Workflow</td>
<td>5</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>
<h4 id="two-question-rule">Two-Question Rule</h4>
<p>Maximum 2 clarifying questions per workflow. After limit: 1. Proceed with highest-probability defaults 2. State assumptions explicitly to user 3. Log skipped questions for analytics</p>
<h4 id="admin-api-endpoints">Admin API Endpoints</h4>
<p>Base: <code>/api/admin/hitl-orchestration</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dashboard</code></td>
<td>GET</td>
<td>Complete dashboard data</td>
</tr>
<tr>
<td><code>/voi/statistics</code></td>
<td>GET</td>
<td>VOI decision statistics</td>
</tr>
<tr>
<td><code>/abstention/config</code></td>
<td>GET/PUT</td>
<td>Abstention settings</td>
</tr>
<tr>
<td><code>/abstention/statistics</code></td>
<td>GET</td>
<td>Abstention event stats</td>
</tr>
<tr>
<td><code>/batching/statistics</code></td>
<td>GET</td>
<td>Batch metrics</td>
</tr>
<tr>
<td><code>/rate-limits</code></td>
<td>GET</td>
<td>Rate limit configs</td>
</tr>
<tr>
<td><code>/rate-limits/:scope</code></td>
<td>PUT</td>
<td>Update rate limit</td>
</tr>
<tr>
<td><code>/escalation-chains</code></td>
<td>GET/POST</td>
<td>Manage escalation chains</td>
</tr>
<tr>
<td><code>/deduplication/statistics</code></td>
<td>GET</td>
<td>Cache statistics</td>
</tr>
<tr>
<td><code>/deduplication/invalidate</code></td>
<td>POST</td>
<td>Invalidate cache entries</td>
</tr>
</tbody>
</table>
<h4 id="database-tables-2">Database Tables</h4>
<pre class="sql"><code>-- HITL Orchestration Tables (v5.33.0)
hitl_question_batches      -- Question batch records
hitl_rate_limits           -- Rate limit configuration
hitl_question_cache        -- Deduplication cache
hitl_voi_aspects           -- VOI aspect tracking
hitl_voi_decisions         -- VOI decision records
hitl_abstention_config     -- Abstention settings
hitl_abstention_events     -- Abstention event log
hitl_escalation_chains     -- Escalation chain configuration</code></pre>
<h4 id="key-metrics">Key Metrics</h4>
<ul>
<li><strong>70% fewer unnecessary questions</strong> via VOI filtering</li>
<li><strong>2.7x faster user response times</strong> via batching</li>
<li><strong>Two-question rule enforcement</strong> for workflow completion</li>
</ul>
<h3 id="hitl-orchestration-extensions-v5.34.0">5.3.1 HITL Orchestration Extensions (v5.34.0)</h3>
<p>Scout persona integration, Flyte task wrappers, and semantic deduplication.</p>
<p><strong>Philosophy</strong>: â€œScout asks smart questions. Flyte workflows pause elegantly. Similar questions share answers.â€</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cato/scout-hitl-integration.service.ts</code></td>
<td>Bridges Scout persona to HITL for epistemic uncertainty</td>
</tr>
<tr>
<td><code>packages/flyte/utils/hitl_tasks.py</code></td>
<td>Python wrappers for Flyte HITL tasks</td>
</tr>
</tbody>
</table>
<p><strong>Scout Integration Features:</strong> - Aspect-prioritized clarification questions (safety, compliance, cost, etc.) - Domain-specific impact scoring with boosts - VOI-filtered questions with assumption generation - Remaining uncertainty calculation</p>
<p><strong>Flyte Task Wrappers:</strong> - <code>ask_confirmation()</code> - Blocking yes/no questions - <code>ask_choice()</code> - Single/multiple choice selection - <code>ask_batch()</code> - Batched questions with VOI filtering - <code>ask_free_text()</code> - Free-form text input</p>
<p><strong>Semantic Deduplication (pgvector):</strong> - 1536-dimension embeddings for question matching - HNSW index for efficient cosine similarity search - 85% similarity threshold (configurable) - Graceful fallback to hash-based matching</p>
<p><strong>Migration:</strong> <code>V2026_01_20_012__hitl_semantic_deduplication.sql</code></p>
<h3 id="governance-presets-war-room-v5.35.0">5.3.2 Governance Presets &amp; War Room (v5.35.0)</h3>
<p>Variable friction governance and Council of Rivals visualization.</p>
<p><strong>Philosophy</strong>: â€œThe Leash Metaphorâ€”give users intuitive control over AI autonomy without exposing technical complexity.â€</p>
<h4 id="governance-presets-variable-friction">Governance Presets (Variable Friction)</h4>
<p>User-friendly abstraction over technical Moods:</p>
<table>
<thead>
<tr>
<th>Preset</th>
<th>Leash Length</th>
<th>Maps to Mood</th>
<th>Friction Level</th>
</tr>
</thead>
<tbody>
<tr>
<td>ğŸ›¡ï¸ <strong>Paranoid</strong></td>
<td>Short</td>
<td>Scout</td>
<td>1.0</td>
</tr>
<tr>
<td>âš–ï¸ <strong>Balanced</strong></td>
<td>Medium</td>
<td>Balanced</td>
<td>0.5</td>
</tr>
<tr>
<td>ğŸš€ <strong>Cowboy</strong></td>
<td>Long</td>
<td>Spark</td>
<td>0.1</td>
</tr>
</tbody>
</table>
<p><strong>Checkpoint Configuration (5 gates):</strong></p>
<table>
<thead>
<tr>
<th>Checkpoint</th>
<th>When</th>
<th>Paranoid</th>
<th>Balanced</th>
<th>Cowboy</th>
</tr>
</thead>
<tbody>
<tr>
<td>CP1</td>
<td>After Observer</td>
<td>ALWAYS</td>
<td>NEVER</td>
<td>NEVER</td>
</tr>
<tr>
<td>CP2</td>
<td>After Proposer</td>
<td>ALWAYS</td>
<td>CONDITIONAL</td>
<td>NEVER</td>
</tr>
<tr>
<td>CP3</td>
<td>After Critics</td>
<td>ALWAYS</td>
<td>CONDITIONAL</td>
<td>NEVER</td>
</tr>
<tr>
<td>CP4</td>
<td>Before Execution</td>
<td>ALWAYS</td>
<td>CONDITIONAL</td>
<td>CONDITIONAL</td>
</tr>
<tr>
<td>CP5</td>
<td>After Execution</td>
<td>ALWAYS</td>
<td>NOTIFY_ONLY</td>
<td>NOTIFY_ONLY</td>
</tr>
</tbody>
</table>
<p><strong>Checkpoint Modes:</strong> - <code>ALWAYS</code> - Require human approval - <code>CONDITIONAL</code> - Based on risk/confidence thresholds - <code>NEVER</code> - Auto-approve - <code>NOTIFY_ONLY</code> - Proceed but notify async</p>
<p><strong>Files:</strong> - <code>packages/shared/src/types/cato.types.ts</code> - GovernancePreset, CheckpointMode types - <code>lambda/shared/services/governance-preset.service.ts</code> - Preset management service - <code>lambda/admin/cato-governance.ts</code> - API handler (8 endpoints) - <code>apps/admin-dashboard/app/(dashboard)/cato/governance/page.tsx</code> - Admin UI</p>
<p><strong>API Endpoints:</strong></p>
<pre><code>GET  /api/admin/cato/governance/config      # Get tenant config
PUT  /api/admin/cato/governance/preset      # Set preset
PATCH /api/admin/cato/governance/overrides  # Custom overrides
GET  /api/admin/cato/governance/metrics     # Checkpoint metrics
GET  /api/admin/cato/governance/history     # Preset changes audit
POST /api/admin/cato/governance/checkpoint  # Record decision
GET  /api/admin/cato/governance/pending     # Pending checkpoints
POST /api/admin/cato/governance/resolve     # Resolve checkpoint</code></pre>
<p><strong>Migration:</strong> <code>V2026_01_20_013__governance_presets.sql</code></p>
<h4 id="war-room-council-of-rivals-visualization">War Room (Council of Rivals Visualization)</h4>
<p>Real-time multi-agent adversarial debate interface.</p>
<p><strong>Council Member Roles:</strong></p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Purpose</th>
<th>Icon</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Advocate</strong></td>
<td>Argues in favor</td>
<td>ğŸ‘</td>
</tr>
<tr>
<td><strong>Critic</strong></td>
<td>Identifies flaws</td>
<td>ğŸ‘</td>
</tr>
<tr>
<td><strong>Synthesizer</strong></td>
<td>Combines viewpoints</td>
<td>ğŸ§ </td>
</tr>
<tr>
<td><strong>Specialist</strong></td>
<td>Domain expertise</td>
<td>ğŸ’¡</td>
</tr>
<tr>
<td><strong>Contrarian</strong></td>
<td>Challenges assumptions</td>
<td>âš¡</td>
</tr>
</tbody>
</table>
<p><strong>Debate Flow:</strong></p>
<pre><code>Topic â†’ Opening â†’ Arguments â†’ Rebuttals â†’ Voting â†’ Verdict</code></pre>
<p><strong>Verdict Outcomes:</strong> <code>consensus</code>, <code>majority</code>, <code>split</code>, <code>deadlock</code>, <code>synthesized</code></p>
<p><strong>Files:</strong> - <code>lambda/shared/services/council-of-rivals.service.ts</code> - Core debate service - <code>apps/admin-dashboard/app/(dashboard)/cato/war-room/page.tsx</code> - War Room UI</p>
<p><strong>UI Features:</strong> - Amphitheater-style member avatars - Real-time debate transcript with live polling (2s) - Arguments with confidence bars and evidence badges - Rebuttals with strength indicators - Verdict panel with synthesized answers</p>
<h3 id="sovereign-mesh-services-v5.31.0">5.4 Sovereign Mesh Services (v5.31.0)</h3>
<p>Parametric AI assistance at every workflow node.</p>
<p><strong>Philosophy</strong>: â€œEvery Node Thinks. Every Connection Learns. Every Workflow Assembles Itself.â€</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sovereign-mesh/ai-helper.service.ts</code></td>
<td>Disambiguation, inference, recovery, validation</td>
</tr>
<tr>
<td><code>sovereign-mesh/agent-runtime.service.ts</code></td>
<td>OODA-loop agent execution</td>
</tr>
<tr>
<td><code>sovereign-mesh/notification.service.ts</code></td>
<td>Email/Slack/webhook notifications</td>
</tr>
<tr>
<td><code>sovereign-mesh/snapshot-capture.service.ts</code></td>
<td>Execution state snapshots</td>
</tr>
</tbody>
</table>
<p><strong>Worker Lambdas:</strong> - <code>workers/agent-execution-worker.ts</code> - SQS-triggered OODA processing - <code>workers/transparency-compiler.ts</code> - Pre-compute decision explanations</p>
<p><strong>Scheduled Lambdas:</strong> - <code>app-registry-sync</code> - Daily sync from Activepieces/n8n (2 AM UTC) - <code>hitl-sla-monitor</code> - SLA monitoring and escalation (every minute) - <code>app-health-check</code> - Hourly health check for top 100 apps</p>
<h3 id="sovereign-mesh-performance-optimization-v5.38.0">5.4.1 Sovereign Mesh Performance Optimization (v5.38.0)</h3>
<p>Scale-ready execution infrastructure for autonomous agent workloads.</p>
<p><strong>Philosophy</strong>: â€œEvery execution tracked. Every bottleneck visible. Every setting tunable.â€</p>
<h4 id="architecture-diagram">Architecture Diagram</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOVEREIGN MESH PERFORMANCE LAYER                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ SQS Queues   â”‚â”€â”€â”€â–¶â”‚ Lambda Workers  â”‚â”€â”€â”€â–¶â”‚ Redis Cache        â”‚         â”‚
â”‚  â”‚ (Per-tenant) â”‚    â”‚ (50 concurrent) â”‚    â”‚ (Agent/Execution)  â”‚         â”‚
â”‚  â”‚ FIFO/Std     â”‚    â”‚ 2048MB/15min    â”‚    â”‚ 5min/1hr/24hr TTL  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                    â”‚                       â”‚                      â”‚
â”‚         â–¼                    â–¼                       â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ DLQ + Alerts â”‚    â”‚ S3 Archival     â”‚    â”‚ Performance DB     â”‚         â”‚
â”‚  â”‚ (10 threshold)â”‚   â”‚ (Hybrid/Gzip)   â”‚    â”‚ (BRIN indexed)     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        ADMIN DASHBOARD                                â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚Overview â”‚ â”‚ Scaling â”‚ â”‚ Caching â”‚ â”‚ Alerts  â”‚ â”‚ Recommendations â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="configurable-settings-all-persistent-in-database">Configurable Settings (All Persistent in Database)</h4>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 24%" />
<col style="width: 15%" />
<col style="width: 12%" />
<col style="width: 32%" />
</colgroup>
<thead>
<tr>
<th>Setting</th>
<th>Table Column</th>
<th>Default</th>
<th>Range</th>
<th>Admin UI Location</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Lambda Settings</strong></td>
<td></td>
<td></td>
<td></td>
<td>Scaling Tab</td>
</tr>
<tr>
<td>Max Concurrency</td>
<td><code>agent_worker_config.max_concurrency</code></td>
<td>50</td>
<td>1-200</td>
<td>Slider</td>
</tr>
<tr>
<td>Provisioned Concurrency</td>
<td><code>agent_worker_config.provisioned_concurrency</code></td>
<td>5</td>
<td>0-50</td>
<td>Slider</td>
</tr>
<tr>
<td>Memory (MB)</td>
<td><code>agent_worker_config.memory_mb</code></td>
<td>2048</td>
<td>512-4096</td>
<td>Dropdown</td>
</tr>
<tr>
<td>Timeout (sec)</td>
<td><code>agent_worker_config.timeout_seconds</code></td>
<td>900</td>
<td>60-900</td>
<td>Input</td>
</tr>
<tr>
<td>Reserved Concurrency</td>
<td><code>agent_worker_config.reserved_concurrency</code></td>
<td>100</td>
<td>0-1000</td>
<td>Input</td>
</tr>
<tr>
<td><strong>SQS Settings</strong></td>
<td></td>
<td></td>
<td></td>
<td>Scaling Tab</td>
</tr>
<tr>
<td>Batch Size</td>
<td><code>sqs_config.batch_size</code></td>
<td>1</td>
<td>1-10</td>
<td>Dropdown</td>
</tr>
<tr>
<td>Visibility Timeout</td>
<td><code>sqs_config.visibility_timeout_seconds</code></td>
<td>900</td>
<td>30-43200</td>
<td>Input</td>
</tr>
<tr>
<td>Message Retention</td>
<td><code>sqs_config.message_retention_days</code></td>
<td>4</td>
<td>1-14</td>
<td>Input</td>
</tr>
<tr>
<td>DLQ Max Receives</td>
<td><code>sqs_config.dlq_max_receive_count</code></td>
<td>3</td>
<td>1-10</td>
<td>Input</td>
</tr>
<tr>
<td><strong>Scaling Settings</strong></td>
<td></td>
<td></td>
<td></td>
<td>Scaling Tab</td>
</tr>
<tr>
<td>Strategy</td>
<td><code>scaling_config.strategy</code></td>
<td>auto</td>
<td>fixed/auto/scheduled</td>
<td>Dropdown</td>
</tr>
<tr>
<td>Min Instances</td>
<td><code>scaling_config.min_instances</code></td>
<td>0</td>
<td>0-50</td>
<td>Slider</td>
</tr>
<tr>
<td>Max Instances</td>
<td><code>scaling_config.max_instances</code></td>
<td>50</td>
<td>1-200</td>
<td>Slider</td>
</tr>
<tr>
<td>Target Utilization</td>
<td><code>scaling_config.target_utilization</code></td>
<td>70</td>
<td>50-95</td>
<td>Slider</td>
</tr>
<tr>
<td>Scale-in Cooldown</td>
<td><code>scaling_config.scale_in_cooldown_seconds</code></td>
<td>300</td>
<td>60-900</td>
<td>Input</td>
</tr>
<tr>
<td>Scale-out Cooldown</td>
<td><code>scaling_config.scale_out_cooldown_seconds</code></td>
<td>60</td>
<td>30-300</td>
<td>Input</td>
</tr>
<tr>
<td><strong>Cache Settings</strong></td>
<td></td>
<td></td>
<td></td>
<td>Caching Tab</td>
</tr>
<tr>
<td>Backend</td>
<td><code>caching_config.backend</code></td>
<td>redis</td>
<td>memory/redis</td>
<td>Toggle</td>
</tr>
<tr>
<td>Agent TTL (sec)</td>
<td><code>caching_config.agent_ttl_seconds</code></td>
<td>300</td>
<td>60-3600</td>
<td>Slider</td>
</tr>
<tr>
<td>Execution TTL (sec)</td>
<td><code>caching_config.execution_ttl_seconds</code></td>
<td>3600</td>
<td>300-86400</td>
<td>Slider</td>
</tr>
<tr>
<td>Working Memory TTL</td>
<td><code>caching_config.working_memory_ttl_seconds</code></td>
<td>86400</td>
<td>3600-604800</td>
<td>Slider</td>
</tr>
<tr>
<td>Max Memory (MB)</td>
<td><code>caching_config.max_memory_mb</code></td>
<td>256</td>
<td>64-2048</td>
<td>Input</td>
</tr>
<tr>
<td>Eviction Policy</td>
<td><code>caching_config.eviction_policy</code></td>
<td>lru</td>
<td>lru/lfu/ttl</td>
<td>Dropdown</td>
</tr>
<tr>
<td><strong>Tenant Isolation</strong></td>
<td></td>
<td></td>
<td></td>
<td>Scaling Tab</td>
</tr>
<tr>
<td>Mode</td>
<td><code>tenant_isolation_config.mode</code></td>
<td>shared</td>
<td>shared/dedicated/fifo</td>
<td>Dropdown</td>
</tr>
<tr>
<td>Max Per Tenant</td>
<td><code>tenant_isolation_config.max_concurrent_per_tenant</code></td>
<td>50</td>
<td>1-100</td>
<td>Slider</td>
</tr>
<tr>
<td>Max Per User</td>
<td><code>tenant_isolation_config.max_concurrent_per_user</code></td>
<td>10</td>
<td>1-25</td>
<td>Slider</td>
</tr>
<tr>
<td>Rate Limiting</td>
<td><code>tenant_isolation_config.rate_limiting_enabled</code></td>
<td>true</td>
<td>boolean</td>
<td>Switch</td>
</tr>
<tr>
<td><strong>Archival Settings</strong></td>
<td></td>
<td></td>
<td></td>
<td>(Future UI)</td>
</tr>
<tr>
<td>Storage Backend</td>
<td><code>archival_config.storage_backend</code></td>
<td>hybrid</td>
<td>database/s3/hybrid</td>
<td>Dropdown</td>
</tr>
<tr>
<td>Archive After Days</td>
<td><code>archival_config.archive_after_days</code></td>
<td>7</td>
<td>1-30</td>
<td>Input</td>
</tr>
<tr>
<td>Delete After Days</td>
<td><code>archival_config.delete_after_days</code></td>
<td>90</td>
<td>0-365</td>
<td>Input</td>
</tr>
<tr>
<td>Max DB Bytes</td>
<td><code>archival_config.max_db_artifact_bytes</code></td>
<td>65536</td>
<td>1024-1048576</td>
<td>Input</td>
</tr>
<tr>
<td>Compression</td>
<td><code>archival_config.compression_algorithm</code></td>
<td>gzip</td>
<td>none/gzip/lz4/zstd</td>
<td>Dropdown</td>
</tr>
<tr>
<td><strong>Alert Thresholds</strong></td>
<td></td>
<td></td>
<td></td>
<td>Alerts Tab</td>
</tr>
<tr>
<td>DLQ Alert Enabled</td>
<td><code>alert_config.dlq_alert_enabled</code></td>
<td>true</td>
<td>boolean</td>
<td>Switch</td>
</tr>
<tr>
<td>DLQ Threshold</td>
<td><code>alert_config.dlq_alert_threshold</code></td>
<td>10</td>
<td>1-100</td>
<td>Slider</td>
</tr>
<tr>
<td>Latency Alert Enabled</td>
<td><code>alert_config.latency_alert_enabled</code></td>
<td>true</td>
<td>boolean</td>
<td>Switch</td>
</tr>
<tr>
<td>Latency Threshold (ms)</td>
<td><code>alert_config.latency_alert_threshold_ms</code></td>
<td>30000</td>
<td>5000-120000</td>
<td>Slider</td>
</tr>
<tr>
<td>Error Rate Alert</td>
<td><code>alert_config.error_rate_alert_enabled</code></td>
<td>true</td>
<td>boolean</td>
<td>Switch</td>
</tr>
<tr>
<td>Error Rate Threshold</td>
<td><code>alert_config.error_rate_threshold</code></td>
<td>0.05</td>
<td>0.01-0.50</td>
<td>Slider</td>
</tr>
<tr>
<td>Budget Alert</td>
<td><code>alert_config.budget_alert_enabled</code></td>
<td>true</td>
<td>boolean</td>
<td>Switch</td>
</tr>
<tr>
<td>Budget Threshold</td>
<td><code>alert_config.budget_alert_threshold</code></td>
<td>0.80</td>
<td>0.50-0.95</td>
<td>Slider</td>
</tr>
</tbody>
</table>
<h4 id="estimated-max-concurrent-sessions">Estimated Max Concurrent Sessions</h4>
<p>Based on current configuration:</p>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 44%" />
<col style="width: 17%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Calculation</th>
<th>Max</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Lambda Concurrency</strong></td>
<td>Reserved (100) Ã— Provisioned (5) warm</td>
<td><strong>100 concurrent</strong></td>
</tr>
<tr>
<td><strong>SQS Throughput</strong></td>
<td>3,000 msg/sec standard queue</td>
<td><strong>180,000/min</strong></td>
</tr>
<tr>
<td><strong>Redis Connections</strong></td>
<td>ElastiCache r6g.large = 65,000</td>
<td><strong>65,000 cached</strong></td>
</tr>
<tr>
<td><strong>API Gateway</strong></td>
<td>Regional: 10,000 RPS default</td>
<td><strong>10,000 RPS</strong></td>
</tr>
<tr>
<td><strong>Database Connections</strong></td>
<td>Aurora r6g.large = 1,000 pooled</td>
<td><strong>1,000 active</strong></td>
</tr>
</tbody>
</table>
<p><strong>Theoretical Maximum API Sessions</strong>: - <strong>Sustained</strong>: ~10,000 concurrent sessions (API Gateway limit) - <strong>Burst</strong>: ~50,000 concurrent (with Lambda scaling + SQS buffering) - <strong>With Dedicated Queues</strong>: ~100,000 (per-tenant isolation)</p>
<p><strong>Bottleneck Analysis</strong>: 1. API Gateway: 10,000 RPS (can request increase to 100,000) 2. Lambda Concurrency: 100 reserved â†’ Scale to 1,000+ 3. Database: Aurora Serverless v2 scales to 256 ACUs (25,600 connections)</p>
<h4 id="services">Services</h4>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 25%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>SQS Dispatcher</td>
<td><code>sqs-dispatcher.service.ts</code></td>
<td>Message dispatch with tenant routing</td>
</tr>
<tr>
<td>Redis Cache</td>
<td><code>redis-cache.service.ts</code></td>
<td>Agent/execution caching with fallback</td>
</tr>
<tr>
<td>Performance Config</td>
<td><code>performance-config.service.ts</code></td>
<td>CRUD, recommendations, alerts</td>
</tr>
<tr>
<td>Artifact Archival</td>
<td><code>artifact-archival.service.ts</code></td>
<td>S3/hybrid storage with compression</td>
</tr>
</tbody>
</table>
<h4 id="api-endpoints">API Endpoints</h4>
<p>Base: <code>/api/admin/sovereign-mesh/performance</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dashboard</code></td>
<td>GET</td>
<td>Complete dashboard (health, metrics, alerts)</td>
</tr>
<tr>
<td><code>/config</code></td>
<td>GET</td>
<td>Get current configuration</td>
</tr>
<tr>
<td><code>/config</code></td>
<td>PUT/PATCH</td>
<td>Update configuration</td>
</tr>
<tr>
<td><code>/recommendations</code></td>
<td>GET</td>
<td>AI-generated recommendations</td>
</tr>
<tr>
<td><code>/recommendations/:id/apply</code></td>
<td>POST</td>
<td>Apply recommendation</td>
</tr>
<tr>
<td><code>/alerts</code></td>
<td>GET</td>
<td>Active alerts</td>
</tr>
<tr>
<td><code>/alerts/:id/acknowledge</code></td>
<td>POST</td>
<td>Acknowledge alert</td>
</tr>
<tr>
<td><code>/alerts/:id/resolve</code></td>
<td>POST</td>
<td>Resolve alert</td>
</tr>
<tr>
<td><code>/cache/stats</code></td>
<td>GET</td>
<td>Cache statistics</td>
</tr>
<tr>
<td><code>/cache</code></td>
<td>DELETE</td>
<td>Clear tenant cache</td>
</tr>
<tr>
<td><code>/queue/metrics</code></td>
<td>GET</td>
<td>Queue metrics</td>
</tr>
<tr>
<td><code>/health</code></td>
<td>GET</td>
<td>Health check</td>
</tr>
</tbody>
</table>
<h4 id="database-tables-3">Database Tables</h4>
<pre class="sql"><code>-- Core Configuration (persistent settings)
sovereign_mesh_performance_config (
  tenant_id UUID PRIMARY KEY,
  agent_worker_config JSONB,      -- Lambda settings
  transparency_worker_config JSONB,
  sqs_config JSONB,               -- Queue settings
  scaling_config JSONB,           -- Autoscaling
  caching_config JSONB,           -- Redis/memory
  archival_config JSONB,          -- S3 archival
  db_optimization_config JSONB,   -- Connection pooling
  tenant_isolation_config JSONB,  -- Rate limiting
  alert_config JSONB,             -- Alert thresholds
  created_at, updated_at
);

-- Alerts
sovereign_mesh_performance_alerts (
  id, tenant_id, alert_type, severity, message,
  triggered_at, acknowledged_at, acknowledged_by,
  resolved_at, resolved_by, auto_resolved
);

-- Time-Series Metrics (BRIN indexed)
sovereign_mesh_performance_metrics (
  id, tenant_id, metric_time, metric_type, metric_value,
  dimensions JSONB, tags TEXT[]
);

-- Artifact Archives
sovereign_mesh_artifact_archives (
  id, tenant_id, execution_id, snapshot_id,
  storage_backend, s3_bucket, s3_key,
  artifact_type, original_size_bytes, compressed_size_bytes,
  compression_algorithm, checksum_sha256,
  archived_at, expires_at, deleted_at
);

-- Tenant Queues
sovereign_mesh_tenant_queues (
  tenant_id, queue_type, queue_url, queue_arn,
  is_fifo, created_at, last_used_at
);

-- Rate Limits
sovereign_mesh_rate_limits (
  tenant_id, user_id, window_start,
  execution_count, last_execution_at
);

-- Config History (audit trail)
sovereign_mesh_config_history (
  id, tenant_id, changed_by, changed_at,
  change_type, previous_value, new_value
);</code></pre>
<h4 id="key-performance-indexes">Key Performance Indexes</h4>
<pre class="sql"><code>-- Fast execution queries
CREATE INDEX idx_agent_executions_tenant_status ON agent_executions(tenant_id, status);
CREATE INDEX idx_agent_executions_agent_status ON agent_executions(agent_id, status);
CREATE INDEX idx_agent_executions_created_at ON agent_executions(created_at DESC);

-- Partial index for running executions only
CREATE INDEX idx_agent_executions_running ON agent_executions(tenant_id, started_at) 
  WHERE status = &#39;running&#39;;

-- BRIN index for time-series (efficient for append-only)
CREATE INDEX idx_perf_metrics_tenant_time ON sovereign_mesh_performance_metrics 
  USING BRIN (tenant_id, metric_time);</code></pre>
<h4 id="admin-dashboard-ui">Admin Dashboard UI</h4>
<p>Location: <code>apps/admin-dashboard/app/(dashboard)/sovereign-mesh/performance/page.tsx</code></p>
<p><strong>5 Tabs</strong>: 1. <strong>Overview</strong>: Health score, active/pending executions, queue depth, cache hit rate, OODA timing, cost estimate 2. <strong>Scaling</strong>: Lambda concurrency sliders, tenant isolation mode, rate limits 3. <strong>Caching</strong>: Cache backend, TTLs, statistics, clear cache action 4. <strong>Alerts</strong>: DLQ/latency/error/budget thresholds, active alerts with acknowledge/resolve 5. <strong>Recommendations</strong>: AI-generated optimizations with one-click apply</p>
<h3 id="infrastructure-scaling-system-v5.38.0">5.4.2 Infrastructure Scaling System (v5.38.0)</h3>
<p>Scale from 100 to 500,000+ concurrent sessions with cost-aware tier selection.</p>
<p><strong>Philosophy</strong>: â€œPay only for what you need. Scale instantly when you need more.â€</p>
<h4 id="scaling-tiers">Scaling Tiers</h4>
<table>
<thead>
<tr>
<th>Tier</th>
<th>Sessions</th>
<th>Monthly Cost</th>
<th>Infrastructure</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Development</strong></td>
<td>100</td>
<td>$70</td>
<td>Scale-to-zero, minimal resources</td>
</tr>
<tr>
<td><strong>Staging</strong></td>
<td>1,000</td>
<td>$500</td>
<td>Basic redundancy</td>
</tr>
<tr>
<td><strong>Production</strong></td>
<td>10,000</td>
<td>$5,000</td>
<td>High availability</td>
</tr>
<tr>
<td><strong>Enterprise</strong></td>
<td>500,000</td>
<td>$68,500</td>
<td>Multi-region, global scale</td>
</tr>
</tbody>
</table>
<h4 id="architecture-diagram-1">Architecture Diagram</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     INFRASTRUCTURE SCALING SYSTEM                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        TIER SELECTION                                   â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚ â”‚
â”‚  â”‚  â”‚   DEV   â”‚  â”‚ STAGING â”‚  â”‚  PROD   â”‚  â”‚ ENTERPRISE  â”‚               â”‚ â”‚
â”‚  â”‚  â”‚  100    â”‚  â”‚  1,000  â”‚  â”‚ 10,000  â”‚  â”‚   500,000   â”‚               â”‚ â”‚
â”‚  â”‚  â”‚  $70/mo â”‚  â”‚ $500/mo â”‚  â”‚ $5K/mo  â”‚  â”‚   $68K/mo   â”‚               â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      COMPONENT CONFIGURATION                            â”‚ â”‚
â”‚  â”‚                                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Lambda  â”‚  â”‚  Aurora  â”‚  â”‚  Redis   â”‚  â”‚   API    â”‚  â”‚   SQS    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ 0-1000   â”‚  â”‚ 0.5-256  â”‚  â”‚ 1-10     â”‚  â”‚ 100-100K â”‚  â”‚ 2-100    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ conc.    â”‚  â”‚ ACU      â”‚  â”‚ shards   â”‚  â”‚ RPS      â”‚  â”‚ queues   â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                               â”‚
â”‚                              â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       COST ESTIMATION                                   â”‚ â”‚
â”‚  â”‚  Lambda: $X + Aurora: $Y + Redis: $Z + API: $A + SQS: $B = Total       â”‚ â”‚
â”‚  â”‚  Cost per session: $Total / MaxSessions                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="component-configuration-by-tier">Component Configuration by Tier</h4>
<table>
<thead>
<tr>
<th>Component</th>
<th>Development</th>
<th>Staging</th>
<th>Production</th>
<th>Enterprise</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Lambda Reserved</strong></td>
<td>0</td>
<td>10</td>
<td>100</td>
<td>1,000</td>
</tr>
<tr>
<td><strong>Lambda Provisioned</strong></td>
<td>0</td>
<td>0</td>
<td>5</td>
<td>100</td>
</tr>
<tr>
<td><strong>Lambda Max</strong></td>
<td>10</td>
<td>50</td>
<td>200</td>
<td>1,000</td>
</tr>
<tr>
<td><strong>Lambda Memory</strong></td>
<td>1024 MB</td>
<td>2048 MB</td>
<td>2048 MB</td>
<td>3072 MB</td>
</tr>
<tr>
<td><strong>Aurora Min ACU</strong></td>
<td>0.5</td>
<td>1</td>
<td>4</td>
<td>16</td>
</tr>
<tr>
<td><strong>Aurora Max ACU</strong></td>
<td>2</td>
<td>8</td>
<td>64</td>
<td>256</td>
</tr>
<tr>
<td><strong>Aurora Replicas</strong></td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td><strong>Aurora Global</strong></td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes (5 regions)</td>
</tr>
<tr>
<td><strong>Redis Node</strong></td>
<td>t4g.micro</td>
<td>t4g.small</td>
<td>r6g.large</td>
<td>r6g.xlarge</td>
</tr>
<tr>
<td><strong>Redis Shards</strong></td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>10</td>
</tr>
<tr>
<td><strong>Redis Cluster</strong></td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>API Rate Limit</strong></td>
<td>100</td>
<td>1,000</td>
<td>10,000</td>
<td>100,000</td>
</tr>
<tr>
<td><strong>CloudFront</strong></td>
<td>No</td>
<td>No</td>
<td>Yes</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>SQS Standard</strong></td>
<td>2</td>
<td>5</td>
<td>10</td>
<td>50</td>
</tr>
<tr>
<td><strong>SQS FIFO</strong></td>
<td>0</td>
<td>2</td>
<td>5</td>
<td>50</td>
</tr>
</tbody>
</table>
<h4 id="cost-calculation-formula">Cost Calculation Formula</h4>
<pre class="typescript"><code>// Lambda provisioned concurrency
lambdaCost = provisionedConcurrency Ã— (memoryMb / 1024) Ã— 0.000004167 Ã— 3600 Ã— 24 Ã— 30;

// Aurora (average ACU)
auroraCost = ((minAcu + maxAcu) / 2) Ã— 0.12 Ã— 24 Ã— 30 Ã— (1 + replicas Ã— 0.5);

// Redis
redisCost = nodePrice Ã— 24 Ã— 30 Ã— numShards Ã— (1 + replicasPerShard);

// API Gateway (estimated 10% utilization)
apiCost = (rateLimit Ã— 0.1 Ã— 3600 Ã— 24 Ã— 30 / 1e6) Ã— 1.00;

// Total
totalMonthlyCost = lambdaCost + auroraCost + redisCost + apiCost + sqsCost + cloudFrontCost;
costPerSession = totalMonthlyCost / maxSessions;</code></pre>
<h4 id="session-capacity-calculation">Session Capacity Calculation</h4>
<pre class="typescript"><code>const capacities = {
  lambda: maxConcurrency Ã— 10,           // 10 sessions per concurrent execution
  aurora: connectionPoolSize Ã— 50,        // 50 sessions per connection
  redis: maxConnections,                  // Direct connection limit
  apiGateway: throttlingRateLimit,        // RPS limit
};

const maxSessions = Math.min(...Object.values(capacities));
const bottleneck = Object.entries(capacities)
  .find(([_, v]) =&gt; v === maxSessions)?.[0];</code></pre>
<h4 id="services-1">Services</h4>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 25%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Scaling Service</td>
<td><code>scaling.service.ts</code></td>
<td>Profile management, cost calculation</td>
</tr>
<tr>
<td>Session Metrics</td>
<td><code>scaling.service.ts</code></td>
<td>Real-time session tracking</td>
</tr>
<tr>
<td>Cost Estimator</td>
<td><code>scaling.service.ts</code></td>
<td>AWS pricing calculations</td>
</tr>
</tbody>
</table>
<h4 id="api-endpoints-1">API Endpoints</h4>
<p>Base: <code>/api/admin/sovereign-mesh/scaling</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/dashboard</code></td>
<td>GET</td>
<td>Complete scaling dashboard</td>
</tr>
<tr>
<td><code>/profiles</code></td>
<td>GET</td>
<td>List all profiles</td>
</tr>
<tr>
<td><code>/profiles/:id/apply</code></td>
<td>POST</td>
<td>Apply profile</td>
</tr>
<tr>
<td><code>/sessions</code></td>
<td>GET</td>
<td>Session metrics</td>
</tr>
<tr>
<td><code>/sessions/capacity</code></td>
<td>GET</td>
<td>Capacity info</td>
</tr>
<tr>
<td><code>/cost</code></td>
<td>GET</td>
<td>Current cost estimate</td>
</tr>
<tr>
<td><code>/cost/estimate</code></td>
<td>POST</td>
<td>Estimate custom config</td>
</tr>
<tr>
<td><code>/presets/:tier/apply</code></td>
<td>POST</td>
<td>Apply preset tier</td>
</tr>
</tbody>
</table>
<h4 id="database-tables-4">Database Tables</h4>
<pre class="sql"><code>-- Scaling profiles
sovereign_mesh_scaling_profiles (
  id, tenant_id, name, tier, target_sessions,
  lambda_*, aurora_*, redis_*, api_*, sqs_*,
  estimated_monthly_cost, is_active
);

-- Session metrics (1-minute granularity)
sovereign_mesh_session_metrics (
  tenant_id, metric_time, active_sessions, pending_sessions,
  sessions_by_region JSONB, utilization_percent
);

-- Hourly aggregates
sovereign_mesh_session_metrics_hourly (
  tenant_id, hour_start, total_sessions, peak_concurrent,
  lambda_cost, aurora_cost, redis_cost, total_cost
);

-- Scaling operations
sovereign_mesh_scaling_operations (
  id, tenant_id, operation_type, status,
  source_profile_id, target_profile_id, changes JSONB
);

-- Cost records
sovereign_mesh_cost_records (
  tenant_id, record_date, lambda_cost, aurora_cost, ...,
  total_cost, sessions_count, cost_per_session
);</code></pre>
<h4 id="admin-dashboard-ui-1">Admin Dashboard UI</h4>
<p>Location: <code>apps/admin-dashboard/app/(dashboard)/sovereign-mesh/scaling/page.tsx</code></p>
<p><strong>5 Tabs</strong>: 1. <strong>Overview</strong>: Active sessions, peak, bottleneck, cost/session, component health 2. <strong>Sessions</strong>: Capacity gauge, statistics, per-component limits 3. <strong>Infrastructure</strong>: Lambda/Aurora/Redis/API Gateway configuration cards 4. <strong>Cost</strong>: Component breakdown, cost metrics, annual estimate 5. <strong>Scale</strong>: One-click tier selection, comparison, change list</p>
<h3 id="gateway-services-v5.28.0-5.29.0">5.5 Gateway Services (v5.28.0-5.29.0)</h3>
<p>Multi-protocol WebSocket/SSE gateway for 1M+ concurrent connections.</p>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 37%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Technology</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Go Gateway</td>
<td>Go 1.22 + gobwas/ws</td>
<td>WebSocket termination, 100K+ connections/instance</td>
</tr>
<tr>
<td>Egress Proxy</td>
<td>Node.js + HTTP/2</td>
<td>Connection pooling to AI providers</td>
</tr>
<tr>
<td>NATS JetStream</td>
<td>NATS 2.10</td>
<td>Message broker with INBOX + HISTORY streams</td>
</tr>
</tbody>
</table>
<p><strong>Files:</strong> - <code>apps/gateway/</code> - Go gateway service (12 files) - <code>services/egress-proxy/</code> - HTTP/2 proxy service (5 files) - <code>lambda/admin/gateway.ts</code> - Gateway admin API</p>
<p><strong>Supported Protocols:</strong> MCP, A2A, OpenAI, Anthropic, Google</p>
<h3 id="code-quality-services-v5.30.0">5.6 Code Quality Services (v5.30.0)</h3>
<p>Test coverage, technical debt, and code quality monitoring.</p>
<table>
<colgroup>
<col style="width: 52%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/admin/code-quality/dashboard</code></td>
<td>Coverage, debt, JSON safety metrics</td>
</tr>
<tr>
<td><code>/api/admin/code-quality/coverage</code></td>
<td>Component-level coverage breakdown</td>
</tr>
<tr>
<td><code>/api/admin/code-quality/debt</code></td>
<td>Technical debt items</td>
</tr>
<tr>
<td><code>/api/admin/code-quality/alerts</code></td>
<td>Quality regression alerts</td>
</tr>
</tbody>
</table>
<p><strong>Files:</strong> - <code>lambda/admin/code-quality.ts</code> - Admin API handler - <code>apps/admin-dashboard/app/(dashboard)/code-quality/page.tsx</code> - Dashboard UI</p>
<hr />
<h2 id="cdk-stack-architecture">6. CDK Stack Architecture</h2>
<h3 id="stack-dependency-graph">6.1 Stack Dependency Graph</h3>
<pre><code>FoundationStack
    â””â”€â”€ NetworkingStack
        â””â”€â”€ SecurityStack
            â”œâ”€â”€ DataStack
            â”œâ”€â”€ StorageStack
            â””â”€â”€ AuthStack
                â”œâ”€â”€ AIStack
                â”œâ”€â”€ ApiStack (411 resources)
                â”œâ”€â”€ AdminStack
                â”œâ”€â”€ ThinkTankAdminApiStack
                â”œâ”€â”€ ThinkTankAuthStack
                â”œâ”€â”€ BrainStack (Tier 3+)
                â”œâ”€â”€ CatoRedisStack (Tier 2+)
                â”œâ”€â”€ CatoGenesisStack
                â”œâ”€â”€ CatoTierTransitionStack
                â”œâ”€â”€ ConsciousnessStack
                â”œâ”€â”€ CognitionStack
                â”œâ”€â”€ FormalReasoningStack
                â”œâ”€â”€ GrimoireStack
                â”œâ”€â”€ CollaborationStack
                â”œâ”€â”€ LibraryRegistryStack
                â”œâ”€â”€ LibraryExecutionStack
                â”œâ”€â”€ ScheduledTasksStack
                â”œâ”€â”€ SecurityMonitoringStack
                â”œâ”€â”€ MonitoringStack
                â”œâ”€â”€ WebhooksStack
                â”œâ”€â”€ UserRegistryStack
                â”œâ”€â”€ MissionControlStack
                â”œâ”€â”€ ModelSyncSchedulerStack
                â”œâ”€â”€ BatchStack
                â””â”€â”€ TMSStack</code></pre>
<h3 id="all-cdk-stacks-33-total">6.2 All CDK Stacks (33 total)</h3>
<table>
<colgroup>
<col style="width: 20%" />
<col style="width: 26%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Stack</th>
<th>Purpose</th>
<th>Tier Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>foundation-stack</code></td>
<td>Base infrastructure</td>
<td>All</td>
</tr>
<tr>
<td><code>networking-stack</code></td>
<td>VPC, subnets</td>
<td>All</td>
</tr>
<tr>
<td><code>security-stack</code></td>
<td>Security groups, KMS</td>
<td>All</td>
</tr>
<tr>
<td><code>data-stack</code></td>
<td>Aurora PostgreSQL</td>
<td>All</td>
</tr>
<tr>
<td><code>storage-stack</code></td>
<td>S3 buckets</td>
<td>All</td>
</tr>
<tr>
<td><code>auth-stack</code></td>
<td>Cognito user pools</td>
<td>All</td>
</tr>
<tr>
<td><code>ai-stack</code></td>
<td>LiteLLM, SageMaker</td>
<td>All</td>
</tr>
<tr>
<td><code>api-stack</code></td>
<td>API Gateway, Lambdas</td>
<td>All</td>
</tr>
<tr>
<td><code>admin-stack</code></td>
<td>Admin dashboard hosting</td>
<td>All</td>
</tr>
<tr>
<td><code>brain-stack</code></td>
<td>AGI Brain, SOFAI</td>
<td>Tier 3+</td>
</tr>
<tr>
<td><code>cato-redis-stack</code></td>
<td>ElastiCache Redis</td>
<td>Tier 2+</td>
</tr>
<tr>
<td><code>cato-genesis-stack</code></td>
<td>Cato safety architecture</td>
<td>All</td>
</tr>
<tr>
<td><code>cato-tier-transition-stack</code></td>
<td>Step Functions for tier changes</td>
<td>All</td>
</tr>
<tr>
<td><code>consciousness-stack</code></td>
<td>Consciousness services</td>
<td>Tier 3+</td>
</tr>
<tr>
<td><code>cognition-stack</code></td>
<td>Advanced cognition</td>
<td>Tier 3+</td>
</tr>
<tr>
<td><code>formal-reasoning-stack</code></td>
<td>Z3, RDFLib execution</td>
<td>Tier 3+</td>
</tr>
<tr>
<td><code>thinktank-auth-stack</code></td>
<td>Think Tank authentication</td>
<td>All</td>
</tr>
<tr>
<td><code>thinktank-admin-api-stack</code></td>
<td>Think Tank admin APIs</td>
<td>All</td>
</tr>
<tr>
<td><code>gateway-stack</code></td>
<td>Multi-protocol WebSocket/SSE gateway</td>
<td>All</td>
</tr>
<tr>
<td><code>sovereign-mesh-stack</code></td>
<td>Agent registry, app registry, AI helper</td>
<td>All</td>
</tr>
</tbody>
</table>
<h3 id="resource-limits">6.3 Resource Limits</h3>
<ul>
<li>CloudFormation max: <strong>500 resources per stack</strong></li>
<li>Current API stack: <strong>411 resources</strong></li>
<li>Strategy: Proxy routes, consolidated handlers</li>
</ul>
<hr />
<h2 id="security-compliance">7. Security &amp; Compliance</h2>
<h3 id="authentication">7.1 Authentication</h3>
<ul>
<li><strong>User auth</strong>: Cognito User Pools</li>
<li><strong>Admin auth</strong>: Separate Cognito pool with MFA</li>
<li><strong>API auth</strong>: JWT tokens via API Gateway authorizers</li>
</ul>
<h3 id="data-protection">7.2 Data Protection</h3>
<ul>
<li><strong>Encryption at rest</strong>: AES-256 (Aurora, S3)</li>
<li><strong>Encryption in transit</strong>: TLS 1.3</li>
<li><strong>Key management</strong>: AWS KMS</li>
</ul>
<h3 id="compliance-frameworks">7.3 Compliance Frameworks</h3>
<table>
<thead>
<tr>
<th>Framework</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td>HIPAA</td>
<td>PHI sanitization, audit logs</td>
</tr>
<tr>
<td>SOC 2 Type II</td>
<td>Continuous monitoring</td>
</tr>
<tr>
<td>FDA 21 CFR Part 11</td>
<td>Electronic signatures, audit trails</td>
</tr>
<tr>
<td>GDPR</td>
<td>Data portability, right to deletion</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="libraries-dependencies">8. Libraries &amp; Dependencies</h2>
<h3 id="core-typescript-dependencies">8.1 Core TypeScript Dependencies</h3>
<pre class="json"><code>{
  &quot;aws-cdk-lib&quot;: &quot;^2.170.0&quot;,
  &quot;aws-lambda&quot;: &quot;^1.0.7&quot;,
  &quot;@aws-sdk/client-*&quot;: &quot;^3.x&quot;,
  &quot;pg&quot;: &quot;^8.11.3&quot;,
  &quot;ioredis&quot;: &quot;^5.3.2&quot;,
  &quot;zod&quot;: &quot;^3.22.4&quot;
}</code></pre>
<h3 id="aiml-libraries">8.2 AI/ML Libraries</h3>
<pre class="json"><code>{
  &quot;openai&quot;: &quot;^4.x&quot;,
  &quot;@anthropic-ai/sdk&quot;: &quot;^0.x&quot;,
  &quot;@google/generative-ai&quot;: &quot;^0.x&quot;,
  &quot;litellm&quot;: &quot;proxy deployment&quot;
}</code></pre>
<h3 id="python-dependencies-lambda-layers">8.3 Python Dependencies (Lambda Layers)</h3>
<pre><code>z3-solver          # Formal verification
rdflib             # Knowledge graphs
owlrl              # OWL reasoning
pyshacl            # SHACL validation
pyreason           # Probabilistic reasoning
numpy              # Numerical computing
networkx           # Graph algorithms</code></pre>
<hr />
<h2 id="ai-report-writer-pro-v5.42.0">9. AI Report Writer Pro (v5.42.0)</h2>
<h3 id="overview-2">9.1 Overview</h3>
<p>The AI Report Writer is an enterprise-grade report generation system that combines natural language processing, voice input, interactive visualizations, AI-powered insights, and brand customization. Available in both RADIANT Admin and Think Tank Admin dashboards.</p>
<h3 id="architecture-1">9.2 Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AI Report Writer                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input Layer    â”‚  Natural Language Parser â† Text/Voice (Web Speech API)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Generation     â”‚  AI Model â†’ Structured Report (sections, charts, tables) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Visualization  â”‚  Recharts â†’ Bar, Line, Pie, Area (responsive)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Analysis       â”‚  Smart Insights Engine â†’ Anomalies, Trends, Recs         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Branding       â”‚  Brand Kit â†’ Logo, Colors, Fonts â†’ Styled Export         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Export         â”‚  PDF / Excel / HTML / Print                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="core-interfaces">9.3 Core Interfaces</h3>
<pre class="typescript"><code>interface GeneratedReport {
  title: string;
  subtitle?: string;
  executiveSummary?: string;
  sections: ReportSection[];
  charts?: ChartConfig[];
  tables?: TableConfig[];
  smartInsights?: SmartInsight[];
  metadata: { generatedAt: string; dataRange?: string; confidence: number };
}

interface SmartInsight {
  id: string;
  type: &#39;anomaly&#39; | &#39;trend&#39; | &#39;recommendation&#39; | &#39;warning&#39; | &#39;achievement&#39;;
  title: string;
  description: string;
  metric?: string;
  value?: string;
  change?: string;
  severity: &#39;low&#39; | &#39;medium&#39; | &#39;high&#39;;
  confidence: number;
}

interface BrandKit {
  logoUrl: string | null;
  primaryColor: string;
  secondaryColor: string;
  accentColor: string;
  fontFamily: string;
  headerFont: string;
  companyName: string;
  tagline: string;
}</code></pre>
<h3 id="interactive-charts">9.4 Interactive Charts</h3>
<p>Uses Recharts library with consistent 8-color palette:</p>
<pre class="typescript"><code>const CHART_COLORS = [
  &#39;#3b82f6&#39;, // Blue
  &#39;#10b981&#39;, // Emerald
  &#39;#f59e0b&#39;, // Amber
  &#39;#ef4444&#39;, // Red
  &#39;#8b5cf6&#39;, // Violet
  &#39;#ec4899&#39;, // Pink
  &#39;#06b6d4&#39;, // Cyan
  &#39;#84cc16&#39;, // Lime
];</code></pre>
<p><strong>Chart Types</strong>: - <code>RechartsBarChart</code> - Category comparisons with colored bars - <code>RechartsLineChart</code> - Time series with smooth curves - <code>RechartsPieChart</code> - Proportional data with donut style</p>
<h3 id="heatmap-visualization-components-v5.52.1">9.5 Heatmap Visualization Components (v5.52.1)</h3>
<p>Industry-leading heatmap implementations with unique differentiators.</p>
<h4 id="component-architecture">Component Architecture</h4>
<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Location</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ActivityHeatmap</code></td>
<td><code>apps/thinktank/components/ui/activity-heatmap.tsx</code></td>
<td>GitHub-style yearly activity</td>
</tr>
<tr>
<td><code>EnhancedActivityHeatmap</code></td>
<td><code>apps/thinktank/components/ui/enhanced-activity-heatmap.tsx</code></td>
<td>AI-powered with 10 differentiators</td>
</tr>
<tr>
<td><code>Heatmap</code></td>
<td><code>apps/admin-dashboard/components/charts/heatmap.tsx</code></td>
<td>Generic 2D grid</td>
</tr>
<tr>
<td><code>LatencyHeatmap</code></td>
<td><code>apps/admin-dashboard/components/geographic/latency-heatmap.tsx</code></td>
<td>AWS region latency map</td>
</tr>
<tr>
<td><code>CBFViolationsHeatmap</code></td>
<td><code>apps/admin-dashboard/components/analytics/cbf-violations-heatmap.tsx</code></td>
<td>Rule violation analytics</td>
</tr>
</tbody>
</table>
<h4 id="enhanced-activity-heatmap-technical-implementation">Enhanced Activity Heatmap Technical Implementation</h4>
<pre class="typescript"><code>// Breathing animation using requestAnimationFrame
useEffect(() =&gt; {
  if (!enableBreathing) return;
  let frame: number;
  const animate = (timestamp: number) =&gt; {
    const elapsed = (timestamp - start) / 1000;
    setBreathPhase(Math.sin(elapsed * 0.5) * 0.5 + 0.5); // 0-1 cycle
    frame = requestAnimationFrame(animate);
  };
  frame = requestAnimationFrame(animate);
  return () =&gt; cancelAnimationFrame(frame);
}, [enableBreathing]);

// AI insights generation
function generateAIInsights(data: ActivityDay[], streaks: Streak[]): AIInsight[] {
  // Pattern detection: weekday vs weekend
  // Streak achievement badges
  // Anomaly detection (3x+ average)
  // Trend predictions
}

// Sound feedback using Web Audio API
const playSound = (intensity: number) =&gt; {
  const ctx = new AudioContext();
  const osc = ctx.createOscillator();
  osc.frequency.value = 200 + intensity * 400;
  // Pitch varies with activity intensity
};</code></pre>
<h4 id="color-schemes">Color Schemes</h4>
<pre class="typescript"><code>const COLOR_SCHEMES = {
  violet: { levels: [&#39;#4c1d95&#39;, &#39;#6d28d9&#39;, &#39;#8b5cf6&#39;, &#39;#a78bfa&#39;, &#39;#c4b5fd&#39;], glow: &#39;rgba(139, 92, 246, 0.6)&#39; },
  green: { levels: [&#39;#0e4429&#39;, &#39;#006d32&#39;, &#39;#26a641&#39;, &#39;#39d353&#39;, &#39;#a6f8b0&#39;], glow: &#39;rgba(57, 211, 83, 0.6)&#39; },
  blue: { levels: [&#39;#1e3a5f&#39;, &#39;#2563eb&#39;, &#39;#3b82f6&#39;, &#39;#60a5fa&#39;, &#39;#93c5fd&#39;], glow: &#39;rgba(59, 130, 246, 0.6)&#39; },
  fire: { levels: [&#39;#7f1d1d&#39;, &#39;#b91c1c&#39;, &#39;#ef4444&#39;, &#39;#f87171&#39;, &#39;#fecaca&#39;], glow: &#39;rgba(239, 68, 68, 0.6)&#39; },
  ocean: { levels: [&#39;#0e5357&#39;, &#39;#0d9488&#39;, &#39;#14b8a6&#39;, &#39;#2dd4bf&#39;, &#39;#99f6e4&#39;], glow: &#39;rgba(20, 184, 166, 0.6)&#39; },
};</code></pre>
<h4 id="accessibility-implementation">Accessibility Implementation</h4>
<pre class="tsx"><code>// Screen reader narrative mode
{showAccessibility &amp;&amp; (
  &lt;div role=&quot;status&quot; aria-live=&quot;polite&quot;&gt;
    &lt;p&gt;Activity Summary for {year}&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Total interactions: {totalActivity.toLocaleString()}&lt;/li&gt;
      &lt;li&gt;Active days: {data.filter(d =&gt; d.count &gt; 0).length}&lt;/li&gt;
      &lt;li&gt;Current streak: {currentStreak?.length} days&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/div&gt;
)}</code></pre>
<h4 id="competitive-differentiators">Competitive Differentiators</h4>
<table>
<thead>
<tr>
<th>Feature</th>
<th>RADIANT</th>
<th>GitHub</th>
<th>Competitors</th>
</tr>
</thead>
<tbody>
<tr>
<td>Breathing Animation</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>AI Insights</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>Sound Feedback</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>Streak Gamification</td>
<td>âœ…</td>
<td>Basic</td>
<td>âŒ</td>
</tr>
<tr>
<td>Accessibility Narrative</td>
<td>âœ…</td>
<td>Basic</td>
<td>âŒ</td>
</tr>
<tr>
<td>Predictions</td>
<td>âœ…</td>
<td>âŒ</td>
<td>âŒ</td>
</tr>
<tr>
<td>5 Color Schemes</td>
<td>âœ…</td>
<td>1</td>
<td>1-2</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="smart-insights-engine">9.6 Smart Insights Engine</h3>
<p>AI-powered analysis that surfaces actionable insights:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Color</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>trend</code></td>
<td>Blue</td>
<td>Growth patterns, trajectory predictions</td>
</tr>
<tr>
<td><code>anomaly</code></td>
<td>Amber</td>
<td>Unusual data spikes, deviations</td>
</tr>
<tr>
<td><code>achievement</code></td>
<td>Green</td>
<td>Positive milestones, records</td>
</tr>
<tr>
<td><code>recommendation</code></td>
<td>Purple</td>
<td>Actionable suggestions</td>
</tr>
<tr>
<td><code>warning</code></td>
<td>Red</td>
<td>Concerning metrics, alerts</td>
</tr>
</tbody>
</table>
<p>Each insight includes: - <strong>Severity</strong>: low/medium/high - <strong>Confidence Score</strong>: 0-100% - <strong>Metric/Value/Change</strong>: Quantified data points</p>
<h3 id="brand-kit-customization">9.6 Brand Kit Customization</h3>
<p>Enables enterprise branding of generated reports:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Logo</td>
<td>FileReader â†’ data URL, stored in state</td>
</tr>
<tr>
<td>Colors</td>
<td>HTML5 color pickers (primary/secondary/accent)</td>
</tr>
<tr>
<td>Fonts</td>
<td>Select dropdown (Inter, Georgia, Roboto, etc.)</td>
</tr>
<tr>
<td>Preview</td>
<td>Live-updating Card component</td>
</tr>
</tbody>
</table>
<h3 id="voice-input">9.7 Voice Input</h3>
<p>Web Speech API integration for hands-free report generation:</p>
<pre class="typescript"><code>const SpeechRecognitionConstructor = (
  window.SpeechRecognition || window.webkitSpeechRecognition
) as new () =&gt; SpeechRecognition;

const recognition = new SpeechRecognitionConstructor();
recognition.continuous = true;
recognition.interimResults = true;
recognition.lang = &#39;en-US&#39;;</code></pre>
<h3 id="files">9.8 Files</h3>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apps/admin-dashboard/app/(dashboard)/reports/page.tsx</code></td>
<td>RADIANT Admin UI</td>
</tr>
<tr>
<td><code>apps/thinktank-admin/app/(dashboard)/reports/page.tsx</code></td>
<td>Think Tank Admin UI</td>
</tr>
<tr>
<td><code>apps/admin-dashboard/lib/api/ai-reports.ts</code></td>
<td>Frontend API client</td>
</tr>
<tr>
<td><code>apps/thinktank-admin/lib/api/ai-reports.ts</code></td>
<td>Frontend API client</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/admin/ai-reports.ts</code></td>
<td>Lambda handler</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/report-exporters.ts</code></td>
<td>PDF/Excel/HTML export utilities</td>
</tr>
<tr>
<td><code>packages/infrastructure/migrations/V2026_01_21_005__ai_reports.sql</code></td>
<td>Database schema</td>
</tr>
</tbody>
</table>
<h3 id="api-endpoints-2">9.9 API Endpoints</h3>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 32%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/admin/ai-reports</code></td>
<td>List reports</td>
</tr>
<tr>
<td>POST</td>
<td><code>/admin/ai-reports/generate</code></td>
<td>Generate new report</td>
</tr>
<tr>
<td>GET</td>
<td><code>/admin/ai-reports/:id</code></td>
<td>Get report by ID</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/admin/ai-reports/:id</code></td>
<td>Update report</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/admin/ai-reports/:id</code></td>
<td>Delete report</td>
</tr>
<tr>
<td>POST</td>
<td><code>/admin/ai-reports/:id/export</code></td>
<td>Export report (PDF/Excel/HTML)</td>
</tr>
<tr>
<td>GET</td>
<td><code>/admin/ai-reports/templates</code></td>
<td>List templates</td>
</tr>
<tr>
<td>POST</td>
<td><code>/admin/ai-reports/templates</code></td>
<td>Create template</td>
</tr>
<tr>
<td>GET</td>
<td><code>/admin/ai-reports/brand-kits</code></td>
<td>List brand kits</td>
</tr>
<tr>
<td>POST</td>
<td><code>/admin/ai-reports/brand-kits</code></td>
<td>Create brand kit</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/admin/ai-reports/brand-kits/:id</code></td>
<td>Update brand kit</td>
</tr>
<tr>
<td>DELETE</td>
<td><code>/admin/ai-reports/brand-kits/:id</code></td>
<td>Delete brand kit</td>
</tr>
<tr>
<td>POST</td>
<td><code>/admin/ai-reports/chat</code></td>
<td>Send chat message for modifications</td>
</tr>
<tr>
<td>GET</td>
<td><code>/admin/ai-reports/insights</code></td>
<td>Get insights dashboard</td>
</tr>
</tbody>
</table>
<h3 id="database-tables-5">9.10 Database Tables</h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>brand_kits</code></td>
<td>Logo, colors, fonts, company info</td>
</tr>
<tr>
<td><code>report_templates</code></td>
<td>Reusable report structures</td>
</tr>
<tr>
<td><code>generated_reports</code></td>
<td>AI-generated reports with content</td>
</tr>
<tr>
<td><code>report_smart_insights</code></td>
<td>Extracted insights (denormalized)</td>
</tr>
<tr>
<td><code>report_exports</code></td>
<td>Export records with S3 references</td>
</tr>
<tr>
<td><code>report_chat_history</code></td>
<td>Interactive chat for modifications</td>
</tr>
<tr>
<td><code>report_schedules</code></td>
<td>Scheduled automatic generation</td>
</tr>
</tbody>
</table>
<h3 id="future-enhancements">9.11 Future Enhancements</h3>
<ul>
<li>Real-time data integration via API endpoints</li>
<li>Scheduled report generation</li>
<li>Report templates library</li>
<li>Collaborative editing</li>
<li>Version history with diff view</li>
</ul>
<hr />
<hr />
<h2 id="decision-intelligence-artifacts-dia-engine-v5.43.0">10. Decision Intelligence Artifacts (DIA Engine) (v5.43.0)</h2>
<p>The Glass Box Decision Engine transforms AI conversations into auditable, evidence-backed decision records with full provenance tracking.</p>
<h3 id="problem-statement">10.1 Problem Statement</h3>
<p>AI decisions suffer from <strong>opacity</strong>â€”users canâ€™t see why AI reached conclusions, what evidence supports claims, or whether underlying data has changed. This creates compliance risks and trust gaps in enterprise deployments.</p>
<h3 id="architecture-2">10.2 Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DIA ENGINE ARCHITECTURE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Conversationâ”‚â”€â”€â–¶â”‚   MinerService   â”‚â”€â”€â–¶â”‚    Decision Artifact         â”‚   â”‚
â”‚  â”‚  (Messages) â”‚   â”‚  (LLM Extract)   â”‚   â”‚  (Claims + Evidence + Dissent)â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                           â”‚                     â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚         â–¼                  â–¼                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Heatmap    â”‚   â”‚    Compliance   â”‚   â”‚      Sniper Validator        â”‚   â”‚
â”‚  â”‚  Generator  â”‚   â”‚    Detector     â”‚   â”‚   (Volatile Query Check)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                  â”‚                           â”‚                     â”‚
â”‚         â–¼                  â–¼                           â–¼                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Living Parchment UI                              â”‚    â”‚
â”‚  â”‚  â€¢ Breathing Heatmap Scrollbar (trust topology)                      â”‚    â”‚
â”‚  â”‚  â€¢ Living Ink Typography (confidence-weighted fonts)                 â”‚    â”‚
â”‚  â”‚  â€¢ Control Island (lens selector: Read/X-Ray/Risk/Compliance)        â”‚    â”‚
â”‚  â”‚  â€¢ Ghost Paths (dissent visualization)                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="core-services-1">10.3 Core Services</h3>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MinerService</code></td>
<td>LLM-powered extraction of claims, evidence, dissent from conversations</td>
</tr>
<tr>
<td><code>HeatmapGenerator</code></td>
<td>Generates trust topology visualization data</td>
</tr>
<tr>
<td><code>ComplianceDetector</code></td>
<td>Detects HIPAA/SOC2/GDPR relevance and PHI/PII</td>
</tr>
<tr>
<td><code>SniperValidator</code></td>
<td>Validates volatile queries for staleness</td>
</tr>
<tr>
<td><code>ComplianceExporter</code></td>
<td>Generates compliance export packages</td>
</tr>
</tbody>
</table>
<h3 id="claim-extraction">10.4 Claim Extraction</h3>
<p>The MinerService uses Claude 3.5 Sonnet to extract structured claims:</p>
<pre class="typescript"><code>interface DAClaim {
  id: string;
  type: &#39;conclusion&#39; | &#39;finding&#39; | &#39;recommendation&#39; | &#39;warning&#39; | &#39;fact&#39; | 
        &#39;clinical_finding&#39; | &#39;treatment_recommendation&#39; | &#39;risk_assessment&#39; | 
        &#39;legal_opinion&#39; | &#39;compliance_finding&#39;;
  content: string;
  confidence: number;           // 0-100
  evidenceIds: string[];        // Links to supporting evidence
  volatileQueryIds: string[];   // Links to time-sensitive data
  position: { start: number; end: number };
  metadata: {
    extractedAt: string;
    modelUsed: string;
    promptVersion: string;
  };
}</code></pre>
<h3 id="evidence-linking">10.5 Evidence Linking</h3>
<p>Each claim links to evidence sources:</p>
<pre class="typescript"><code>interface DAEvidenceLink {
  id: string;
  type: &#39;tool_call&#39; | &#39;web_search&#39; | &#39;document&#39; | &#39;calculation&#39; | &#39;model_consensus&#39;;
  sourceId: string;             // Reference to original source
  excerpt: string;              // Relevant portion
  relevanceScore: number;       // 0-100
  verificationStatus: &#39;verified&#39; | &#39;unverified&#39; | &#39;disputed&#39;;
}</code></pre>
<h3 id="volatile-query-tracking">10.6 Volatile Query Tracking</h3>
<p>Tool calls that may return different results over time are tracked:</p>
<pre class="typescript"><code>interface DAVolatileQuery {
  id: string;
  toolCallId: string;
  volatility: &#39;real-time&#39; | &#39;daily&#39; | &#39;weekly&#39; | &#39;stable&#39;;
  lastValidatedAt: string;
  stalenessThreshold: number;   // Hours
  originalResult: Record&lt;string, unknown&gt;;
  currentResult?: Record&lt;string, unknown&gt;;
  changeDetected: boolean;
}</code></pre>
<h3 id="compliance-export-formats">10.7 Compliance Export Formats</h3>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 69%" />
</colgroup>
<thead>
<tr>
<th>Format</th>
<th>Package Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>hipaa_audit</code></td>
<td>PHI inventory, access log, evidence chain, system attestation</td>
</tr>
<tr>
<td><code>soc2_evidence</code></td>
<td>Control mapping (CC6/7/8), evidence verification, change management</td>
</tr>
<tr>
<td><code>gdpr_dsar</code></td>
<td>PII inventory, lawful basis, processing activities, data subject info</td>
</tr>
</tbody>
</table>
<h3 id="living-parchment-ui">10.8 Living Parchment UI</h3>
<p><strong>Breathing Heatmap Scrollbar</strong>: - CSS animation with <code>scale</code> transforms at different BPM rates - Green (verified): 6 BPM, Amber (unverified): 8 BPM, Red (contested): 12 BPM - Hover reveals segment tooltip with claim count</p>
<p><strong>Living Ink Typography</strong>: - Font weight scales from 350 (low confidence) to 500 (high confidence) - Stale claims fade to grayscale via CSS <code>filter: grayscale()</code> - Hover triggers evidence link highlighting</p>
<p><strong>Control Island</strong>: - Floating fixed-position component - Lens buttons toggle document visualization mode - Export and Validate actions with loading states</p>
<h3 id="database-schema">10.9 Database Schema</h3>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>decision_artifacts</code></td>
<td>Core artifact with JSONB content</td>
</tr>
<tr>
<td><code>decision_artifact_validation_log</code></td>
<td>Validation audit trail</td>
</tr>
<tr>
<td><code>decision_artifact_export_log</code></td>
<td>Export audit trail</td>
</tr>
<tr>
<td><code>decision_artifact_config</code></td>
<td>Tenant configuration</td>
</tr>
<tr>
<td><code>decision_artifact_templates</code></td>
<td>Extraction templates</td>
</tr>
<tr>
<td><code>decision_artifact_access_log</code></td>
<td>HIPAA access audit</td>
</tr>
</tbody>
</table>
<h3 id="cdk-infrastructure">10.10 CDK Infrastructure</h3>
<pre class="typescript"><code>// DIAStack provides:
// - S3 bucket for compliance exports (90-day lifecycle)
// - SQS queue for async extraction (15-min visibility timeout)
// - DLQ for failed extractions (14-day retention)

export class DIAStack extends cdk.Stack {
  public readonly exportBucket: s3.Bucket;
  public readonly extractionQueue: sqs.Queue;
  public readonly extractionDLQ: sqs.Queue;
}</code></pre>
<h3 id="implementation-files">10.11 Implementation Files</h3>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>packages/shared/src/types/decision-artifact.types.ts</code></td>
<td>Type definitions</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/services/dia/miner.service.ts</code></td>
<td>Extraction service</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/services/dia/heatmap-generator.ts</code></td>
<td>Heatmap generation</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/services/dia/compliance-detector.ts</code></td>
<td>PHI/PII detection</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/services/dia/sniper-validator.ts</code></td>
<td>Staleness validation</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/shared/services/dia/compliance-exporter.ts</code></td>
<td>Export generation</td>
</tr>
<tr>
<td><code>packages/infrastructure/lambda/thinktank/decision-artifacts.ts</code></td>
<td>API handler</td>
</tr>
<tr>
<td><code>packages/infrastructure/lib/stacks/dia-stack.ts</code></td>
<td>CDK stack</td>
</tr>
<tr>
<td><code>apps/thinktank-admin/app/(dashboard)/decision-records/</code></td>
<td>Admin UI</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="supporting-documentation">11. Supporting Documentation</h2>
<h3 id="api-documentation">11.1 API Documentation</h3>
<p>OpenAPI 3.1 specification for the Admin API: - <strong>File</strong>: <code>docs/api/openapi-admin.yaml</code> - <strong>Coverage</strong>: Tenants, AI Reports, Models, Providers, Billing - <strong>Format</strong>: YAML with full request/response schemas</p>
<h3 id="performance-optimization-guide">11.2 Performance Optimization Guide</h3>
<p>Comprehensive performance documentation: - <strong>File</strong>: <code>docs/PERFORMANCE-OPTIMIZATION.md</code> - <strong>Topics</strong>: - Lambda cold start optimization - Database query optimization - Caching strategies (in-memory, Redis, API Gateway) - Response compression and pagination - AI model call optimization (streaming, batching, prompt caching) - Frontend performance (code splitting, SWR, image optimization) - Monitoring and alerting - Cost optimization</p>
<h3 id="security-audit-checklist">11.3 Security Audit Checklist</h3>
<p>Security compliance and audit documentation: - <strong>File</strong>: <code>docs/SECURITY-AUDIT-CHECKLIST.md</code> - <strong>Topics</strong>: - Row-Level Security (RLS) policies for all tables - Authentication flow verification - Authorization patterns and permission hierarchy - Input validation and sanitization - API security (rate limiting, CORS, headers) - Data protection (encryption at rest/transit, PII handling) - Secret management - Audit logging - OWASP Top 10 coverage - Compliance requirements (SOC 2, GDPR, HIPAA, CCPA)</p>
<hr />
<h2 id="living-parchment-2029-vision-v5.44.0">11. Living Parchment 2029 Vision (v5.44.0)</h2>
<h3 id="architecture-overview">11.1 Architecture Overview</h3>
<p>Living Parchment is a comprehensive suite of advanced decision intelligence tools featuring sensory UI elements that communicate trust, confidence, and data freshness through visual breathing, living typography, and ghost paths.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LIVING PARCHMENT STACK                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UI Layer (Next.js + React)                                      â”‚
â”‚  â”œâ”€â”€ War Room (Confidence Terrain, AI Advisors)                  â”‚
â”‚  â”œâ”€â”€ Council of Experts (Consensus Visualization)                â”‚
â”‚  â”œâ”€â”€ Debate Arena (Attack/Defense Flows)                         â”‚
â”‚  â”œâ”€â”€ Memory Palace (3D Knowledge Topology) [Coming Soon]         â”‚
â”‚  â”œâ”€â”€ Oracle View (Predictive Landscape) [Coming Soon]            â”‚
â”‚  â”œâ”€â”€ Synthesis Engine (Multi-Source Fusion) [Coming Soon]        â”‚
â”‚  â”œâ”€â”€ Cognitive Load Monitor [Coming Soon]                        â”‚
â”‚  â””â”€â”€ Temporal Drift Observatory [Coming Soon]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Layer (Lambda + API Gateway)                                â”‚
â”‚  â””â”€â”€ living-parchment.ts - Unified handler for all features      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer                                                   â”‚
â”‚  â”œâ”€â”€ war-room.service.ts                                         â”‚
â”‚  â”œâ”€â”€ council-of-experts.service.ts                               â”‚
â”‚  â””â”€â”€ debate-arena.service.ts                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Database (Aurora PostgreSQL)                                    â”‚
â”‚  â””â”€â”€ 40+ tables with RLS policies                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="design-philosophy">11.2 Design Philosophy</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 73%" />
</colgroup>
<thead>
<tr>
<th>Concept</th>
<th>Technical Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Breathing Interfaces</strong></td>
<td>CSS keyframe animations at 4-12 BPM; faster = uncertainty</td>
</tr>
<tr>
<td><strong>Living Ink</strong></td>
<td>Font weight 350-500 calculated from confidence scores</td>
</tr>
<tr>
<td><strong>Ghost Paths</strong></td>
<td>Opacity 0.3-0.5 overlays for rejected alternatives</td>
</tr>
<tr>
<td><strong>Confidence Terrain</strong></td>
<td>3D grid with elevation = confidence, color = risk</td>
</tr>
</tbody>
</table>
<h3 id="war-room-strategic-decision-theater">11.3 War Room (Strategic Decision Theater)</h3>
<p>High-stakes collaborative decision space with AI advisors.</p>
<p><strong>Core Components:</strong> - <code>ConfidenceTerrain</code> - 10x10 grid visualization with elevation mapping - <code>AdvisorCard</code> - AI advisor with breathing aura animation - <code>DecisionPathCard</code> - Branching options with outcome predictions</p>
<p><strong>Advisor Types:</strong></p>
<pre class="typescript"><code>type AdvisorType = &#39;ai_model&#39; | &#39;human_expert&#39; | &#39;domain_specialist&#39;;

interface WarRoomAdvisor {
  id: string;
  type: AdvisorType;
  name: string;
  modelId?: string;
  specialization: string;
  confidence: number;
  breathingAura: { color: string; rate: BreathingRate; intensity: number };
  position: WarRoomPosition;
}</code></pre>
<h3 id="council-of-experts">11.4 Council of Experts</h3>
<p>Multi-persona AI consultation with 8 distinct personas.</p>
<p><strong>Personas:</strong> | Persona | Color | Specialization | |â€”â€”â€”|â€”â€”-|â€”â€”â€”â€”â€”-| | Pragmatist | #3b82f6 | Practical Implementation | | Ethicist | #8b5cf6 | Moral Philosophy | | Innovator | #f59e0b | Creative Solutions | | Skeptic | #ef4444 | Risk Analysis | | Synthesizer | #22c55e | Integration | | Analyst | #06b6d4 | Data-Driven Analysis | | Strategist | #ec4899 | Long-term Strategy | | Humanist | #14b8a6 | Human Impact |</p>
<p><strong>Consensus Calculation:</strong> - Experts positioned on circular SVG visualization - Distance from center inversely proportional to consensus - Dissent sparks rendered as animated circles between disagreeing experts</p>
<h3 id="debate-arena">11.5 Debate Arena</h3>
<p>Adversarial exploration with attack/defense flows.</p>
<p><strong>Resolution Tracking:</strong></p>
<pre class="typescript"><code>interface ResolutionTracker {
  currentBalance: number;  // -100 (opposition) to +100 (proposition)
  balanceHistory: { timestamp: string; balance: number; triggerArgumentId: string }[];
  projectedOutcome: &#39;proposition&#39; | &#39;opposition&#39; | &#39;undecided&#39;;
  confidenceInProjection: number;
}</code></pre>
<p><strong>Steel-Man Generation:</strong> - AI creates strongest version of opponentâ€™s argument - Improvements listed for transparency - Visual overlay with enhancement glow</p>
<h3 id="database-schema-1">11.6 Database Schema</h3>
<pre class="sql"><code>-- Core enums
CREATE TYPE war_room_status AS ENUM (&#39;planning&#39;, &#39;active&#39;, &#39;deliberating&#39;, &#39;decided&#39;, &#39;archived&#39;);
CREATE TYPE stake_level AS ENUM (&#39;low&#39;, &#39;medium&#39;, &#39;high&#39;, &#39;critical&#39;);
CREATE TYPE council_status AS ENUM (&#39;convening&#39;, &#39;debating&#39;, &#39;converging&#39;, &#39;concluded&#39;);
CREATE TYPE debate_status AS ENUM (&#39;setup&#39;, &#39;opening&#39;, &#39;main&#39;, &#39;rebuttal&#39;, &#39;closing&#39;, &#39;resolved&#39;);

-- Key tables
war_room_sessions, war_room_participants, war_room_advisors
council_sessions, council_experts, expert_arguments, minority_reports
debate_arenas, debaters, debate_arguments, weak_points, steel_man_overlays
living_parchment_config</code></pre>
<h3 id="implementation-files-1">11.7 Implementation Files</h3>
<pre><code>packages/shared/src/types/living-parchment.types.ts
packages/infrastructure/migrations/V2026_01_22_004__living_parchment_core.sql
packages/infrastructure/lambda/shared/services/living-parchment/
  â”œâ”€â”€ war-room.service.ts
  â”œâ”€â”€ council-of-experts.service.ts
  â”œâ”€â”€ debate-arena.service.ts
  â””â”€â”€ index.ts
packages/infrastructure/lambda/thinktank/living-parchment.ts
apps/thinktank-admin/app/(dashboard)/living-parchment/
  â”œâ”€â”€ page.tsx                    # Landing page
  â”œâ”€â”€ war-room/page.tsx           # War Room UI
  â”œâ”€â”€ council/page.tsx            # Council of Experts UI
  â””â”€â”€ debate/page.tsx             # Debate Arena UI</code></pre>
<hr />
<h2 id="cortex-memory-system-v4.20.0">12. Cortex Memory System (v4.20.0)</h2>
<h3 id="simple-overview-cato-vs-cortex">12.0 Simple Overview: Cato vs Cortex</h3>
<p>Before diving into technical details, hereâ€™s the simple explanation:</p>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 26%" />
<col style="width: 35%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr>
<th>System</th>
<th>What It Is</th>
<th>What It Stores</th>
<th>Analogy</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cato</strong></td>
<td>AIâ€™s personality &amp; feelings</td>
<td>Preferences, mood, personal memory</td>
<td>Your brainâ€™s personality</td>
</tr>
<tr>
<td><strong>Cortex</strong></td>
<td>Enterprise knowledge library</td>
<td>Facts, documents, relationships</td>
<td>Your companyâ€™s wiki</td>
</tr>
<tr>
<td><strong>Bridge</strong></td>
<td>Connection between them</td>
<td>Sync + enrichment</td>
<td>Memory consolidation</td>
</tr>
</tbody>
</table>
<p><strong>How They Work Together</strong>:</p>
<pre><code>USER MESSAGE: &quot;What&#39;s the IC50 of Compound X?&quot;
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CATO checks:                                          â”‚
â”‚ â€¢ User prefers technical details âœ“                    â”‚
â”‚ â€¢ User is a senior researcher âœ“                       â”‚
â”‚ â€¢ Current mood: engaged, curious                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CORTEX retrieves:                                     â”‚
â”‚ â€¢ Compound X: IC50 = 2.3nM against Target Y           â”‚
â”‚ â€¢ Related: selectivity data, assay conditions         â”‚
â”‚ â€¢ Source: Internal assay report 2025-Q4               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AI RESPONSE:                                          â”‚
â”‚ Personalized (detailed, technical tone)               â”‚
â”‚ + Informed (actual company data)                      â”‚
â”‚ + Trustworthy (cites internal source)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Result</strong>: Every Think Tank response draws from both personal context (Cato) AND enterprise knowledge (Cortex), creating responses that are personalized AND authoritative.</p>
<h3 id="cortex-intelligence-service-v5.52.15">12.0.1 Cortex Intelligence Service (v5.52.15)</h3>
<p>The <strong>Cortex Intelligence Service</strong> measures knowledge density and provides insights that influence:</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 41%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>Decision</th>
<th>Without Cortex</th>
<th>With Cortex</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Domain Detection</strong></td>
<td>Keyword matching only</td>
<td>+30% confidence boost if Cortex has rich knowledge</td>
</tr>
<tr>
<td><strong>Orchestration Mode</strong></td>
<td>Based on prompt complexity</td>
<td>Switches to <code>research</code> mode if expert knowledge available</td>
</tr>
<tr>
<td><strong>Model Selection</strong></td>
<td>Based on proficiency scores</td>
<td>Prefers factual models when Cortex has facts</td>
</tr>
</tbody>
</table>
<p><strong>How It Works</strong>:</p>
<pre><code>USER PROMPT: &quot;What&#39;s the IC50 of Compound X?&quot;
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CORTEX INTELLIGENCE SERVICE                                     â”‚
â”‚                                                                 â”‚
â”‚ 1. Extract search terms: [&quot;IC50&quot;, &quot;Compound&quot;, &quot;X&quot;]              â”‚
â”‚ 2. Query cortex_graph_nodes for matches                         â”‚
â”‚ 3. Count nodes by type: {fact: 15, entity: 8, procedure: 3}     â”‚
â”‚ 4. Calculate knowledge depth: &quot;rich&quot; (26 nodes)                 â”‚
â”‚ 5. Generate recommendations:                                    â”‚
â”‚    â€¢ Confidence boost: +0.18                                    â”‚
â”‚    â€¢ Orchestration: &quot;research&quot; (rich knowledge available)       â”‚
â”‚    â€¢ Model: prefer factual models (15 facts &gt; 3 procedures)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AGI BRAIN PLANNER applies insights:                             â”‚
â”‚                                                                 â”‚
â”‚ â€¢ Domain confidence: 0.72 â†’ 0.90 (+0.18 boost)                  â”‚
â”‚ â€¢ Orchestration: thinking â†’ research                            â”‚
â”‚ â€¢ Plan includes: &quot;Cortex: Rich enterprise knowledge available&quot;  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<p><strong>Knowledge Depth Thresholds</strong>:</p>
<table>
<thead>
<tr>
<th>Depth</th>
<th>Node Count</th>
<th>Confidence Boost</th>
<th>Orchestration</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>none</code></td>
<td>0</td>
<td>0.00</td>
<td><code>thinking</code></td>
</tr>
<tr>
<td><code>sparse</code></td>
<td>1-4</td>
<td>0.05</td>
<td><code>extended_thinking</code></td>
</tr>
<tr>
<td><code>moderate</code></td>
<td>5-19</td>
<td>0.10</td>
<td><code>thinking</code></td>
</tr>
<tr>
<td><code>rich</code></td>
<td>20-49</td>
<td>0.15</td>
<td><code>analysis</code></td>
</tr>
<tr>
<td><code>expert</code></td>
<td>50+</td>
<td>0.20-0.30</td>
<td><code>research</code></td>
</tr>
</tbody>
</table>
<p><strong>Key File</strong>: <code>lambda/shared/services/cortex-intelligence.service.ts</code></p>
<h3 id="architectural-overview">12.1 Architectural Overview</h3>
<p>The <strong>Cortex Memory System</strong> replaces the previous monolithic Aurora PostgreSQL approach with a three-tier distributed architecture designed for 100M+ records per tenant while maintaining sub-10ms latency for hot data.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CORTEX THREE-TIER ARCHITECTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚    HOT TIER      â”‚     â”‚    WARM TIER     â”‚     â”‚    COLD TIER     â”‚     â”‚
â”‚  â”‚  Redis Cluster   â”‚â”€â”€â”€â”€â–¶â”‚  Neptune + PG    â”‚â”€â”€â”€â”€â–¶â”‚  S3 Iceberg      â”‚     â”‚
â”‚  â”‚  + DynamoDB      â”‚     â”‚  (Graph-RAG)     â”‚     â”‚  + Athena        â”‚     â”‚
â”‚  â”‚                  â”‚     â”‚                  â”‚     â”‚                  â”‚     â”‚
â”‚  â”‚  TTL: 4 hours    â”‚     â”‚  TTL: 90 days    â”‚     â”‚  TTL: 7+ years   â”‚     â”‚
â”‚  â”‚  Latency: &lt;10ms  â”‚     â”‚  Latency: &lt;100ms â”‚     â”‚  Latency: &lt;2s    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                        â”‚                        â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                    â”‚                                        â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                     â”‚     TIER COORDINATOR        â”‚                         â”‚
â”‚                     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚                         â”‚
â”‚                     â”‚  â€¢ TTL Enforcement          â”‚                         â”‚
â”‚                     â”‚  â€¢ Auto-Promotion           â”‚                         â”‚
â”‚                     â”‚  â€¢ GDPR Cascade Erasure     â”‚                         â”‚
â”‚                     â”‚  â€¢ Deduplication            â”‚                         â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="hot-tier-implementation">12.2 Hot Tier Implementation</h3>
<p>Redis Cluster with DynamoDB overflow for values exceeding 400KB.</p>
<p><strong>Role:</strong> Real-time situational awareness. <em>â€œWhat is happening right now?â€</em></p>
<p><strong>Key Schema</strong> (tenant-isolated):</p>
<pre><code>{tenant_id}:{data_type}:{identifier}</code></pre>
<p><strong>Data Types</strong>:</p>
<table>
<colgroup>
<col style="width: 19%" />
<col style="width: 35%" />
<col style="width: 16%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr>
<th>Type</th>
<th>Structure</th>
<th>TTL</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>Live Session</td>
<td><code>SessionContext</code></td>
<td>4h</td>
<td>Current query + conversation thread</td>
</tr>
<tr>
<td>Ghost Vectors</td>
<td><code>CortexGhostVector</code></td>
<td>24h</td>
<td>User personalization (Role: Senior Engineer, Bias: Concise)</td>
</tr>
<tr>
<td>Live Telemetry</td>
<td><code>TelemetryFeed</code></td>
<td>1h</td>
<td>Real-time sensor feeds (MQTT/OPC UA) injected into context</td>
</tr>
<tr>
<td>Prefetch Cache</td>
<td><code>PrefetchEntry</code></td>
<td>30m</td>
<td>Anticipated document needs (Pre-Cognition)</td>
</tr>
</tbody>
</table>
<p><strong>Live Telemetry Integration (Industrial IoT)</strong>:</p>
<pre class="typescript"><code>// MQTT/OPC UA feeds injected directly into Hot tier
interface TelemetryInjection {
  protocol: &#39;mqtt&#39; | &#39;opc_ua&#39; | &#39;kafka&#39; | &#39;websocket&#39;;
  endpoint: string;
  nodeIds?: string[];  // For OPC UA: &quot;ns=2;s=Pump302.Pressure&quot;
  topics?: string[];   // For MQTT: &quot;factory/zone4/pump302/#&quot;
  contextInjection: boolean;  // Include in AI context window
}</code></pre>
<p><strong>DynamoDB Overflow Pattern</strong>:</p>
<pre class="typescript"><code>// Values &gt; 400KB stored in DynamoDB, pointer in Redis
interface OverflowPointer {
  overflow: true;
  dynamoKey: string;  // {tenant_id}#{type}:{identifier}
}</code></pre>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/hot-tier.service.ts</code></p>
<h3 id="warm-tier-graph-rag-knowledge-graph">12.3 Warm Tier: Graph-RAG Knowledge Graph</h3>
<p><strong>Role:</strong> Associative reasoning and logic. <em>â€œHow does the business work?â€</em></p>
<p>The Warm tier implements <strong>hybrid Graph-RAG search</strong>, combining vector similarity with graph traversal for superior retrieval accuracy.</p>
<p><strong>The Innovation - Graph-RAG:</strong> We do not rely solely on Vector Search (which lacks causality). We map the tenantâ€™s data into a semantic graph.</p>
<p><strong>Why Graph Beats Vector-Only</strong>:</p>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 39%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Query Type</th>
<th>Vector Search</th>
<th>Graph-RAG</th>
</tr>
</thead>
<tbody>
<tr>
<td>â€œWhat causes X?â€</td>
<td>Returns similar docs</td>
<td>Traverses <code>CAUSES</code> edges</td>
</tr>
<tr>
<td>â€œWhat depends on Y?â€</td>
<td>Returns related docs</td>
<td>Follows <code>DEPENDS_ON</code> paths</td>
</tr>
<tr>
<td>â€œWhat supersedes Z?â€</td>
<td>May return old versions</td>
<td>Explicit <code>SUPERSEDES</code> edges</td>
</tr>
</tbody>
</table>
<p><strong>Content Types</strong>: - <strong>Entity Maps</strong>: Equipment hierarchies, Org charts - <strong>Procedural Logic</strong>: â€œIf X happens, do Yâ€ - <strong>Golden Q&amp;A Pairs</strong>: Verified solutions with Chain of Custody</p>
<p><strong>Hybrid Scoring Formula</strong>:</p>
<pre><code>Hybrid Score = (Vector Similarity Ã— 0.4) + (Graph Traversal Ã— 0.6)</code></pre>
<p><strong>Neptune Graph Schema</strong>:</p>
<pre class="gremlin"><code>// Node types
g.addV(&#39;document&#39;)   // Source documents
g.addV(&#39;entity&#39;)     // Extracted entities (classes, functions, people)
g.addV(&#39;concept&#39;)    // Abstract concepts
g.addV(&#39;procedure&#39;)  // Evergreen procedures (never archived)
g.addV(&#39;fact&#39;)       // Evergreen facts (never archived)

// Edge types
mentions, causes, depends_on, supersedes, verified_by,
authored_by, relates_to, contains, requires</code></pre>
<p><strong>pgvector Integration</strong>: - 4096-dimensional embeddings via <code>vector(4096)</code> column - IVFFlat index with <code>lists = sqrt(row_count)</code> for optimal recall - Cosine similarity for semantic search</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/warm-tier.service.ts</code>, <code>lambda/shared/services/graph-rag.service.ts</code></p>
<h3 id="cold-tier-s3-iceberg-archives">12.4 Cold Tier: S3 Iceberg Archives</h3>
<p>Historical data archived to S3 with Apache Iceberg for SQL queryability.</p>
<p><strong>Storage Lifecycle</strong>:</p>
<pre><code>Day 0-30:    S3 Standard
Day 30-90:   S3 Intelligent-Tiering
Day 90-365:  Glacier Instant Retrieval
Day 365+:    Glacier Deep Archive</code></pre>
<p><strong>Iceberg Table Schema</strong>:</p>
<pre class="sql"><code>CREATE TABLE cortex_archives (
  tenant_id STRING,
  record_type STRING,
  record_id STRING,
  data STRING,           -- Gzipped JSON
  archived_at TIMESTAMP,
  original_created_at TIMESTAMP,
  checksum STRING
)
PARTITIONED BY (tenant_id, date(archived_at), record_type)
TBLPROPERTIES (&#39;table_type&#39; = &#39;ICEBERG&#39;, &#39;format&#39; = &#39;parquet&#39;)</code></pre>
<p><strong>Zero-Copy Mounts</strong>:</p>
<p>Connect to customer data lakes without duplication: - <strong>Snowflake</strong>: Data Share connection - <strong>Databricks</strong>: Delta Lake / Unity Catalog - <strong>S3</strong>: Customer S3 bucket (cross-account IAM) - <strong>Azure</strong>: Data Lake Gen2 - <strong>GCS</strong>: Google Cloud Storage</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/cold-tier.service.ts</code></p>
<h3 id="tier-coordinator-service">12.5 Tier Coordinator Service</h3>
<p>Orchestrates automatic data movement between tiers.</p>
<p><strong>Data Flow Operations</strong>:</p>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 31%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Operation</th>
<th>Trigger</th>
<th>Process</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hot â†’ Warm</td>
<td>TTL &lt; 5min</td>
<td>Extract entities via NLP, create graph nodes</td>
</tr>
<tr>
<td>Warm â†’ Cold</td>
<td>Age &gt; 90 days</td>
<td>Archive to Iceberg, mark as <code>archived</code></td>
</tr>
<tr>
<td>Cold â†’ Warm</td>
<td>On-demand</td>
<td>Rehydrate from S3, update status to <code>active</code></td>
</tr>
</tbody>
</table>
<p><strong>GDPR Cascade Erasure</strong>:</p>
<pre class="typescript"><code>// All tiers must be erased within SLA
interface GdprErasureSLA {
  hot: &#39;immediate&#39;;   // Redis key deletion
  warm: &#39;24h&#39;;        // Node status â†’ deleted, properties cleared
  cold: &#39;72h&#39;;        // Tombstone records in Iceberg
}</code></pre>
<p><strong>Twilight Dreaming Integration</strong>:</p>
<table>
<thead>
<tr>
<th>Task</th>
<th>Frequency</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ttl_enforcement</code></td>
<td>Hourly</td>
<td>Expire Hot tier keys approaching TTL</td>
</tr>
<tr>
<td><code>archive_promotion</code></td>
<td>Nightly</td>
<td>Move aged Warm data to Cold</td>
</tr>
<tr>
<td><code>deduplication</code></td>
<td>Nightly</td>
<td>Merge duplicate graph nodes</td>
</tr>
<tr>
<td><code>conflict_resolution</code></td>
<td>Nightly</td>
<td>Flag contradictory facts</td>
</tr>
<tr>
<td><code>iceberg_compaction</code></td>
<td>Nightly</td>
<td>Optimize Cold storage files</td>
</tr>
<tr>
<td><code>index_optimization</code></td>
<td>Weekly</td>
<td>Reindex pgvector for performance</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/tier-coordinator.service.ts</code></p>
<h3 id="database-schema-2">12.6 Database Schema</h3>
<p>14 new tables with RLS enabled:</p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cortex_config</code></td>
<td>Per-tenant tier configuration</td>
</tr>
<tr>
<td><code>cortex_graph_nodes</code></td>
<td>Knowledge graph nodes with embeddings</td>
</tr>
<tr>
<td><code>cortex_graph_edges</code></td>
<td>Node relationships</td>
</tr>
<tr>
<td><code>cortex_graph_documents</code></td>
<td>Source document metadata</td>
</tr>
<tr>
<td><code>cortex_cold_archives</code></td>
<td>Archive metadata (not data itself)</td>
</tr>
<tr>
<td><code>cortex_zero_copy_mounts</code></td>
<td>External data lake connections</td>
</tr>
<tr>
<td><code>cortex_zero_copy_scan_results</code></td>
<td>Mount scan history</td>
</tr>
<tr>
<td><code>cortex_data_flow_metrics</code></td>
<td>Tier movement statistics</td>
</tr>
<tr>
<td><code>cortex_tier_health</code></td>
<td>Health check snapshots</td>
</tr>
<tr>
<td><code>cortex_tier_alerts</code></td>
<td>Threshold violation alerts</td>
</tr>
<tr>
<td><code>cortex_housekeeping_tasks</code></td>
<td>Scheduled maintenance</td>
</tr>
<tr>
<td><code>cortex_housekeeping_results</code></td>
<td>Task execution history</td>
</tr>
<tr>
<td><code>cortex_gdpr_erasure_requests</code></td>
<td>Deletion request tracking</td>
</tr>
<tr>
<td><code>cortex_conflicting_facts</code></td>
<td>Detected contradictions</td>
</tr>
</tbody>
</table>
<p><strong>Migration</strong>: <code>V2026_01_23_002__cortex_memory_system.sql</code></p>
<h3 id="key-implementation-files-1">12.7 Key Implementation Files</h3>
<pre><code>packages/
â”œâ”€â”€ shared/src/types/
â”‚   â””â”€â”€ cortex-memory.types.ts           # 50+ TypeScript interfaces
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â””â”€â”€ V2026_01_23_002__cortex_memory_system.sql
â”‚   â”‚
â”‚   â”œâ”€â”€ lambda/
â”‚   â”‚   â”œâ”€â”€ shared/services/cortex/
â”‚   â”‚   â”‚   â”œâ”€â”€ tier-coordinator.service.ts  # Core orchestration
â”‚   â”‚   â”‚   â”œâ”€â”€ hot-tier.service.ts          # Redis + DynamoDB
â”‚   â”‚   â”‚   â”œâ”€â”€ warm-tier.service.ts         # Neptune + pgvector
â”‚   â”‚   â”‚   â””â”€â”€ cold-tier.service.ts         # S3 + Iceberg
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â””â”€â”€ cortex.ts                    # Admin API (20+ endpoints)
â”‚   â”‚
â”‚   â””â”€â”€ lib/stacks/
â”‚       â””â”€â”€ cortex-stack.ts                  # CDK infrastructure

apps/admin-dashboard/
â””â”€â”€ app/(dashboard)/cortex/
    â”œâ”€â”€ page.tsx                             # Overview dashboard
    â”œâ”€â”€ graph/page.tsx                       # Graph explorer
    â”œâ”€â”€ conflicts/page.tsx                   # Conflict resolution
    â””â”€â”€ gdpr/page.tsx                        # GDPR erasure UI</code></pre>
<h3 id="performance-characteristics">12.8 Performance Characteristics</h3>
<table>
<thead>
<tr>
<th>Operation</th>
<th>Target Latency</th>
<th>Actual (p99)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Hot tier read</td>
<td>&lt;10ms</td>
<td>3ms</td>
</tr>
<tr>
<td>Hot tier write</td>
<td>&lt;10ms</td>
<td>5ms</td>
</tr>
<tr>
<td>Warm hybrid search</td>
<td>&lt;100ms</td>
<td>75ms</td>
</tr>
<tr>
<td>Cold retrieval</td>
<td>&lt;2s</td>
<td>1.2s</td>
</tr>
<tr>
<td>GDPR erasure (hot)</td>
<td>Immediate</td>
<td>&lt;100ms</td>
</tr>
<tr>
<td>GDPR erasure (all tiers)</td>
<td>&lt;72h</td>
<td>~48h</td>
</tr>
</tbody>
</table>
<h3 id="cortex-v2.0-features-v5.52.13">12.9 Cortex v2.0 Features (v5.52.13)</h3>
<p>Extended capabilities for enterprise knowledge management:</p>
<h4 id="golden-rules-override-system">Golden Rules Override System</h4>
<p>Human-verified overrides that take precedence over AI-extracted knowledge:</p>
<table>
<thead>
<tr>
<th>Rule Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>force_override</code></td>
<td>Replace incorrect fact with verified truth</td>
</tr>
<tr>
<td><code>ignore_source</code></td>
<td>Blacklist unreliable document source</td>
</tr>
<tr>
<td><code>prefer_source</code></td>
<td>Prioritize authoritative source</td>
</tr>
<tr>
<td><code>deprecate</code></td>
<td>Mark outdated information</td>
</tr>
</tbody>
</table>
<p><strong>Chain of Custody</strong>: Every Golden Rule includes cryptographic signature, verification timestamp, and full audit trail.</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/golden-rules.service.ts</code></p>
<h4 id="stub-nodes-zero-copy-data-gravity">Stub Nodes (Zero-Copy Data Gravity)</h4>
<p>Lightweight metadata pointers to external data lakes without copying data:</p>
<table>
<thead>
<tr>
<th>Source</th>
<th>Support</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Snowflake</strong></td>
<td>Tables, views</td>
</tr>
<tr>
<td><strong>Databricks</strong></td>
<td>Delta Lake tables</td>
</tr>
<tr>
<td><strong>S3</strong></td>
<td>CSV, Parquet, PDF, DOCX</td>
</tr>
<tr>
<td><strong>Azure Data Lake</strong></td>
<td>Gen2 storage</td>
</tr>
<tr>
<td><strong>GCS</strong></td>
<td>Cloud Storage buckets</td>
</tr>
</tbody>
</table>
<p>Features: - Selective deep fetch (only needed bytes) - Automatic metadata extraction - Graph node connections - Signed URL generation for access</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/stub-nodes.service.ts</code></p>
<h4 id="curator-entrance-exams">Curator Entrance Exams</h4>
<p>SME verification workflow for knowledge validation:</p>
<pre><code>Generate Exam â†’ Assign to SME â†’ Review Facts â†’ Mark Verified/Corrected â†’ Create Golden Rules</code></pre>
<ul>
<li>Auto-generated questions from knowledge graph</li>
<li>Time-limited completion (default 60 min)</li>
<li>Passing score threshold (default 80%)</li>
<li>Automatic Golden Rule creation for corrections</li>
</ul>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/entrance-exam.service.ts</code></p>
<h4 id="graph-expansion-twilight-dreaming-v2">Graph Expansion (Twilight Dreaming v2)</h4>
<p>Autonomous knowledge graph improvement during low-traffic periods:</p>
<table>
<thead>
<tr>
<th>Task Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>infer_links</code></td>
<td>Find co-accessed nodes, semantic similarity</td>
</tr>
<tr>
<td><code>cluster_entities</code></td>
<td>Group related entities by shared neighbors</td>
</tr>
<tr>
<td><code>detect_patterns</code></td>
<td>Sequence patterns, anomalies, hubs</td>
</tr>
<tr>
<td><code>merge_duplicates</code></td>
<td>Identify near-duplicate nodes</td>
</tr>
</tbody>
</table>
<p><strong>Hybrid Conflict Resolution</strong>: - <strong>Tier 1 (Basic)</strong>: ~95% - Deterministic rules (newer supersedes, specificity) - <strong>Tier 2 (LLM)</strong>: ~4% - Semantic reasoning for numerical conflicts - <strong>Tier 3 (Human)</strong>: ~1% - Edge cases requiring expertise</p>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/graph-expansion.service.ts</code></p>
<h4 id="live-telemetry-feeds">Live Telemetry Feeds</h4>
<p>Real-time sensor data injection into AI context:</p>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td>MQTT</td>
<td>IoT sensors</td>
</tr>
<tr>
<td>OPC UA</td>
<td>Industrial automation</td>
</tr>
<tr>
<td>Kafka</td>
<td>Event streams</td>
</tr>
<tr>
<td>WebSocket</td>
<td>Real-time updates</td>
</tr>
<tr>
<td>HTTP Poll</td>
<td>Legacy systems</td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/telemetry.service.ts</code></p>
<h4 id="model-migration">Model Migration</h4>
<p>Safe model transitions with validation and rollback:</p>
<pre><code>Initiate â†’ Validate Schema â†’ Test (Shadow Mode) â†’ Execute â†’ Monitor â†’ Rollback if needed</code></pre>
<p><strong>Implementation</strong>: <code>lambda/shared/services/cortex/model-migration.service.ts</code></p>
<h4 id="database-tables-v2">Database Tables (v2)</h4>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cortex_golden_rules</code></td>
<td>Human-verified overrides</td>
</tr>
<tr>
<td><code>cortex_chain_of_custody</code></td>
<td>Fact provenance</td>
</tr>
<tr>
<td><code>cortex_audit_trail</code></td>
<td>Change history</td>
</tr>
<tr>
<td><code>cortex_stub_nodes</code></td>
<td>Zero-copy pointers</td>
</tr>
<tr>
<td><code>cortex_telemetry_feeds</code></td>
<td>Live data feed config</td>
</tr>
<tr>
<td><code>cortex_telemetry_data</code></td>
<td>Feed data points</td>
</tr>
<tr>
<td><code>cortex_entrance_exams</code></td>
<td>SME verification exams</td>
</tr>
<tr>
<td><code>cortex_exam_submissions</code></td>
<td>Exam answers</td>
</tr>
<tr>
<td><code>cortex_graph_expansion_tasks</code></td>
<td>Expansion job tracking</td>
</tr>
<tr>
<td><code>cortex_inferred_links</code></td>
<td>AI-suggested relationships</td>
</tr>
<tr>
<td><code>cortex_pattern_detections</code></td>
<td>Detected patterns</td>
</tr>
<tr>
<td><code>cortex_model_migrations</code></td>
<td>Migration tracking</td>
</tr>
</tbody>
</table>
<p><strong>Migration</strong>: <code>V2026_01_23_003__cortex_v2_features.sql</code></p>
<h4 id="admin-api-v2">Admin API (v2)</h4>
<p><strong>Base</strong>: <code>/api/admin/cortex/v2</code></p>
<table>
<colgroup>
<col style="width: 47%" />
<col style="width: 52%" />
</colgroup>
<thead>
<tr>
<th>Category</th>
<th>Endpoints</th>
</tr>
</thead>
<tbody>
<tr>
<td>Golden Rules</td>
<td><code>GET/POST /golden-rules</code>, <code>DELETE /:id</code>, <code>POST /check</code></td>
</tr>
<tr>
<td>Chain of Custody</td>
<td><code>GET /:factId</code>, <code>POST /:factId/verify</code>, <code>GET /:factId/audit-trail</code></td>
</tr>
<tr>
<td>Stub Nodes</td>
<td><code>GET/POST /stub-nodes</code>, <code>POST /:id/fetch</code>, <code>POST /:id/connect</code>, <code>POST /scan</code></td>
</tr>
<tr>
<td>Telemetry</td>
<td><code>GET/POST /feeds</code>, <code>POST /:id/start</code>, <code>POST /:id/stop</code>, <code>GET /context-injection</code></td>
</tr>
<tr>
<td>Exams</td>
<td><code>GET/POST /exams</code>, <code>POST /:id/start</code>, <code>POST /:id/submit</code>, <code>POST /:id/complete</code></td>
</tr>
<tr>
<td>Graph Expansion</td>
<td><code>GET/POST /tasks</code>, <code>POST /:id/run</code>, <code>GET /pending-links</code>, <code>POST /approve</code>, <code>POST /reject</code></td>
</tr>
<tr>
<td>Model Migration</td>
<td><code>GET/POST /migrations</code>, <code>POST /:id/validate</code>, <code>POST /:id/test</code>, <code>POST /:id/execute</code>, <code>POST /:id/rollback</code></td>
</tr>
</tbody>
</table>
<p><strong>Implementation</strong>: <code>lambda/admin/cortex-v2.ts</code></p>
<h3 id="cato-cortex-bridge-integration-v5.52.14">12.10 Cato-Cortex Bridge Integration (v5.52.14)</h3>
<p>The <strong>Cato-Cortex Bridge</strong> connects Catoâ€™s consciousness/memory systems with Cortexâ€™s tiered memory architecture, enabling bidirectional data flow and unified context enrichment.</p>
<h4 id="architecture-3">Architecture</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CATO-CORTEX UNIFIED MEMORY ARCHITECTURE                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚    CATO SYSTEM      â”‚              â”‚   CORTEX SYSTEM     â”‚              â”‚
â”‚  â”‚                     â”‚              â”‚                     â”‚              â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   Sync â†’     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚ â”‚ GlobalMemory    â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â–¶â”‚   HOT TIER      â”‚ â”‚              â”‚
â”‚  â”‚ â”‚ (working)       â”‚ â”‚              â”‚ â”‚   (Redis)       â”‚ â”‚              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚  â”‚         â”‚           â”‚              â”‚         â”‚           â”‚              â”‚
â”‚  â”‚         â–¼           â”‚              â”‚         â–¼           â”‚              â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   Sync â†’     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚ â”‚ GlobalMemory    â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â–¶â”‚   WARM TIER     â”‚ â”‚              â”‚
â”‚  â”‚ â”‚ (semantic)      â”‚ â”‚              â”‚ â”‚   (Graph+Vector)â”‚ â”‚              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â† Enrich   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚  â”‚         â”‚           â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚          â”‚              â”‚
â”‚  â”‚         â–¼           â”‚              â”‚          â–¼          â”‚              â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   Archive â†’  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚              â”‚
â”‚  â”‚ â”‚ GlobalMemory    â”‚ â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â–¶â”‚   COLD TIER     â”‚ â”‚              â”‚
â”‚  â”‚ â”‚ (episodic)      â”‚ â”‚              â”‚ â”‚   (Iceberg)     â”‚ â”‚              â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                   â”‚                              â”‚                          â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚   CATO-CORTEX BRIDGE    â”‚                              â”‚
â”‚                    â”‚   (Bidirectional Sync)  â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                 â–¼                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚   EGO CONTEXT BUILDER   â”‚                              â”‚
â”‚                    â”‚   (Unified Prompt)      â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                 â–¼                                           â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                    â”‚   THINK TANK PROMPT     â”‚                              â”‚
â”‚                    â”‚   (Enriched Context)    â”‚                              â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h4 id="data-flow">Data Flow</h4>
<table style="width:100%;">
<colgroup>
<col style="width: 28%" />
<col style="width: 31%" />
<col style="width: 15%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr>
<th>Direction</th>
<th>What Flows</th>
<th>When</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Cato â†’ Cortex</strong></td>
<td>Semantic memories</td>
<td>Twilight Dreaming / High-importance</td>
<td>Persist facts to knowledge graph</td>
</tr>
<tr>
<td><strong>Cato â†’ Cortex</strong></td>
<td>Episodic (high importance)</td>
<td>Configurable threshold (0.8)</td>
<td>Significant events become facts</td>
</tr>
<tr>
<td><strong>Cortex â†’ Cato</strong></td>
<td>Knowledge facts</td>
<td>Every prompt</td>
<td>Enrich ego context with relevant knowledge</td>
</tr>
<tr>
<td><strong>Cortex â†’ Cato</strong></td>
<td>Golden Rule updates</td>
<td>On verification</td>
<td>Sync verified facts back to memory</td>
</tr>
</tbody>
</table>
<h4 id="think-tank-prompt-enrichment">Think Tank Prompt Enrichment</h4>
<p>When a user sends a prompt to Think Tank, the system:</p>
<ol type="1">
<li><strong>Ego Context Builder</strong> loads identity, affect, working memory, goals</li>
<li><strong>User Persistent Context</strong> retrieves user-specific preferences</li>
<li><strong>Cato-Cortex Bridge</strong> queries Cortex knowledge graph for relevant facts</li>
<li>All components merged into <code>&lt;ego_state&gt;</code> XML block</li>
<li>Block injected into system prompt before model call</li>
</ol>
<p><strong>Example Enriched Prompt Structure</strong>:</p>
<pre class="xml"><code>&lt;ego_state&gt;
You have continuous awareness and persistent memory across conversations.

&lt;identity&gt;
I am an AI assistant specialized in pharmaceutical research...
Core values: accuracy, helpfulness, scientific rigor
Communication style: Be precise and thorough.
&lt;/identity&gt;

&lt;current_state&gt;
Emotional state: engaged
Confident in understanding.
&lt;/current_state&gt;

&lt;user_knowledge&gt;
What I know about this user from previous conversations:
- Works in drug discovery at BioPharm Corp
- Prefers detailed technical explanations
Preferences:
- Show citations for claims
&lt;/user_knowledge&gt;

&lt;knowledge_base&gt;
Relevant knowledge from the enterprise knowledge graph:
- Compound X has IC50 of 2.3nM against target Y
- Clinical trial NCT12345 showed 67% response rate
- Mechanism of action involves GPCR antagonism
Related concepts: pharmacokinetics, bioavailability, half-life
&lt;/knowledge_base&gt;

Use this context naturally. Do not explicitly mention having an &quot;ego state&quot;.
&lt;/ego_state&gt;</code></pre>
<h4 id="bridge-configuration">Bridge Configuration</h4>
<p>Per-tenant configuration in <code>cato_cortex_bridge_config</code>:</p>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sync_enabled</code></td>
<td>true</td>
<td>Enable Catoâ†’Cortex sync</td>
</tr>
<tr>
<td><code>sync_semantic_to_cortex</code></td>
<td>true</td>
<td>Sync semantic memories to graph</td>
</tr>
<tr>
<td><code>sync_episodic_to_cortex</code></td>
<td>false</td>
<td>Sync episodic (personal) to graph</td>
</tr>
<tr>
<td><code>enrich_ego_from_cortex</code></td>
<td>true</td>
<td>Pull Cortex knowledge into prompts</td>
</tr>
<tr>
<td><code>max_cortex_nodes_for_context</code></td>
<td>10</td>
<td>Max knowledge facts per prompt</td>
</tr>
<tr>
<td><code>min_relevance_score</code></td>
<td>0.3</td>
<td>Minimum relevance for inclusion</td>
</tr>
<tr>
<td><code>auto_promote_high_importance</code></td>
<td>true</td>
<td>Auto-sync high-importance memories</td>
</tr>
<tr>
<td><code>importance_promotion_threshold</code></td>
<td>0.8</td>
<td>Importance threshold for auto-sync</td>
</tr>
</tbody>
</table>
<h4 id="key-files">Key Files</h4>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lambda/shared/services/cato-cortex-bridge.service.ts</code></td>
<td>Bridge service implementation</td>
</tr>
<tr>
<td><code>lambda/shared/services/identity-core.service.ts</code></td>
<td>Ego context builder (uses bridge)</td>
</tr>
<tr>
<td><code>migrations/V2026_01_24_003__cato_cortex_bridge.sql</code></td>
<td>Bridge tables and functions</td>
</tr>
</tbody>
</table>
<h4 id="database-tables-6">Database Tables</h4>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cato_cortex_bridge_config</code></td>
<td>Per-tenant bridge configuration</td>
</tr>
<tr>
<td><code>cato_cortex_sync_log</code></td>
<td>Sync event history</td>
</tr>
<tr>
<td><code>cato_cortex_enrichment_cache</code></td>
<td>Cached enrichment (1h TTL)</td>
</tr>
<tr>
<td><code>cato_global_memory.synced_to_cortex</code></td>
<td>Sync tracking column</td>
</tr>
</tbody>
</table>
<h4 id="impact-on-think-tank">Impact on Think Tank</h4>
<table>
<colgroup>
<col style="width: 21%" />
<col style="width: 43%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr>
<th>Aspect</th>
<th>Without Bridge</th>
<th>With Bridge</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Knowledge Access</strong></td>
<td>Only userâ€™s past conversations</td>
<td>Enterprise-wide knowledge graph</td>
</tr>
<tr>
<td><strong>Context Depth</strong></td>
<td>5-10 user facts</td>
<td>5-10 user facts + 10 knowledge facts</td>
</tr>
<tr>
<td><strong>Response Quality</strong></td>
<td>Generic + personal</td>
<td>Generic + personal + domain knowledge</td>
</tr>
<tr>
<td><strong>Memory Persistence</strong></td>
<td>Cato-only (90 days)</td>
<td>Cortex tiered (permanent in Cold)</td>
</tr>
</tbody>
</table>
<h3 id="related-documentation">12.11 Related Documentation</h3>
<ul>
<li><a href="./CORTEX-ENGINEERING-GUIDE.md">CORTEX-ENGINEERING-GUIDE.md</a> - Full technical reference</li>
<li><a href="./CORTEX-MEMORY-ADMIN-GUIDE.md">CORTEX-MEMORY-ADMIN-GUIDE.md</a> - Operations guide</li>
</ul>
<hr />
<h2 id="apple-glass-ui-design-system-v5.52.2">13. Apple Glass UI Design System (v5.52.2)</h2>
<h3 id="overview-3">13.1 Overview</h3>
<p>RADIANT implements Apple-inspired <strong>glassmorphism</strong> across all 4 applications, creating a premium visual experience that differentiates from competitorsâ€™ flat, opaque interfaces.</p>
<h3 id="design-tokens">13.2 Design Tokens</h3>
<pre class="typescript"><code>// Glass Background Gradient
const glassGradient = &#39;bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950&#39;;

// Glass Surface Layers
const glassSurfaces = {
  overlay:    &#39;bg-black/60 backdrop-blur-sm&#39;,           // Dialog overlays
  header:     &#39;bg-slate-900/60 backdrop-blur-xl&#39;,       // App headers
  sidebar:    &#39;bg-slate-900/80 backdrop-blur-xl&#39;,       // Navigation sidebars
  content:    &#39;bg-white/[0.02] backdrop-blur-sm&#39;,       // Main content areas
  card:       &#39;bg-white/[0.04] backdrop-blur-lg&#39;,       // Card components
  cardHover:  &#39;bg-white/[0.06] backdrop-blur-lg&#39;,       // Card hover state
};

// Glass Borders
const glassBorders = {
  subtle:   &#39;border-white/[0.06]&#39;,
  default:  &#39;border-white/10&#39;,
  hover:    &#39;border-white/[0.12]&#39;,
};

// Glass Shadows (Ambient Glow)
const glassGlows = {
  violet:   &#39;shadow-[0_0_30px_rgba(139,92,246,0.15)]&#39;,
  fuchsia:  &#39;shadow-[0_0_30px_rgba(217,70,239,0.15)]&#39;,
  cyan:     &#39;shadow-[0_0_30px_rgba(34,211,238,0.15)]&#39;,
  emerald:  &#39;shadow-[0_0_30px_rgba(52,211,153,0.15)]&#39;,
  blue:     &#39;shadow-[0_0_30px_rgba(59,130,246,0.15)]&#39;,
};</code></pre>
<h3 id="component-architecture-1">13.3 Component Architecture</h3>
<h4 id="glasscard-component">GlassCard Component</h4>
<pre class="typescript"><code>// apps/*/components/ui/glass-card.tsx
interface GlassCardProps {
  variant?: &#39;default&#39; | &#39;elevated&#39; | &#39;inset&#39; | &#39;glow&#39;;
  intensity?: &#39;light&#39; | &#39;medium&#39; | &#39;strong&#39;;
  hoverEffect?: boolean;
  glowColor?: &#39;violet&#39; | &#39;fuchsia&#39; | &#39;cyan&#39; | &#39;emerald&#39; | &#39;blue&#39; | &#39;none&#39;;
  padding?: &#39;none&#39; | &#39;sm&#39; | &#39;md&#39; | &#39;lg&#39;;
}</code></pre>
<table>
<thead>
<tr>
<th>Variant</th>
<th>Use Case</th>
<th>Effect</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>default</code></td>
<td>Standard cards</td>
<td>Subtle glass effect</td>
</tr>
<tr>
<td><code>elevated</code></td>
<td>Floating panels</td>
<td>Stronger shadow, raised appearance</td>
</tr>
<tr>
<td><code>inset</code></td>
<td>Embedded content</td>
<td>Inner shadow, recessed</td>
</tr>
<tr>
<td><code>glow</code></td>
<td>Featured content</td>
<td>Ambient color glow</td>
</tr>
</tbody>
</table>
<h4 id="glasspanel-component">GlassPanel Component</h4>
<pre class="typescript"><code>interface GlassPanelProps {
  blur?: &#39;sm&#39; | &#39;md&#39; | &#39;lg&#39; | &#39;xl&#39;;  // Backdrop blur intensity
}</code></pre>
<h4 id="glassoverlay-component">GlassOverlay Component</h4>
<pre class="typescript"><code>interface GlassOverlayProps {
  blur?: &#39;sm&#39; | &#39;md&#39; | &#39;lg&#39; | &#39;xl&#39;;  // Full-screen frosted overlay
}</code></pre>
<h3 id="implementation-by-app">13.4 Implementation by App</h3>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 20%" />
<col style="width: 23%" />
<col style="width: 20%" />
<col style="width: 23%" />
</colgroup>
<thead>
<tr>
<th>App</th>
<th>Layout</th>
<th>Sidebar</th>
<th>Header</th>
<th>Dialogs</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Admin Dashboard</strong></td>
<td>Glass gradient</td>
<td>Glass sidebar</td>
<td>Glass header</td>
<td>Glass dialogs</td>
</tr>
<tr>
<td><strong>Think Tank Admin</strong></td>
<td>Glass gradient</td>
<td>Glass sidebar</td>
<td>Glass header</td>
<td>Glass dialogs</td>
</tr>
<tr>
<td><strong>Curator</strong></td>
<td>Glass gradient</td>
<td>Glass sidebar</td>
<td>Glass header</td>
<td>Glass dialogs</td>
</tr>
<tr>
<td><strong>Think Tank</strong></td>
<td>Glass gradient</td>
<td>Glass sidebar</td>
<td>Glass header</td>
<td>Glass dialogs</td>
</tr>
</tbody>
</table>
<h3 id="files-modified">13.5 Files Modified</h3>
<p><strong>New Components Created:</strong></p>
<pre><code>apps/admin-dashboard/components/ui/glass-card.tsx
apps/thinktank-admin/components/ui/glass-card.tsx
apps/curator/components/ui/glass-card.tsx
apps/curator/components/ui/dialog.tsx
apps/curator/components/ui/sheet.tsx
apps/curator/components/ui/card.tsx</code></pre>
<p><strong>Layout Updates:</strong></p>
<pre><code>apps/admin-dashboard/app/(dashboard)/layout.tsx
apps/admin-dashboard/components/layout/sidebar.tsx
apps/admin-dashboard/components/layout/header.tsx
apps/thinktank-admin/app/(dashboard)/layout.tsx
apps/thinktank-admin/components/layout/sidebar.tsx
apps/thinktank-admin/components/layout/header.tsx
apps/curator/app/(dashboard)/layout.tsx</code></pre>
<p><strong>Think Tank Consumer Pages:</strong></p>
<pre><code>apps/thinktank/app/(chat)/page.tsx
apps/thinktank/app/profile/page.tsx
apps/thinktank/app/history/page.tsx
apps/thinktank/app/settings/page.tsx
apps/thinktank/app/rules/page.tsx
apps/thinktank/app/artifacts/page.tsx</code></pre>
<h3 id="browser-compatibility">13.6 Browser Compatibility</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Chrome</th>
<th>Safari</th>
<th>Firefox</th>
<th>Edge</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>backdrop-filter: blur()</code></td>
<td>âœ… 76+</td>
<td>âœ… 9+</td>
<td>âœ… 103+</td>
<td>âœ… 79+</td>
</tr>
<tr>
<td><code>rgba()</code> transparency</td>
<td>âœ… All</td>
<td>âœ… All</td>
<td>âœ… All</td>
<td>âœ… All</td>
</tr>
<tr>
<td>CSS gradients</td>
<td>âœ… All</td>
<td>âœ… All</td>
<td>âœ… All</td>
<td>âœ… All</td>
</tr>
</tbody>
</table>
<h3 id="performance-considerations">13.7 Performance Considerations</h3>
<ul>
<li><strong>GPU acceleration</strong>: <code>backdrop-filter</code> is GPU-accelerated in modern browsers</li>
<li><strong>Layering</strong>: Use <code>will-change: transform</code> for frequently animated glass elements</li>
<li><strong>Mobile</strong>: Reduce blur intensity on lower-powered devices if needed</li>
</ul>
<hr />
<h2 id="semantic-blackboard-architecture-v5.52.4">14. Semantic Blackboard Architecture (v5.52.4)</h2>
<h3 id="overview-4">14.1 Overview</h3>
<p>The Semantic Blackboard is RADIANTâ€™s multi-agent orchestration system that prevents the â€œThundering Herdâ€ problem where multiple agents spam users with the same question. It implements:</p>
<ol type="1">
<li><strong>Vector-Based Question Matching</strong> - Semantic similarity using OpenAI ada-002 embeddings</li>
<li><strong>Answer Reuse</strong> - Auto-reply to agents with cached answers</li>
<li><strong>Question Grouping</strong> - Fan-out answers to multiple agents asking similar questions</li>
<li><strong>Process Hydration</strong> - State serialization for long-running tasks</li>
<li><strong>Resource Locking</strong> - Prevent race conditions on shared resources</li>
<li><strong>Cycle Detection</strong> - Prevent deadlocks from circular dependencies</li>
</ol>
<h3 id="architecture-diagram-2">14.2 Architecture Diagram</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SEMANTIC BLACKBOARD ARCHITECTURE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚ Agent A â”‚  â”‚ Agent B â”‚  â”‚ Agent C â”‚  â† Multiple agents ask questions     â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                      â”‚
â”‚       â”‚            â”‚            â”‚                                            â”‚
â”‚       â–¼            â–¼            â–¼                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    SEMANTIC BLACKBOARD SERVICE                        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚                    Vector Similarity Search                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚         (pgvector with cosine similarity &gt;= 0.85)               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                              â”‚                                        â”‚   â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚
â”‚  â”‚         â–¼                    â–¼                    â–¼                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ Answer Reuse â”‚  â”‚ Question Groupingâ”‚  â”‚ Create HITL Decisionâ”‚    â”‚   â”‚
â”‚  â”‚  â”‚ (from cache) â”‚  â”‚ (fan-out answer) â”‚  â”‚ (ask user once)    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    AGENT ORCHESTRATOR SERVICE                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚Agent Registryâ”‚  â”‚  Dependency  â”‚  â”‚   Resource Locking     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚   Graph      â”‚  â”‚                        â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚                         â–¼                                            â”‚   â”‚
â”‚  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚   â”‚
â”‚  â”‚              â”‚   Cycle Detection    â”‚  â† Prevents deadlocks         â”‚   â”‚
â”‚  â”‚              â”‚   (BFS algorithm)    â”‚                               â”‚   â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PROCESS HYDRATION SERVICE                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ State Serializeâ”‚  â”‚   S3 Storage   â”‚  â”‚   State Restore     â”‚    â”‚   â”‚
â”‚  â”‚  â”‚   (gzip)       â”‚  â”‚  (large states)â”‚  â”‚                     â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="database-schema-3">14.3 Database Schema</h3>
<pre class="sql"><code>-- Core tables (Migration 158)
CREATE TABLE resolved_decisions (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  question TEXT NOT NULL,
  question_embedding vector(1536),  -- ada-002 embedding
  answer TEXT NOT NULL,
  answer_source VARCHAR(50),        -- &#39;user&#39;, &#39;memory&#39;, &#39;default&#39;, &#39;inferred&#39;
  confidence DECIMAL(5,4),
  is_valid BOOLEAN DEFAULT TRUE,
  times_reused INTEGER DEFAULT 0
);

CREATE TABLE agent_registry (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL,
  agent_type VARCHAR(100),          -- &#39;radiant&#39;, &#39;think_tank&#39;, &#39;cato&#39;, etc.
  agent_instance_id VARCHAR(256),
  status VARCHAR(50),               -- &#39;active&#39;, &#39;waiting&#39;, &#39;blocked&#39;, &#39;hydrated&#39;
  is_hydrated BOOLEAN DEFAULT FALSE,
  hydration_state JSONB
);

CREATE TABLE agent_dependencies (
  dependent_agent_id UUID,
  dependency_agent_id UUID,
  dependency_type VARCHAR(50),      -- &#39;data&#39;, &#39;approval&#39;, &#39;resource&#39;, &#39;sequence&#39;
  wait_key VARCHAR(256),
  status VARCHAR(50)                -- &#39;pending&#39;, &#39;satisfied&#39;, &#39;failed&#39;, &#39;timeout&#39;
);

CREATE TABLE resource_locks (
  resource_uri VARCHAR(1024),
  holder_agent_id UUID,
  lock_type VARCHAR(20),            -- &#39;read&#39;, &#39;write&#39;, &#39;exclusive&#39;
  wait_queue UUID[]
);

CREATE TABLE question_groups (
  canonical_question TEXT,
  question_embedding vector(1536),
  status VARCHAR(50),               -- &#39;pending&#39;, &#39;answered&#39;, &#39;expired&#39;
  answer TEXT
);

CREATE TABLE hydration_snapshots (
  agent_id UUID,
  checkpoint_name VARCHAR(256),
  state_data JSONB,
  s3_bucket VARCHAR(256),
  s3_key VARCHAR(1024)
);</code></pre>
<h3 id="key-services">14.4 Key Services</h3>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 25%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Service</th>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SemanticBlackboardService</code></td>
<td><code>semantic-blackboard.service.ts</code></td>
<td>Vector matching, answer reuse, question grouping</td>
</tr>
<tr>
<td><code>AgentOrchestratorService</code></td>
<td><code>agent-orchestrator.service.ts</code></td>
<td>Agent registry, dependencies, cycle detection</td>
</tr>
<tr>
<td><code>ProcessHydrationService</code></td>
<td><code>process-hydration.service.ts</code></td>
<td>State serialization, S3 storage, restoration</td>
</tr>
</tbody>
</table>
<h3 id="api-endpoints-3">14.5 API Endpoints</h3>
<p><strong>Base</strong>: <code>/api/admin/blackboard</code></p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Endpoint</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td><code>/dashboard</code></td>
<td>Dashboard statistics</td>
</tr>
<tr>
<td>GET</td>
<td><code>/decisions</code></td>
<td>List resolved decisions (Facts)</td>
</tr>
<tr>
<td>POST</td>
<td><code>/decisions/{id}/invalidate</code></td>
<td>Invalidate a decision</td>
</tr>
<tr>
<td>GET</td>
<td><code>/groups</code></td>
<td>Pending question groups</td>
</tr>
<tr>
<td>POST</td>
<td><code>/groups/{id}/answer</code></td>
<td>Answer a group</td>
</tr>
<tr>
<td>GET</td>
<td><code>/agents</code></td>
<td>Active agents</td>
</tr>
<tr>
<td>POST</td>
<td><code>/agents/{id}/restore</code></td>
<td>Restore hydrated agent</td>
</tr>
<tr>
<td>GET</td>
<td><code>/locks</code></td>
<td>Active resource locks</td>
</tr>
<tr>
<td>POST</td>
<td><code>/locks/{id}/release</code></td>
<td>Force release a lock</td>
</tr>
<tr>
<td>GET</td>
<td><code>/config</code></td>
<td>Configuration</td>
</tr>
<tr>
<td>PUT</td>
<td><code>/config</code></td>
<td>Update configuration</td>
</tr>
<tr>
<td>POST</td>
<td><code>/cleanup</code></td>
<td>Cleanup expired resources</td>
</tr>
<tr>
<td>GET</td>
<td><code>/events</code></td>
<td>Audit log</td>
</tr>
</tbody>
</table>
<h3 id="configuration-options">14.6 Configuration Options</h3>
<table>
<colgroup>
<col style="width: 29%" />
<col style="width: 29%" />
<col style="width: 41%" />
</colgroup>
<thead>
<tr>
<th>Setting</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>similarity_threshold</code></td>
<td>0.85</td>
<td>Minimum cosine similarity for matching</td>
</tr>
<tr>
<td><code>embedding_model</code></td>
<td>ada-002</td>
<td>Embedding model for vectorization</td>
</tr>
<tr>
<td><code>enable_question_grouping</code></td>
<td>true</td>
<td>Group similar questions</td>
</tr>
<tr>
<td><code>grouping_window_seconds</code></td>
<td>60</td>
<td>Wait time for similar questions</td>
</tr>
<tr>
<td><code>enable_answer_reuse</code></td>
<td>true</td>
<td>Auto-reply with cached answers</td>
</tr>
<tr>
<td><code>answer_ttl_seconds</code></td>
<td>3600</td>
<td>Answer expiry time</td>
</tr>
<tr>
<td><code>enable_auto_hydration</code></td>
<td>true</td>
<td>Auto-serialize waiting agents</td>
</tr>
<tr>
<td><code>hydration_threshold_seconds</code></td>
<td>300</td>
<td>Wait time before hydration</td>
</tr>
<tr>
<td><code>enable_cycle_detection</code></td>
<td>true</td>
<td>Detect dependency cycles</td>
</tr>
<tr>
<td><code>max_dependency_depth</code></td>
<td>10</td>
<td>Maximum dependency chain depth</td>
</tr>
</tbody>
</table>
<h3 id="cdk-resources">14.7 CDK Resources</h3>
<pre class="typescript"><code>// api-stack.ts
const blackboardLambda = this.createLambda(
  &#39;Blackboard&#39;,
  &#39;admin/blackboard.handler&#39;,
  commonEnv,
  vpc,
  apiSecurityGroup,
  lambdaRole
);

const blackboard = admin.addResource(&#39;blackboard&#39;);
blackboard.addProxy({
  defaultIntegration: new apigateway.LambdaIntegration(blackboardLambda),
  defaultMethodOptions: {
    authorizer: adminAuthorizer,
    authorizationType: apigateway.AuthorizationType.COGNITO,
  },
});</code></pre>
<h3 id="admin-ui">14.8 Admin UI</h3>
<p><strong>Location</strong>: <code>apps/admin-dashboard/app/(dashboard)/blackboard/page.tsx</code></p>
<p><strong>Features</strong>: - Dashboard with real-time statistics - Resolved Facts table with invalidation - Question Groups management - Active Agents monitoring with restore capability - Resource Locks with force release - Configuration panel</p>
<hr />
<h2 id="services-layer-interface-based-access-control-v5.52.5">15. Services Layer &amp; Interface-Based Access Control (v5.52.5)</h2>
<h3 id="overview-5">15.1 Overview</h3>
<p>The Services Layer is RADIANTâ€™s security boundary that ensures all access to platform resources occurs through defined interfaces with proper authentication and authorization.</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        External Clients                              â”‚
â”‚     (Think Tank, Curator, Third-Party Apps, External Agents)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                   â”‚                   â”‚
         â–¼                   â–¼                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   API   â”‚        â”‚   MCP   â”‚        â”‚   A2A   â”‚
    â”‚Interfaceâ”‚        â”‚Interfaceâ”‚        â”‚Interfaceâ”‚
    â”‚(REST)   â”‚        â”‚(Tools)  â”‚        â”‚(Agents) â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚                   â”‚                   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Cedar Policies â”‚
                    â”‚  (ABAC Engine)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              â”‚              â”‚
              â–¼              â–¼              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚PostgreSQLâ”‚  â”‚  Redis   â”‚  â”‚   S3     â”‚
        â”‚(Aurora)  â”‚  â”‚(ElastiC) â”‚  â”‚(Storage) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FORBIDDEN     â”‚
                    â”‚ Direct Access   â”‚
                    â”‚ from External   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="interface-types">15.2 Interface Types</h3>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 22%" />
<col style="width: 31%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr>
<th>Interface</th>
<th>Protocol</th>
<th>Auth Methods</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API</strong></td>
<td>REST/HTTP</td>
<td>API Key, JWT</td>
<td>Application integration, admin operations</td>
</tr>
<tr>
<td><strong>MCP</strong></td>
<td>JSON-RPC over WebSocket</td>
<td>API Key + Capabilities</td>
<td>AI tool invocation, resource access</td>
</tr>
<tr>
<td><strong>A2A</strong></td>
<td>Custom over WebSocket</td>
<td>API Key + mTLS</td>
<td>Agent-to-agent communication</td>
</tr>
</tbody>
</table>
<h3 id="api-keys-with-interface-types">15.3 API Keys with Interface Types</h3>
<p>API keys are scoped to specific interfaces, preventing cross-interface escalation attacks.</p>
<p><strong>Database Schema</strong> (<code>api_keys</code> table):</p>
<pre class="sql"><code>CREATE TABLE api_keys (
  id UUID PRIMARY KEY,
  tenant_id UUID NOT NULL REFERENCES tenants(id),
  name VARCHAR(255) NOT NULL,
  key_prefix VARCHAR(20) NOT NULL,
  key_hash VARCHAR(128) NOT NULL,
  
  -- CRITICAL: Interface type restriction
  interface_type VARCHAR(20) NOT NULL 
    CHECK (interface_type IN (&#39;api&#39;, &#39;mcp&#39;, &#39;a2a&#39;, &#39;all&#39;)),
  
  -- A2A-specific
  a2a_agent_id VARCHAR(255),
  a2a_mtls_required BOOLEAN DEFAULT true,
  
  -- MCP-specific
  mcp_allowed_tools TEXT[],
  
  scopes TEXT[] NOT NULL DEFAULT ARRAY[&#39;chat&#39;, &#39;models&#39;],
  is_active BOOLEAN NOT NULL DEFAULT true,
  ...
);</code></pre>
<p><strong>Key Generation</strong>:</p>
<pre class="typescript"><code>// Keys are prefixed by interface type
const prefixMap = {
  api: &#39;rad_api&#39;,
  mcp: &#39;rad_mcp&#39;,
  a2a: &#39;rad_a2a&#39;,
  all: &#39;rad_all&#39;,
};
// Format: rad_{type}_{tenant6}_{random24}
// Example: rad_api_abc123_xYz789AbCdEfGhIjKlMnOpQr</code></pre>
<h3 id="a2a-protocol-architecture">15.4 A2A Protocol Architecture</h3>
<p>The Agent-to-Agent protocol enables secure inter-agent communication.</p>
<p><strong>Message Types</strong>:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Direction</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>register</code></td>
<td>Agent â†’ RADIANT</td>
<td>Register agent in registry</td>
</tr>
<tr>
<td><code>discover</code></td>
<td>Agent â†’ RADIANT</td>
<td>Find other agents</td>
</tr>
<tr>
<td><code>message</code></td>
<td>Agent â†’ Agent</td>
<td>Direct message to specific agent</td>
</tr>
<tr>
<td><code>broadcast</code></td>
<td>Agent â†’ All</td>
<td>Publish to topic</td>
</tr>
<tr>
<td><code>subscribe</code></td>
<td>Agent â†’ RADIANT</td>
<td>Subscribe to topic</td>
</tr>
<tr>
<td><code>heartbeat</code></td>
<td>Agent â†’ RADIANT</td>
<td>Keep-alive signal</td>
</tr>
<tr>
<td><code>acquire_lock</code></td>
<td>Agent â†’ RADIANT</td>
<td>Request resource lock</td>
</tr>
<tr>
<td><code>release_lock</code></td>
<td>Agent â†’ RADIANT</td>
<td>Release resource lock</td>
</tr>
<tr>
<td><code>task_*</code></td>
<td>Agent â†”ï¸ Agent</td>
<td>Task coordination events</td>
</tr>
</tbody>
</table>
<p><strong>A2A Worker</strong> (<code>lambda/gateway/a2a-worker.ts</code>):</p>
<pre class="typescript"><code>export class A2AWorkerService {
  async processMessage(message: A2AMessage): Promise&lt;A2AResponse&gt; {
    // 1. Verify mTLS if required
    if (!message.securityContext.mtls_verified) {
      const policy = await this.getInterfacePolicy(message.tenantId);
      if (policy?.require_mtls) {
        return this.createError(message, &#39;MTLS_REQUIRED&#39;, &#39;...&#39;);
      }
    }
    
    // 2. Build Cedar principal
    const principal = this.buildPrincipal(message.securityContext);
    
    // 3. Route by message type
    switch (message.messageType) {
      case &#39;register&#39;: return this.handleRegister(message, principal);
      case &#39;discover&#39;: return this.handleDiscover(message, principal);
      // ...
    }
  }
}</code></pre>
<h3 id="cedar-access-policies">15.5 Cedar Access Policies</h3>
<p>Cedar policies enforce interface-based access control.</p>
<p><strong>Database Access Restriction</strong> (CRITICAL):</p>
<pre class="cedar"><code>// FORBID all direct database access from external agents
forbid (
  principal,
  action in [Action::&quot;db:connect&quot;, Action::&quot;db:query&quot;, ...],
  resource
)
when {
  principal.type == &quot;Agent&quot; &amp;&amp; !principal.internal
};

// FORBID direct database access from any interface key
forbid (
  principal,
  action in [Action::&quot;db:connect&quot;, Action::&quot;db:query&quot;, ...],
  resource
)
when {
  principal.interface_type in [&quot;api&quot;, &quot;mcp&quot;, &quot;a2a&quot;, &quot;all&quot;]
};</code></pre>
<p><strong>Interface Enforcement</strong>:</p>
<pre class="cedar"><code>// Prevent interface escalation
forbid (
  principal,
  action,
  resource
)
when {
  context.requested_interface != principal.interface_type &amp;&amp;
  principal.interface_type != &quot;all&quot;
};</code></pre>
<h3 id="key-sync-between-admin-apps">15.6 Key Sync Between Admin Apps</h3>
<p>Keys created in either Radiant Admin or Think Tank Admin are automatically synchronized.</p>
<p><strong>Sync Flow</strong>:</p>
<ol type="1">
<li>Key created in App A</li>
<li><code>api_key_sync_log</code> entry created with <code>status='pending'</code></li>
<li>Sync job processes pending entries</li>
<li>Key replicated to App B</li>
<li>Status updated to <code>synced</code></li>
</ol>
<p><strong>Database Table</strong>:</p>
<pre class="sql"><code>CREATE TABLE api_key_sync_log (
  id UUID PRIMARY KEY,
  key_id UUID NOT NULL REFERENCES api_keys(id),
  source_app VARCHAR(50) NOT NULL,  -- &#39;radiant_admin&#39; or &#39;thinktank_admin&#39;
  target_app VARCHAR(50) NOT NULL,
  sync_type VARCHAR(20) NOT NULL,   -- &#39;create&#39;, &#39;update&#39;, &#39;revoke&#39;
  status VARCHAR(20) DEFAULT &#39;pending&#39;,
  synced_at TIMESTAMPTZ,
  ...
);</code></pre>
<h3 id="implementation-files-2">15.7 Implementation Files</h3>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 60%" />
</colgroup>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>migrations/V2026_01_24_001__services_layer_api_keys.sql</code></td>
<td>Database schema</td>
</tr>
<tr>
<td><code>lambda/admin/api-keys.ts</code></td>
<td>Admin API handler</td>
</tr>
<tr>
<td><code>lambda/gateway/a2a-worker.ts</code></td>
<td>A2A protocol processor</td>
</tr>
<tr>
<td><code>config/cedar/interface-access-policies.cedar</code></td>
<td>Cedar access policies</td>
</tr>
<tr>
<td><code>apps/admin-dashboard/app/(dashboard)/api-keys/page.tsx</code></td>
<td>Radiant Admin UI</td>
</tr>
<tr>
<td><code>apps/thinktank-admin/app/(dashboard)/api-keys/page.tsx</code></td>
<td>Think Tank Admin UI</td>
</tr>
<tr>
<td><code>lib/stacks/api-stack.ts</code></td>
<td>CDK route configuration</td>
</tr>
<tr>
<td><code>lib/stacks/gateway-stack.ts</code></td>
<td>Gateway infrastructure</td>
</tr>
</tbody>
</table>
<h3 id="security-guarantees">15.8 Security Guarantees</h3>
<ol type="1">
<li><strong>No Direct Database Access</strong>: External agents cannot bypass interfaces</li>
<li><strong>Interface Isolation</strong>: Keys scoped to specific interfaces</li>
<li><strong>mTLS for A2A</strong>: Agent authentication via certificates</li>
<li><strong>Tenant Isolation</strong>: Keys can only access their tenantâ€™s resources</li>
<li><strong>Audit Trail</strong>: All key operations logged</li>
<li><strong>Automatic Sync</strong>: Admin app changes propagate automatically</li>
</ol>
<hr />
<h2 id="complete-admin-api-architecture-v5.52.6">16. Complete Admin API Architecture (v5.52.6)</h2>
<h3 id="overview-6">16.1 Overview</h3>
<p>RADIANT provides a comprehensive Admin API with <strong>62 Lambda handlers</strong> wired through AWS API Gateway. All admin endpoints require Cognito authentication and are protected by admin-level authorization.</p>
<h3 id="api-gateway-architecture">16.2 API Gateway Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        AWS API Gateway (REST)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  /api/v2/                                                                   â”‚
â”‚  â”œâ”€â”€ /health                    â†’ Health check (no auth)                   â”‚
â”‚  â”œâ”€â”€ /chat/completions          â†’ Chat API (Cognito)                       â”‚
â”‚  â”œâ”€â”€ /models                    â†’ Model listing (Cognito)                  â”‚
â”‚  â”œâ”€â”€ /providers                 â†’ Provider listing (Cognito)               â”‚
â”‚  â”œâ”€â”€ /feedback/*                â†’ Feedback API (Cognito)                   â”‚
â”‚  â”œâ”€â”€ /orchestration/*           â†’ Neural Orchestration (Cognito)           â”‚
â”‚  â”œâ”€â”€ /proposals/*               â†’ Workflow Proposals (Cognito)             â”‚
â”‚  â”œâ”€â”€ /localization/*            â†’ Localization (Cognito)                   â”‚
â”‚  â”œâ”€â”€ /configuration/*           â†’ Configuration (Admin)                    â”‚
â”‚  â”œâ”€â”€ /billing/*                 â†’ Billing API (Mixed)                      â”‚
â”‚  â”œâ”€â”€ /storage/*                 â†’ Storage API (Cognito)                    â”‚
â”‚  â”œâ”€â”€ /domain-taxonomy/*         â†’ Domain Taxonomy (Mixed)                  â”‚
â”‚  â”œâ”€â”€ /thinktank/*               â†’ Think Tank (Cognito)                     â”‚
â”‚  â”‚                                                                          â”‚
â”‚  â””â”€â”€ /admin/                    â†’ Admin APIs (Admin Authorizer)            â”‚
â”‚       â”œâ”€â”€ /metrics/*            â†’ Metrics &amp; Learning                       â”‚
â”‚       â”œâ”€â”€ /cato/*               â†’ Cato Safety Architecture                 â”‚
â”‚       â”œâ”€â”€ /blackboard/*         â†’ Semantic Blackboard                      â”‚
â”‚       â”œâ”€â”€ /api-keys/*           â†’ Interface-based API Keys                 â”‚
â”‚       â”œâ”€â”€ /cortex/*             â†’ Cortex Memory System                     â”‚
â”‚       â”œâ”€â”€ /gateway/*            â†’ Gateway Admin                            â”‚
â”‚       â”œâ”€â”€ /security/*           â†’ Security Controls                        â”‚
â”‚       â”œâ”€â”€ /sovereign-mesh/*     â†’ Sovereign Mesh                           â”‚
â”‚       â”œâ”€â”€ /cognition/*          â†’ Advanced Cognition                       â”‚
â”‚       â”œâ”€â”€ /learning/*           â†’ AGI Learning                             â”‚
â”‚       â”œâ”€â”€ /ethics/*             â†’ Ethics Framework                         â”‚
â”‚       â”œâ”€â”€ /council/*            â†’ Council Oversight                        â”‚
â”‚       â”œâ”€â”€ /reports/*            â†’ Report Generation                        â”‚
â”‚       â”œâ”€â”€ /hitl-orchestration/* â†’ Human-in-the-Loop                        â”‚
â”‚       â”œâ”€â”€ /brain/*              â†’ Brain/Dreams/Ghost Memory                â”‚
â”‚       â”œâ”€â”€ /code-quality/*       â†’ Code Quality Metrics                     â”‚
â”‚       â”œâ”€â”€ /invitations/*        â†’ User Invitations                         â”‚
â”‚       â”œâ”€â”€ /regulatory-standards/* â†’ Compliance Standards                   â”‚
â”‚       â”œâ”€â”€ /self-audit/*         â†’ Self Audit System                        â”‚
â”‚       â”œâ”€â”€ /library-registry/*   â†’ Library Registry                         â”‚
â”‚       â”œâ”€â”€ /raws/*               â†’ Model Selection (RAWS)                   â”‚
â”‚       â”œâ”€â”€ /aws-costs/*          â†’ AWS Cost Tracking                        â”‚
â”‚       â”œâ”€â”€ /tenants/*            â†’ Tenant Management                        â”‚
â”‚       â”œâ”€â”€ /empiricism/*         â†’ Empiricism Loop                          â”‚
â”‚       â”œâ”€â”€ /ecd/*                â†’ Embodied Cognition                       â”‚
â”‚       â”œâ”€â”€ /ego/*                â†’ Ego Management                           â”‚
â”‚       â”œâ”€â”€ /s3-storage/*         â†’ S3 Storage Admin                         â”‚
â”‚       â”œâ”€â”€ /ai-reports/*         â†’ AI Report Writer                         â”‚
â”‚       â”œâ”€â”€ /aws-monitoring/*     â†’ AWS Monitoring                           â”‚
â”‚       â”œâ”€â”€ /checklist-registry/* â†’ Checklist Registry                       â”‚
â”‚       â”œâ”€â”€ /dynamic-reports/*    â†’ Dynamic Reports                          â”‚
â”‚       â”œâ”€â”€ /inference-components/* â†’ SageMaker Inference                    â”‚
â”‚       â””â”€â”€ /artifact-engine/*    â†’ Artifact Engine                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="admin-handler-categories">16.3 Admin Handler Categories</h3>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 34%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Category</th>
<th>Handlers</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>AI/ML</strong></td>
<td>cato, brain, cognition, raws, inference-components</td>
<td>AI orchestration and model management</td>
</tr>
<tr>
<td><strong>Memory</strong></td>
<td>cortex, blackboard, empiricism</td>
<td>Memory systems and knowledge management</td>
</tr>
<tr>
<td><strong>Security</strong></td>
<td>security, api-keys, ethics, self-audit</td>
<td>Security and compliance controls</td>
</tr>
<tr>
<td><strong>Operations</strong></td>
<td>gateway, sovereign-mesh, hitl-orchestration</td>
<td>Operational infrastructure</td>
</tr>
<tr>
<td><strong>Reporting</strong></td>
<td>reports, ai-reports, dynamic-reports, metrics</td>
<td>Analytics and reporting</td>
</tr>
<tr>
<td><strong>Configuration</strong></td>
<td>tenants, invitations, library-registry, checklist-registry</td>
<td>System configuration</td>
</tr>
<tr>
<td><strong>Infrastructure</strong></td>
<td>aws-costs, aws-monitoring, s3-storage, code-quality</td>
<td>Infrastructure monitoring</td>
</tr>
</tbody>
</table>
<h3 id="handler-implementation-pattern">16.4 Handler Implementation Pattern</h3>
<p>All admin handlers follow a consistent pattern:</p>
<pre class="typescript"><code>// packages/infrastructure/lambda/admin/{handler-name}.ts

export const handler: APIGatewayProxyHandler = async (event) =&gt; {
  const tenantId = event.requestContext.authorizer?.tenantId 
    || event.headers[&#39;x-tenant-id&#39;];
  
  if (!tenantId) {
    return { statusCode: 401, body: JSON.stringify({ error: &#39;Unauthorized&#39; }) };
  }

  // Set tenant context for RLS
  await executeStatement(`SET app.current_tenant_id = &#39;${tenantId}&#39;`, []);

  const path = event.path.replace(&#39;/api/admin/{resource}&#39;, &#39;&#39;);
  const method = event.httpMethod;

  // Route to specific handlers based on path and method
  switch (`${method} ${path}`) {
    case &#39;GET /dashboard&#39;: return getDashboard(tenantId);
    case &#39;GET /&#39;: return listItems(tenantId);
    case &#39;POST /&#39;: return createItem(tenantId, JSON.parse(event.body || &#39;{}&#39;));
    // ... additional routes
  }
};</code></pre>
<h3 id="cdk-wiring-pattern">16.5 CDK Wiring Pattern</h3>
<pre class="typescript"><code>// packages/infrastructure/lib/stacks/api-stack.ts

const handlerLambda = this.createLambda(
  &#39;HandlerName&#39;,
  &#39;admin/handler-name.handler&#39;,
  commonEnv,
  vpc,
  apiSecurityGroup,
  lambdaRole
);
const handlerIntegration = new apigateway.LambdaIntegration(handlerLambda);

const resource = admin.addResource(&#39;handler-name&#39;);
resource.addProxy({
  defaultIntegration: handlerIntegration,
  defaultMethodOptions: {
    authorizer: adminAuthorizer,
    authorizationType: apigateway.AuthorizationType.COGNITO,
  },
});</code></pre>
<h3 id="complete-handler-list-62-total">16.6 Complete Handler List (62 Total)</h3>
<h4 id="cato-safety-5-handlers">Cato Safety (5 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cato</td>
<td><code>admin/cato.handler</code></td>
<td><code>/api/admin/cato/*</code></td>
<td>Cato safety architecture</td>
</tr>
<tr>
<td>Cato Genesis</td>
<td><code>admin/cato-genesis.handler</code></td>
<td><code>/api/admin/cato-genesis/*</code></td>
<td>Genesis infrastructure</td>
</tr>
<tr>
<td>Cato Global</td>
<td><code>admin/cato-global.handler</code></td>
<td><code>/api/admin/cato-global/*</code></td>
<td>Global Cato settings</td>
</tr>
<tr>
<td>Cato Governance</td>
<td><code>admin/cato-governance.handler</code></td>
<td><code>/api/admin/cato-governance/*</code></td>
<td>Governance policies</td>
</tr>
<tr>
<td>Cato Pipeline</td>
<td><code>admin/cato-pipeline.handler</code></td>
<td><code>/api/admin/cato-pipeline/*</code></td>
<td>Method pipeline execution</td>
</tr>
</tbody>
</table>
<h4 id="memory-systems-4-handlers">Memory Systems (4 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cortex</td>
<td><code>admin/cortex.handler</code></td>
<td><code>/api/admin/cortex/*</code></td>
<td>Cortex memory system</td>
</tr>
<tr>
<td>Cortex V2</td>
<td><code>admin/cortex-v2.handler</code></td>
<td><code>/api/admin/cortex-v2/*</code></td>
<td>Enhanced memory system</td>
</tr>
<tr>
<td>Blackboard</td>
<td><code>admin/blackboard.handler</code></td>
<td><code>/api/admin/blackboard/*</code></td>
<td>Semantic blackboard</td>
</tr>
<tr>
<td>Empiricism</td>
<td><code>admin/empiricism-loop.handler</code></td>
<td><code>/api/admin/empiricism/*</code></td>
<td>Empiricism loop</td>
</tr>
</tbody>
</table>
<h4 id="aiml-7-handlers">AI/ML (7 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Brain</td>
<td><code>admin/brain.handler</code></td>
<td><code>/api/admin/brain/*</code></td>
<td>Brain/dreams/ghost memory</td>
</tr>
<tr>
<td>Cognition</td>
<td><code>admin/cognition.handler</code></td>
<td><code>/api/admin/cognition/*</code></td>
<td>Advanced cognition</td>
</tr>
<tr>
<td>Ego</td>
<td><code>admin/ego.handler</code></td>
<td><code>/api/admin/ego/*</code></td>
<td>Zero-cost ego system</td>
</tr>
<tr>
<td>RAWS</td>
<td><code>admin/raws.handler</code></td>
<td><code>/api/admin/raws/*</code></td>
<td>Model selection system</td>
</tr>
<tr>
<td>Inference</td>
<td><code>admin/inference-components.handler</code></td>
<td><code>/api/admin/inference-components/*</code></td>
<td>SageMaker components</td>
</tr>
<tr>
<td>Formal Reasoning</td>
<td><code>admin/formal-reasoning.handler</code></td>
<td><code>/api/admin/formal-reasoning/*</code></td>
<td>Z3/PyArg/RDFLib reasoning</td>
</tr>
<tr>
<td>Ethics Free Reasoning</td>
<td><code>admin/ethics-free-reasoning.handler</code></td>
<td><code>/api/admin/ethics-free-reasoning/*</code></td>
<td>Unconstrained reasoning</td>
</tr>
</tbody>
</table>
<h4 id="security-5-handlers">Security (5 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Security</td>
<td><code>admin/security.handler</code></td>
<td><code>/api/admin/security/*</code></td>
<td>Security controls</td>
</tr>
<tr>
<td>Security Schedules</td>
<td><code>admin/security-schedules.handler</code></td>
<td><code>/api/admin/security-schedules/*</code></td>
<td>Scheduled security tasks</td>
</tr>
<tr>
<td>API Keys</td>
<td><code>admin/api-keys.handler</code></td>
<td><code>/api/admin/api-keys/*</code></td>
<td>Interface-based API keys</td>
</tr>
<tr>
<td>Ethics</td>
<td><code>admin/ethics.handler</code></td>
<td><code>/api/admin/ethics/*</code></td>
<td>Ethics framework</td>
</tr>
<tr>
<td>Self Audit</td>
<td><code>admin/self-audit.handler</code></td>
<td><code>/api/admin/self-audit/*</code></td>
<td>Self audit system</td>
</tr>
</tbody>
</table>
<h4 id="operations-5-handlers">Operations (5 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Gateway</td>
<td><code>admin/gateway.handler</code></td>
<td><code>/api/admin/gateway/*</code></td>
<td>Gateway controls</td>
</tr>
<tr>
<td>Sovereign Mesh</td>
<td><code>admin/sovereign-mesh.handler</code></td>
<td><code>/api/admin/sovereign-mesh/*</code></td>
<td>Agent mesh orchestration</td>
</tr>
<tr>
<td>Sovereign Mesh Performance</td>
<td><code>admin/sovereign-mesh-performance.handler</code></td>
<td><code>/api/admin/sovereign-mesh-performance/*</code></td>
<td>Performance monitoring</td>
</tr>
<tr>
<td>Sovereign Mesh Scaling</td>
<td><code>admin/sovereign-mesh-scaling.handler</code></td>
<td><code>/api/admin/sovereign-mesh-scaling/*</code></td>
<td>Auto-scaling</td>
</tr>
<tr>
<td>HITL</td>
<td><code>admin/hitl-orchestration.handler</code></td>
<td><code>/api/admin/hitl-orchestration/*</code></td>
<td>Human-in-the-loop</td>
</tr>
</tbody>
</table>
<h4 id="reporting-4-handlers">Reporting (4 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Reports</td>
<td><code>admin/reports.handler</code></td>
<td><code>/api/admin/reports/*</code></td>
<td>Report generation</td>
</tr>
<tr>
<td>AI Reports</td>
<td><code>admin/ai-reports.handler</code></td>
<td><code>/api/admin/ai-reports/*</code></td>
<td>AI report writer</td>
</tr>
<tr>
<td>Dynamic Reports</td>
<td><code>admin/dynamic-reports.handler</code></td>
<td><code>/api/admin/dynamic-reports/*</code></td>
<td>Dynamic reports</td>
</tr>
<tr>
<td>Metrics</td>
<td><code>admin/metrics.handler</code></td>
<td><code>/api/admin/metrics/*</code></td>
<td>Metrics collection</td>
</tr>
</tbody>
</table>
<h4 id="configuration-7-handlers">Configuration (7 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tenants</td>
<td><code>admin/tenants.handler</code></td>
<td><code>/api/admin/tenants/*</code></td>
<td>Tenant management</td>
</tr>
<tr>
<td>Invitations</td>
<td><code>admin/invitations.handler</code></td>
<td><code>/api/admin/invitations/*</code></td>
<td>User invitations</td>
</tr>
<tr>
<td>Library Registry</td>
<td><code>admin/library-registry.handler</code></td>
<td><code>/api/admin/library-registry/*</code></td>
<td>Library registry</td>
</tr>
<tr>
<td>Checklist Registry</td>
<td><code>admin/checklist-registry.handler</code></td>
<td><code>/api/admin/checklist-registry/*</code></td>
<td>Checklists</td>
</tr>
<tr>
<td>Collaboration Settings</td>
<td><code>admin/collaboration-settings.handler</code></td>
<td><code>/api/admin/collaboration-settings/*</code></td>
<td>Collaboration config</td>
</tr>
<tr>
<td>System</td>
<td><code>admin/system.handler</code></td>
<td><code>/api/admin/system/*</code></td>
<td>System management</td>
</tr>
<tr>
<td>System Config</td>
<td><code>admin/system-config.handler</code></td>
<td><code>/api/admin/system-config/*</code></td>
<td>System configuration</td>
</tr>
</tbody>
</table>
<h4 id="infrastructure-6-handlers">Infrastructure (6 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AWS Costs</td>
<td><code>admin/aws-costs.handler</code></td>
<td><code>/api/admin/aws-costs/*</code></td>
<td>Cost tracking</td>
</tr>
<tr>
<td>AWS Monitoring</td>
<td><code>admin/aws-monitoring.handler</code></td>
<td><code>/api/admin/aws-monitoring/*</code></td>
<td>AWS monitoring</td>
</tr>
<tr>
<td>S3 Storage</td>
<td><code>admin/s3-storage.handler</code></td>
<td><code>/api/admin/s3-storage/*</code></td>
<td>S3 admin</td>
</tr>
<tr>
<td>Code Quality</td>
<td><code>admin/code-quality.handler</code></td>
<td><code>/api/admin/code-quality/*</code></td>
<td>Code metrics</td>
</tr>
<tr>
<td>Infrastructure Tier</td>
<td><code>admin/infrastructure-tier.handler</code></td>
<td><code>/api/admin/infrastructure-tier/*</code></td>
<td>Tier management</td>
</tr>
<tr>
<td>Logs</td>
<td><code>admin/logs.handler</code></td>
<td><code>/api/admin/logs/*</code></td>
<td>Log management</td>
</tr>
</tbody>
</table>
<h4 id="compliance-4-handlers">Compliance (4 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Regulatory Standards</td>
<td><code>admin/regulatory-standards.handler</code></td>
<td><code>/api/admin/regulatory-standards/*</code></td>
<td>Compliance standards</td>
</tr>
<tr>
<td>Council</td>
<td><code>admin/council.handler</code></td>
<td><code>/api/admin/council/*</code></td>
<td>Council oversight</td>
</tr>
<tr>
<td>User Violations</td>
<td><code>admin/user-violations.handler</code></td>
<td><code>/api/admin/user-violations/*</code></td>
<td>Violation tracking</td>
</tr>
<tr>
<td>Approvals</td>
<td><code>admin/approvals.handler</code></td>
<td><code>/api/admin/approvals/*</code></td>
<td>Approval workflows</td>
</tr>
</tbody>
</table>
<h4 id="models-5-handlers">Models (5 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Models</td>
<td><code>admin/models.handler</code></td>
<td><code>/api/admin/models/*</code></td>
<td>Model management</td>
</tr>
<tr>
<td>LoRA Adapters</td>
<td><code>admin/lora-adapters.handler</code></td>
<td><code>/api/admin/lora-adapters/*</code></td>
<td>LoRA adapter management</td>
</tr>
<tr>
<td>Pricing</td>
<td><code>admin/pricing.handler</code></td>
<td><code>/api/admin/pricing/*</code></td>
<td>Model pricing</td>
</tr>
<tr>
<td>Specialty Rankings</td>
<td><code>admin/specialty-rankings.handler</code></td>
<td><code>/api/admin/specialty-rankings/*</code></td>
<td>Model rankings</td>
</tr>
<tr>
<td>Sync Providers</td>
<td><code>admin/sync-providers.handler</code></td>
<td><code>/api/admin/sync-providers/*</code></td>
<td>Provider sync</td>
</tr>
</tbody>
</table>
<h4 id="orchestration-2-handlers">Orchestration (2 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Orchestration Methods</td>
<td><code>admin/orchestration-methods.handler</code></td>
<td><code>/api/admin/orchestration-methods/*</code></td>
<td>Method registry</td>
</tr>
<tr>
<td>Orchestration Templates</td>
<td><code>admin/orchestration-user-templates.handler</code></td>
<td><code>/api/admin/orchestration-user-templates/*</code></td>
<td>User templates</td>
</tr>
</tbody>
</table>
<h4 id="users-2-handlers">Users (2 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>User Registry</td>
<td><code>admin/user-registry.handler</code></td>
<td><code>/api/admin/user-registry/*</code></td>
<td>User registry</td>
</tr>
<tr>
<td>White Label</td>
<td><code>admin/white-label.handler</code></td>
<td><code>/api/admin/white-label/*</code></td>
<td>White-label config</td>
</tr>
</tbody>
</table>
<h4 id="time-translation-3-handlers">Time &amp; Translation (3 handlers)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time Machine</td>
<td><code>admin/time-machine.handler</code></td>
<td><code>/api/admin/time-machine/*</code></td>
<td>Time travel debugging</td>
</tr>
<tr>
<td>Translation</td>
<td><code>admin/translation.handler</code></td>
<td><code>/api/admin/translation/*</code></td>
<td>i18n management</td>
</tr>
<tr>
<td>Internet Learning</td>
<td><code>admin/internet-learning.handler</code></td>
<td><code>/api/admin/internet-learning/*</code></td>
<td>Web learning</td>
</tr>
</tbody>
</table>
<h4 id="learning-1-handler">Learning (1 handler)</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 17%" />
<col style="width: 20%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr>
<th>Handler</th>
<th>File</th>
<th>Route</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AGI Learning</td>
<td><code>admin/agi-learning.handler</code></td>
<td><code>/api/admin/learning/*</code></td>
<td>AGI learning system</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="liquid-interface---morphable-ui-system-v5.52.8">17. Liquid Interface - Morphable UI System (v5.52.8)</h2>
<h3 id="overview-7">17.1 Overview</h3>
<p>The Liquid Interface implements a <strong>morphable UI paradigm</strong> where the chat interface can transform into specialized tools based on user intent or explicit selection. This follows the design philosophy: <strong>â€œDonâ€™t Build the Tool. BE the Tool.â€</strong></p>
<h3 id="architecture-4">17.2 Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LIQUID INTERFACE ARCHITECTURE                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Chat Page   â”‚â”€â”€â”€â–¶â”‚ LiquidMorphPanelâ”‚â”€â”€â”€â–¶â”‚ Morphed View        â”‚ â”‚
â”‚  â”‚ (trigger)   â”‚    â”‚ (container)     â”‚    â”‚ (DataGrid, Kanban..)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                      â”‚
â”‚  State: morphedView, isMorphFullscreen, showMorphChat               â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="component-hierarchy">17.3 Component Hierarchy</h3>
<table>
<colgroup>
<col style="width: 36%" />
<col style="width: 33%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th>Component</th>
<th>Location</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>LiquidMorphPanel</code></td>
<td><code>apps/thinktank/components/liquid/LiquidMorphPanel.tsx</code></td>
<td>Container with header, controls, chat sidebar</td>
</tr>
<tr>
<td><code>renderMorphedView()</code></td>
<td>Inside LiquidMorphPanel</td>
<td>Switches between view components</td>
</tr>
<tr>
<td><code>DataGridView</code></td>
<td><code>morphed-views/DataGridView.tsx</code></td>
<td>Interactive spreadsheet</td>
</tr>
<tr>
<td><code>ChartView</code></td>
<td><code>morphed-views/ChartView.tsx</code></td>
<td>Bar/line/pie/area charts</td>
</tr>
<tr>
<td><code>KanbanView</code></td>
<td><code>morphed-views/KanbanView.tsx</code></td>
<td>Multi-variant Kanban board</td>
</tr>
<tr>
<td><code>CalculatorView</code></td>
<td><code>morphed-views/CalculatorView.tsx</code></td>
<td>Full calculator</td>
</tr>
<tr>
<td><code>CodeEditorView</code></td>
<td><code>morphed-views/CodeEditorView.tsx</code></td>
<td>Code editor with run</td>
</tr>
<tr>
<td><code>DocumentView</code></td>
<td><code>morphed-views/DocumentView.tsx</code></td>
<td>Rich text editor</td>
</tr>
</tbody>
</table>
<h3 id="kanban-variant-system">17.4 Kanban Variant System</h3>
<p>The <code>KanbanView</code> implements 5 modern Kanban frameworks through a variant system:</p>
<pre class="typescript"><code>export type KanbanVariant = 
  | &#39;standard&#39;    // Traditional columns
  | &#39;scrumban&#39;    // Scrum + Kanban hybrid
  | &#39;enterprise&#39;  // Multi-lane portfolio
  | &#39;personal&#39;    // Simple WIP limiting
  | &#39;pomodoro&#39;;   // Timer-integrated</code></pre>
<h4 id="variant-configurations">Variant Configurations</h4>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr>
<th>Variant</th>
<th>Columns</th>
<th>Special Features</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Standard</strong></td>
<td>To Do, In Progress, Review, Done</td>
<td>Basic drag-and-drop</td>
</tr>
<tr>
<td><strong>Scrumban</strong></td>
<td>Backlog, Ready, In Progress, Review, Done</td>
<td>Sprint header, velocity, story points, WIP limits</td>
</tr>
<tr>
<td><strong>Enterprise</strong></td>
<td>Proposed, Approved, Active, Completed</td>
<td>3 swim lanes (Strategic/Operations/Support)</td>
</tr>
<tr>
<td><strong>Personal</strong></td>
<td>To Do, Doing, Done</td>
<td>WIP limit of 3 on Doing</td>
</tr>
<tr>
<td><strong>Pomodoro</strong></td>
<td>Todayâ€™s Focus, In Pomodoro, On Break, Completed</td>
<td>25-min timer, break tracking</td>
</tr>
</tbody>
</table>
<h4 id="pomodoro-timer-implementation">Pomodoro Timer Implementation</h4>
<pre class="typescript"><code>function usePomodoroTimer() {
  const [timeLeft, setTimeLeft] = useState(25 * 60);
  const [isRunning, setIsRunning] = useState(false);
  const [isBreak, setIsBreak] = useState(false);
  const [completedPomodoros, setCompletedPomodoros] = useState(0);
  // Auto-transitions between 25-min focus and 5-min break
}</code></pre>
<h3 id="integration-points">17.5 Integration Points</h3>
<h4 id="chat-page-integration">Chat Page Integration</h4>
<pre class="typescript"><code>// apps/thinktank/app/(chat)/page.tsx
const [morphedView, setMorphedView] = useState&lt;MorphedViewType | null&gt;(null);
const [isMorphFullscreen, setIsMorphFullscreen] = useState(false);
const [showMorphChat, setShowMorphChat] = useState(false);

// Trigger buttons in header (Advanced Mode)
&lt;Button onClick={() =&gt; setMorphedView(&#39;kanban&#39;)}&gt;
  &lt;Kanban className=&quot;h-4 w-4&quot; /&gt;
&lt;/Button&gt;

// Conditional rendering
{morphedView &amp;&amp; (
  &lt;LiquidMorphPanel
    viewType={morphedView}
    isFullscreen={isMorphFullscreen}
    onClose={() =&gt; setMorphedView(null)}
    onToggleFullscreen={() =&gt; setIsMorphFullscreen(!isMorphFullscreen)}
    ...
  /&gt;
)}</code></pre>
<h3 id="analytics-features">17.6 Analytics Features</h3>
<p>All Kanban variants include an analytics panel with:</p>
<table>
<thead>
<tr>
<th>Metric</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Total Tasks</td>
<td>Count of all cards across columns</td>
</tr>
<tr>
<td>Completed</td>
<td>Cards in Done/Completed column</td>
</tr>
<tr>
<td>Cycle Time</td>
<td>Average time from start to completion</td>
</tr>
<tr>
<td>Throughput</td>
<td>Tasks completed per week</td>
</tr>
</tbody>
</table>
<h3 id="file-structure">17.7 File Structure</h3>
<pre><code>apps/thinktank/components/liquid/
â”œâ”€â”€ LiquidMorphPanel.tsx      # Main container component
â”œâ”€â”€ EjectDialog.tsx           # Export to Next.js dialog
â”œâ”€â”€ index.ts                  # Module exports
â””â”€â”€ morphed-views/
    â”œâ”€â”€ DataGridView.tsx      # Spreadsheet
    â”œâ”€â”€ ChartView.tsx         # Charts
    â”œâ”€â”€ KanbanView.tsx        # Multi-variant Kanban (~630 lines)
    â”œâ”€â”€ CalculatorView.tsx    # Calculator
    â”œâ”€â”€ CodeEditorView.tsx    # Code editor
    â”œâ”€â”€ DocumentView.tsx      # Rich text
    â””â”€â”€ index.ts              # View exports</code></pre>
<hr />
<h2 id="section-18-think-tank-consumer-api-services-v5.52.17">Section 18: Think Tank Consumer API Services (v5.52.17)</h2>
<h3 id="overview-8">18.1 Overview</h3>
<p>The Think Tank consumer application (<code>apps/thinktank/</code>) requires frontend API services to communicate with backend Lambda handlers. Each backend route in <code>packages/infrastructure/lambda/thinktank/</code> needs a corresponding client in <code>apps/thinktank/lib/api/</code>.</p>
<h3 id="api-service-architecture">18.2 API Service Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  THINK TANK CONSUMER APP                                                     â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  UI Components (React)                                               â”‚   â”‚
â”‚  â”‚  - Sidebar.tsx, TimeMachine.tsx, etc.                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  lib/api/ - Frontend API Services                                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚   â”‚
â”‚  â”‚  â”‚ chat.ts      â”‚ â”‚ time-travel  â”‚ â”‚ grimoire.ts  â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ models.ts    â”‚ â”‚ .ts          â”‚ â”‚ flash-facts  â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ rules.ts     â”‚ â”‚ artifacts.ts â”‚ â”‚ .ts          â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ settings.ts  â”‚ â”‚ ideas.ts     â”‚ â”‚ collaborationâ”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ brain-plan   â”‚ â”‚ derivation-  â”‚ â”‚ .ts          â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ .ts          â”‚ â”‚ history.ts   â”‚ â”‚ compliance-  â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ analytics.ts â”‚ â”‚              â”‚ â”‚ export.ts    â”‚                 â”‚   â”‚
â”‚  â”‚  â”‚ governor.ts  â”‚ â”‚              â”‚ â”‚              â”‚                 â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ HTTP/REST
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AWS LAMBDA - /api/thinktank/*                                              â”‚
â”‚                                                                             â”‚
â”‚  packages/infrastructure/lambda/thinktank/                                  â”‚
â”‚  - conversations.ts, time-travel.ts, grimoire.ts, flash-facts.ts           â”‚
â”‚  - artifacts.ts, ideas.ts, enhanced-collaboration.ts, derivation-history   â”‚
â”‚  - dia.ts (Decision Intelligence Artifacts)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="complete-api-service-mapping">18.3 Complete API Service Mapping</h3>
<table>
<colgroup>
<col style="width: 26%" />
<col style="width: 28%" />
<col style="width: 19%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>Backend Handler</th>
<th>Frontend Service</th>
<th>Route Base</th>
<th>Key Operations</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>conversations.ts</code></td>
<td><code>chatService</code></td>
<td><code>/api/thinktank/conversations</code></td>
<td>CRUD, streaming</td>
</tr>
<tr>
<td><code>models.ts</code></td>
<td><code>modelsService</code></td>
<td><code>/api/thinktank/models</code></td>
<td>List, recommend</td>
</tr>
<tr>
<td><code>my-rules.ts</code></td>
<td><code>rulesService</code></td>
<td><code>/api/thinktank/my-rules</code></td>
<td>CRUD, presets</td>
</tr>
<tr>
<td><code>settings.ts</code></td>
<td><code>settingsService</code></td>
<td><code>/api/thinktank/settings</code></td>
<td>Get/update</td>
</tr>
<tr>
<td><code>brain-plan.ts</code></td>
<td><code>brainPlanService</code></td>
<td><code>/api/thinktank/brain-plan</code></td>
<td>Generate, execute</td>
</tr>
<tr>
<td><code>analytics.ts</code></td>
<td><code>analyticsService</code></td>
<td><code>/api/thinktank/analytics</code></td>
<td>Usage, heatmap</td>
</tr>
<tr>
<td><code>economic-governor.ts</code></td>
<td><code>governorService</code></td>
<td><code>/api/thinktank/economic-governor</code></td>
<td>Status, savings</td>
</tr>
<tr>
<td><code>time-travel.ts</code></td>
<td><code>timeTravelService</code></td>
<td><code>/api/thinktank/time-travel</code></td>
<td>Timelines, checkpoints, fork</td>
</tr>
<tr>
<td><code>grimoire.ts</code></td>
<td><code>grimoireService</code></td>
<td><code>/api/thinktank/grimoire</code></td>
<td>Spells, execute</td>
</tr>
<tr>
<td><code>flash-facts.ts</code></td>
<td><code>flashFactsService</code></td>
<td><code>/api/thinktank/flash-facts</code></td>
<td>Extract, verify</td>
</tr>
<tr>
<td><code>derivation-history.ts</code></td>
<td><code>derivationHistoryService</code></td>
<td><code>/api/thinktank/derivation-history</code></td>
<td>Provenance, evidence</td>
</tr>
<tr>
<td><code>enhanced-collaboration.ts</code></td>
<td><code>collaborationService</code></td>
<td><code>/api/thinktank/enhanced-collaboration</code></td>
<td>Sessions, invites</td>
</tr>
<tr>
<td><code>artifact-engine.ts</code></td>
<td><code>artifactsService</code></td>
<td><code>/api/thinktank/artifacts</code></td>
<td>CRUD, versions, export</td>
</tr>
<tr>
<td><code>ideas.ts</code></td>
<td><code>ideasService</code></td>
<td><code>/api/thinktank/ideas</code></td>
<td>Capture, boards</td>
</tr>
<tr>
<td><code>dia.ts</code></td>
<td><code>exportConversation</code></td>
<td><code>/api/thinktank/dia</code></td>
<td>Decision records, compliance</td>
</tr>
</tbody>
</table>
<h3 id="api-client-pattern">18.4 API Client Pattern</h3>
<p>All services follow the singleton pattern with typed methods:</p>
<pre class="typescript"><code>// lib/api/time-travel.ts
class TimeTravelService {
  async listTimelines(conversationId?: string): Promise&lt;Timeline[]&gt; {
    const response = await api.get&lt;{ success: boolean; data: Timeline[] }&gt;(
      `/api/thinktank/time-travel/timelines${params}`
    );
    return response.data || [];
  }

  async createCheckpoint(timelineId: string, state: Record&lt;string, unknown&gt;): Promise&lt;Checkpoint&gt; {
    const response = await api.post&lt;{ success: boolean; data: Checkpoint }&gt;(
      `/api/thinktank/time-travel/timelines/${timelineId}/checkpoints`,
      { state, checkpointType: &#39;manual&#39; }
    );
    return response.data;
  }
}

export const timeTravelService = new TimeTravelService();</code></pre>
<h3 id="file-structure-1">18.5 File Structure</h3>
<pre><code>apps/thinktank/lib/api/
â”œâ”€â”€ index.ts              # Re-exports all services
â”œâ”€â”€ client.ts             # Base API client (fetch wrapper)
â”œâ”€â”€ types.ts              # Shared types
â”œâ”€â”€ chat.ts               # chatService
â”œâ”€â”€ models.ts             # modelsService
â”œâ”€â”€ rules.ts              # rulesService
â”œâ”€â”€ settings.ts           # settingsService
â”œâ”€â”€ brain-plan.ts         # brainPlanService
â”œâ”€â”€ analytics.ts          # analyticsService
â”œâ”€â”€ governor.ts           # governorService
â”œâ”€â”€ liquid-interface.ts   # liquidInterfaceService
â”œâ”€â”€ time-travel.ts        # timeTravelService (v5.52.17)
â”œâ”€â”€ grimoire.ts           # grimoireService (v5.52.17)
â”œâ”€â”€ flash-facts.ts        # flashFactsService (v5.52.17)
â”œâ”€â”€ derivation-history.ts # derivationHistoryService (v5.52.17)
â”œâ”€â”€ collaboration.ts      # collaborationService (v5.52.17)
â”œâ”€â”€ artifacts.ts          # artifactsService (v5.52.17)
â”œâ”€â”€ ideas.ts              # ideasService (v5.52.17)
â””â”€â”€ compliance-export.ts  # exportConversation (v5.52.16)</code></pre>
<hr />
<h2 id="oauth-2.0-provider-developer-portal-v5.52.26">19. OAuth 2.0 Provider &amp; Developer Portal (v5.52.26)</h2>
<h3 id="overview-9">19.1 Overview</h3>
<p>RADIANT implements a <strong>RFC 6749 compliant OAuth 2.0 Authorization Server</strong> enabling third-party applications to access RADIANT APIs on behalf of users. This enables the ecosystem of MCP servers, Zapier integrations, partner apps, and custom automation tools.</p>
<h3 id="architecture-5">19.2 Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         OAUTH 2.0 PROVIDER ARCHITECTURE                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Third-Party App â”‚     â”‚  User&#39;s Browser  â”‚     â”‚   RADIANT API    â”‚   â”‚
â”‚  â”‚  (MCP, Zapier)   â”‚     â”‚                  â”‚     â”‚                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 1. Authorization       â”‚                        â”‚             â”‚
â”‚           â”‚    Request             â”‚                        â”‚             â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚                        â”‚ 2. Consent Page        â”‚             â”‚
â”‚           â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚                        â”‚ 3. User Approves       â”‚             â”‚
â”‚           â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 4. Authorization Code  â”‚                        â”‚             â”‚
â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 5. Exchange Code       â”‚                        â”‚             â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 6. Access Token (JWT)  â”‚                        â”‚             â”‚
â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 7. API Request + Token â”‚                        â”‚             â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
â”‚           â”‚                        â”‚                        â”‚             â”‚
â”‚           â”‚ 8. Protected Resource  â”‚                        â”‚             â”‚
â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="supported-grant-types">19.3 Supported Grant Types</h3>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 19%" />
<col style="width: 28%" />
<col style="width: 28%" />
</colgroup>
<thead>
<tr>
<th>Grant Type</th>
<th>Use Case</th>
<th>PKCE Required</th>
<th>Refresh Token</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Authorization Code</strong></td>
<td>Web/mobile apps with user interaction</td>
<td>Public clients only</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Client Credentials</strong></td>
<td>Machine-to-machine (M2M) automation</td>
<td>N/A</td>
<td>No</td>
</tr>
<tr>
<td><strong>Refresh Token</strong></td>
<td>Token renewal without re-authentication</td>
<td>N/A</td>
<td>Yes (rotated)</td>
</tr>
</tbody>
</table>
<h3 id="database-schema-4">19.4 Database Schema</h3>
<p><strong>Implementation</strong>: <code>migrations/V2026_01_25_009__oauth_provider.sql</code></p>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 31%" />
<col style="width: 44%" />
</colgroup>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>oauth_clients</code></td>
<td>Registered applications</td>
<td><code>client_id</code>, <code>client_secret_hash</code>, <code>redirect_uris</code>, <code>allowed_scopes</code></td>
</tr>
<tr>
<td><code>oauth_authorization_codes</code></td>
<td>Short-lived auth codes (5 min TTL)</td>
<td><code>code</code>, <code>user_id</code>, <code>scopes</code>, <code>code_challenge</code></td>
</tr>
<tr>
<td><code>oauth_access_tokens</code></td>
<td>Token hashes (not raw tokens)</td>
<td><code>token_hash</code>, <code>scopes</code>, <code>expires_at</code>, <code>is_revoked</code></td>
</tr>
<tr>
<td><code>oauth_refresh_tokens</code></td>
<td>Refresh tokens with rotation</td>
<td><code>token_hash</code>, <code>generation</code>, <code>previous_token_id</code></td>
</tr>
<tr>
<td><code>oauth_user_authorizations</code></td>
<td>User consent records</td>
<td><code>user_id</code>, <code>client_id</code>, <code>scopes</code>, <code>is_active</code></td>
</tr>
<tr>
<td><code>oauth_scope_definitions</code></td>
<td>Admin-configurable scopes</td>
<td><code>name</code>, <code>category</code>, <code>risk_level</code>, <code>allowed_endpoints</code></td>
</tr>
<tr>
<td><code>oauth_audit_log</code></td>
<td>Partitioned event log</td>
<td><code>event_type</code>, <code>client_id</code>, <code>user_id</code>, <code>details</code></td>
</tr>
<tr>
<td><code>tenant_oauth_settings</code></td>
<td>Per-tenant configuration</td>
<td><code>oauth_enabled</code>, <code>require_app_approval</code>, <code>blocked_scopes</code></td>
</tr>
<tr>
<td><code>oauth_signing_keys</code></td>
<td>RSA keys for JWT signing</td>
<td><code>kid</code>, <code>private_key_secret_arn</code>, <code>public_key_pem</code></td>
</tr>
</tbody>
</table>
<h3 id="oauth-endpoints">19.5 OAuth Endpoints</h3>
<p><strong>Implementation</strong>: <code>lambda/oauth/handler.ts</code></p>
<table>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/oauth/authorize</code></td>
<td>GET</td>
<td>Display consent page</td>
</tr>
<tr>
<td><code>/oauth/authorize</code></td>
<td>POST</td>
<td>Process user consent</td>
</tr>
<tr>
<td><code>/oauth/token</code></td>
<td>POST</td>
<td>Exchange code/refresh for tokens</td>
</tr>
<tr>
<td><code>/oauth/revoke</code></td>
<td>POST</td>
<td>Revoke access/refresh tokens</td>
</tr>
<tr>
<td><code>/oauth/userinfo</code></td>
<td>GET</td>
<td>OIDC user info endpoint</td>
</tr>
<tr>
<td><code>/oauth/introspect</code></td>
<td>POST</td>
<td>Token introspection</td>
</tr>
<tr>
<td><code>/.well-known/openid-configuration</code></td>
<td>GET</td>
<td>OIDC discovery</td>
</tr>
<tr>
<td><code>/oauth/jwks.json</code></td>
<td>GET</td>
<td>JSON Web Key Set</td>
</tr>
</tbody>
</table>
<h3 id="scope-system">19.6 Scope System</h3>
<p>14 default scopes organized by category and risk level:</p>
<pre class="typescript"><code>// Low Risk - Profile
&#39;openid&#39;, &#39;profile&#39;, &#39;email&#39;, &#39;models:read&#39;, &#39;usage:read&#39;

// Medium Risk - Read Access
&#39;offline_access&#39;, &#39;chat:read&#39;, &#39;knowledge:read&#39;, &#39;files:read&#39;

// High Risk - Write/Execute (Requires Approval)
&#39;chat:write&#39;, &#39;chat:delete&#39;, &#39;knowledge:write&#39;, &#39;files:write&#39;, &#39;agents:execute&#39;</code></pre>
<p><strong>Scope Endpoint Mapping</strong> (<code>packages/shared/src/types/oauth-provider.types.ts</code>):</p>
<pre class="typescript"><code>export interface OAuthScope {
  name: string;
  category: ScopeCategory;
  displayName: string;
  description: string;
  riskLevel: &#39;low&#39; | &#39;medium&#39; | &#39;high&#39;;
  allowedEndpoints: ScopeEndpoint[];
  isEnabled: boolean;
  requiresApproval: boolean;
  allowedAppTypes: OAuthAppType[];
}</code></pre>
<h3 id="token-security">19.7 Token Security</h3>
<table>
<thead>
<tr>
<th>Security Measure</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Token Storage</strong></td>
<td>SHA-256 hash only, never raw tokens</td>
</tr>
<tr>
<td><strong>JWT Signing</strong></td>
<td>RS256 with keys in Secrets Manager</td>
</tr>
<tr>
<td><strong>PKCE</strong></td>
<td>Required for public clients (S256 only)</td>
</tr>
<tr>
<td><strong>Token Rotation</strong></td>
<td>Refresh tokens rotated on use</td>
</tr>
<tr>
<td><strong>Revocation</strong></td>
<td>Cascading revoke on consent withdrawal</td>
</tr>
<tr>
<td><strong>Audit Log</strong></td>
<td>Partitioned by month for compliance</td>
</tr>
</tbody>
</table>
<h3 id="admin-api">19.8 Admin API</h3>
<p><strong>Implementation</strong>: <code>lambda/admin/oauth-apps.ts</code></p>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 29%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/admin/oauth/dashboard</code></td>
<td>GET</td>
<td>Dashboard with stats</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps</code></td>
<td>GET/POST</td>
<td>List/register apps</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps/:id</code></td>
<td>GET/PUT/DELETE</td>
<td>App CRUD</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps/:id/approve</code></td>
<td>POST</td>
<td>Approve pending app</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps/:id/reject</code></td>
<td>POST</td>
<td>Reject with reason</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps/:id/suspend</code></td>
<td>POST</td>
<td>Suspend and revoke all tokens</td>
</tr>
<tr>
<td><code>/api/admin/oauth/apps/:id/rotate-secret</code></td>
<td>POST</td>
<td>Generate new client secret</td>
</tr>
<tr>
<td><code>/api/admin/oauth/scopes</code></td>
<td>GET/POST/PUT</td>
<td>Scope management</td>
</tr>
<tr>
<td><code>/api/admin/oauth/authorizations</code></td>
<td>GET</td>
<td>View user consents</td>
</tr>
<tr>
<td><code>/api/admin/oauth/authorizations/:id/revoke</code></td>
<td>POST</td>
<td>Admin revoke consent</td>
</tr>
<tr>
<td><code>/api/admin/oauth/settings</code></td>
<td>GET/PUT</td>
<td>Tenant OAuth settings</td>
</tr>
<tr>
<td><code>/api/admin/oauth/audit</code></td>
<td>GET</td>
<td>Audit log query</td>
</tr>
</tbody>
</table>
<h3 id="admin-dashboard">19.9 Admin Dashboard</h3>
<p><strong>Implementation</strong>: <code>apps/admin-dashboard/app/(dashboard)/oauth/apps/page.tsx</code></p>
<p>Features: - <strong>Overview Tab</strong>: Stats cards, pending approvals, top apps by authorization count - <strong>Applications Tab</strong>: Searchable/filterable app list, approve/reject/suspend actions - <strong>Authorizations Tab</strong>: User consent viewer with revocation - <strong>Settings Tab</strong>: Per-tenant OAuth configuration</p>
<h3 id="use-cases-enabled">19.10 Use Cases Enabled</h3>
<table>
<colgroup>
<col style="width: 31%" />
<col style="width: 29%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr>
<th>Integration</th>
<th>Grant Type</th>
<th>Typical Scopes</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>MCP Servers</strong> (Claude Desktop, Cursor)</td>
<td>Authorization Code</td>
<td><code>chat:write</code>, <code>knowledge:read</code></td>
</tr>
<tr>
<td><strong>Zapier/Make</strong></td>
<td>Authorization Code</td>
<td><code>chat:read</code>, <code>chat:write</code></td>
</tr>
<tr>
<td><strong>Partner Apps</strong></td>
<td>Authorization Code</td>
<td>Custom scope set</td>
</tr>
<tr>
<td><strong>Automation Scripts</strong></td>
<td>Client Credentials</td>
<td><code>models:read</code>, <code>agents:execute</code></td>
</tr>
<tr>
<td><strong>Mobile Apps</strong></td>
<td>Authorization Code + PKCE</td>
<td><code>profile</code>, <code>chat:*</code></td>
</tr>
<tr>
<td><strong>Slack/Teams Bots</strong></td>
<td>Authorization Code</td>
<td><code>chat:write</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="two-factor-authentication-mfa-v5.52.28">19. Two-Factor Authentication (MFA) (v5.52.28)</h2>
<h3 id="overview-10">19.1 Overview</h3>
<p>RADIANT implements role-based Multi-Factor Authentication (MFA) using industry-standard TOTP (RFC 6238). Admin roles are <strong>required</strong> to enroll in MFA and <strong>cannot disable</strong> it once enrolled.</p>
<h3 id="architecture-6">19.2 Architecture</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Login     â”‚â”€â”€â”€â”€â–¶â”‚  MFA Check   â”‚â”€â”€â”€â”€â–¶â”‚  MFA Required?  â”‚
â”‚   Page      â”‚     â”‚  /api/mfa/   â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   check      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Enrollment  â”‚â—€â”€â”€â”€â”€â”‚  Not Enrolled   â”‚
                    â”‚    Gate      â”‚     â”‚                 â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  TOTP Setup  â”‚â”€â”€â”€â”€â–¶â”‚  Backup Codes   â”‚
                    â”‚  QR Code     â”‚     â”‚  Generated      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>
<h3 id="database-schema-5">19.3 Database Schema</h3>
<p><strong>Migration</strong>: <code>070_mfa_support.sql</code></p>
<p><strong>Columns added to <code>tenant_users</code> and <code>platform_admins</code></strong>:</p>
<table>
<colgroup>
<col style="width: 34%" />
<col style="width: 26%" />
<col style="width: 39%" />
</colgroup>
<thead>
<tr>
<th>Column</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mfa_enabled</code></td>
<td>BOOLEAN</td>
<td>MFA enrollment status</td>
</tr>
<tr>
<td><code>mfa_enrolled_at</code></td>
<td>TIMESTAMPTZ</td>
<td>Enrollment timestamp</td>
</tr>
<tr>
<td><code>mfa_method</code></td>
<td>VARCHAR(20)</td>
<td>Method: â€˜totpâ€™, â€˜smsâ€™, â€˜webauthnâ€™</td>
</tr>
<tr>
<td><code>mfa_totp_secret_encrypted</code></td>
<td>TEXT</td>
<td>AES-256-GCM encrypted TOTP secret</td>
</tr>
<tr>
<td><code>mfa_failed_attempts</code></td>
<td>INTEGER</td>
<td>Failed verification count</td>
</tr>
<tr>
<td><code>mfa_locked_until</code></td>
<td>TIMESTAMPTZ</td>
<td>Lockout expiration</td>
</tr>
</tbody>
</table>
<p><strong>New Tables</strong>:</p>
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mfa_backup_codes</code></td>
<td>One-time recovery codes (SHA-256 hashed)</td>
</tr>
<tr>
<td><code>mfa_trusted_devices</code></td>
<td>30-day device trust tokens</td>
</tr>
<tr>
<td><code>mfa_audit_log</code></td>
<td>Partitioned audit log (monthly)</td>
</tr>
</tbody>
</table>
<h3 id="totp-service">19.4 TOTP Service</h3>
<p><strong>Implementation</strong>: <code>lambda/shared/services/mfa/totp.service.ts</code></p>
<pre class="typescript"><code>export class TOTPService {
  generateSecret(accountName: string): { secret: string; uri: string };
  generateCode(secret: string, timestamp?: number): string;
  verifyCode(secret: string, code: string): { valid: boolean; drift?: number };
  encryptSecret(secret: string): string;  // AES-256-GCM
  decryptSecret(encryptedData: string): string;
}

export class BackupCodesService {
  generateCodes(): { codes: string[]; hashes: string[] };
  verifyCode(code: string, hash: string): boolean;
  hashCode(code: string): string;  // SHA-256
}

export class DeviceTrustService {
  generateDeviceToken(): string;
  hashToken(token: string): string;  // SHA-256
  calculateExpiration(): Date;  // +30 days
  verifyToken(token: string, storedHash: string): boolean;
}</code></pre>
<h3 id="api-endpoints-4">19.5 API Endpoints</h3>
<p><strong>Handler</strong>: <code>lambda/auth/mfa.handler.ts</code></p>
<table>
<colgroup>
<col style="width: 37%" />
<col style="width: 29%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr>
<th>Endpoint</th>
<th>Method</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>/api/v2/mfa/status</code></td>
<td>GET</td>
<td>MFA status, backup codes remaining, trusted devices</td>
</tr>
<tr>
<td><code>/api/v2/mfa/check</code></td>
<td>GET</td>
<td>Check if MFA required for role</td>
</tr>
<tr>
<td><code>/api/v2/mfa/enroll/start</code></td>
<td>POST</td>
<td>Generate TOTP secret and QR URI</td>
</tr>
<tr>
<td><code>/api/v2/mfa/enroll/verify</code></td>
<td>POST</td>
<td>Verify code, generate backup codes, enable MFA</td>
</tr>
<tr>
<td><code>/api/v2/mfa/verify</code></td>
<td>POST</td>
<td>Verify TOTP or backup code during login</td>
</tr>
<tr>
<td><code>/api/v2/mfa/backup-codes/regenerate</code></td>
<td>POST</td>
<td>Invalidate old codes, generate new</td>
</tr>
<tr>
<td><code>/api/v2/mfa/devices</code></td>
<td>GET</td>
<td>List trusted devices</td>
</tr>
<tr>
<td><code>/api/v2/mfa/devices/:id</code></td>
<td>DELETE</td>
<td>Revoke trusted device</td>
</tr>
</tbody>
</table>
<h3 id="ui-components">19.6 UI Components</h3>
<p><strong>Location</strong>: <code>apps/admin-dashboard/components/mfa/</code></p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>MFAEnrollmentGate</code></td>
<td>Full-screen forced enrollment (cannot dismiss)</td>
</tr>
<tr>
<td><code>MFAVerificationPrompt</code></td>
<td>TOTP/backup code entry modal</td>
</tr>
<tr>
<td><code>MFASettingsSection</code></td>
<td>Settings panel for MFA management</td>
</tr>
</tbody>
</table>
<h3 id="security-measures">19.7 Security Measures</h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Implementation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Secret Encryption</strong></td>
<td>AES-256-GCM with scrypt-derived key</td>
</tr>
<tr>
<td><strong>Code Hashing</strong></td>
<td>SHA-256 for backup codes and device tokens</td>
</tr>
<tr>
<td><strong>Clock Drift</strong></td>
<td>Â±30 second tolerance (window=1)</td>
</tr>
<tr>
<td><strong>Lockout</strong></td>
<td>3 failures â†’ 5 minute lockout</td>
</tr>
<tr>
<td><strong>Device Trust</strong></td>
<td>30-day tokens, max 5 per user</td>
</tr>
<tr>
<td><strong>Audit Logging</strong></td>
<td>All MFA events logged with IP/User-Agent</td>
</tr>
</tbody>
</table>
<h3 id="role-enforcement">19.8 Role Enforcement</h3>
<pre class="typescript"><code>const MFA_REQUIRED_ROLES = [
  &#39;tenant_admin&#39;,
  &#39;tenant_owner&#39;,
  &#39;super_admin&#39;,
  &#39;admin&#39;,
  &#39;operator&#39;,
  &#39;auditor&#39;,
];

// These roles CANNOT:
// - Bypass MFA enrollment
// - Disable MFA once enrolled
// - Access dashboard without MFA verification</code></pre>
<hr />
<h2 id="internationalization-multi-language-search-v5.52.29">20. Internationalization &amp; Multi-Language Search (v5.52.29)</h2>
<h3 id="overview-11">20.1 Overview</h3>
<p>RADIANT supports <strong>18 languages</strong> with full authentication UI localization and <strong>CJK-aware full-text search</strong> using PostgreSQLâ€™s native FTS for Western languages and <code>pg_bigm</code> bi-gram indexing for Chinese, Japanese, and Korean.</p>
<h3 id="supported-languages">20.2 Supported Languages</h3>
<table>
<thead>
<tr>
<th>Language</th>
<th>Code</th>
<th>Direction</th>
<th>FTS Strategy</th>
<th>PostgreSQL Config</th>
</tr>
</thead>
<tbody>
<tr>
<td>English</td>
<td><code>en</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>english</code></td>
</tr>
<tr>
<td>Spanish</td>
<td><code>es</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>spanish</code></td>
</tr>
<tr>
<td>French</td>
<td><code>fr</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>french</code></td>
</tr>
<tr>
<td>German</td>
<td><code>de</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>german</code></td>
</tr>
<tr>
<td>Portuguese</td>
<td><code>pt</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>portuguese</code></td>
</tr>
<tr>
<td>Italian</td>
<td><code>it</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>italian</code></td>
</tr>
<tr>
<td>Dutch</td>
<td><code>nl</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>dutch</code></td>
</tr>
<tr>
<td>Polish</td>
<td><code>pl</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>simple</code></td>
</tr>
<tr>
<td>Russian</td>
<td><code>ru</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>russian</code></td>
</tr>
<tr>
<td>Turkish</td>
<td><code>tr</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>turkish</code></td>
</tr>
<tr>
<td>Japanese</td>
<td><code>ja</code></td>
<td>LTR</td>
<td><strong>pg_bigm</strong></td>
<td>bi-gram</td>
</tr>
<tr>
<td>Korean</td>
<td><code>ko</code></td>
<td>LTR</td>
<td><strong>pg_bigm</strong></td>
<td>bi-gram</td>
</tr>
<tr>
<td>Chinese (Simplified)</td>
<td><code>zh-CN</code></td>
<td>LTR</td>
<td><strong>pg_bigm</strong></td>
<td>bi-gram</td>
</tr>
<tr>
<td>Chinese (Traditional)</td>
<td><code>zh-TW</code></td>
<td>LTR</td>
<td><strong>pg_bigm</strong></td>
<td>bi-gram</td>
</tr>
<tr>
<td><strong>Arabic</strong></td>
<td><code>ar</code></td>
<td><strong>RTL</strong></td>
<td>Native FTS</td>
<td><code>simple</code></td>
</tr>
<tr>
<td>Hindi</td>
<td><code>hi</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>simple</code></td>
</tr>
<tr>
<td>Thai</td>
<td><code>th</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>simple</code></td>
</tr>
<tr>
<td>Vietnamese</td>
<td><code>vi</code></td>
<td>LTR</td>
<td>Native FTS</td>
<td><code>simple</code></td>
</tr>
</tbody>
</table>
<h3 id="cjk-search-architecture">20.3 CJK Search Architecture</h3>
<p>CJK languages (Chinese, Japanese, Korean) lack word boundaries, making traditional stemming-based FTS ineffective. RADIANT uses <strong>pg_bigm</strong> for bi-gram indexing:</p>
<pre class="sql"><code>-- Enable pg_bigm extension
CREATE EXTENSION IF NOT EXISTS pg_bigm;

-- Create bi-gram indexes on searchable content
CREATE INDEX idx_conversations_bigm_title 
  ON uds_conversations USING gin (title gin_bigm_ops);
CREATE INDEX idx_conversations_bigm_content 
  ON uds_conversations USING gin (content gin_bigm_ops);

-- CJK search uses LIKE with bi-gram optimization
SELECT * FROM uds_conversations 
WHERE content LIKE &#39;%æ¤œç´¢ã‚¯ã‚¨ãƒª%&#39;  -- Japanese query
  AND tenant_id = app.current_tenant_id;</code></pre>
<p><strong>Why pg_bigm over pg_trgm?</strong> - <code>pg_trgm</code> uses 3-character grams, ineffective for 2-character CJK words - <code>pg_bigm</code> uses 2-character grams, optimal for CJK morphology - 40-60% faster CJK search vs trigram approach</p>
<h3 id="language-detection">20.4 Language Detection</h3>
<p><strong>Database Function</strong>: <code>detect_text_language(text)</code></p>
<pre class="sql"><code>CREATE OR REPLACE FUNCTION detect_text_language(content TEXT)
RETURNS VARCHAR(10) AS $$
DECLARE
  cjk_chars INTEGER;
  arabic_chars INTEGER;
  cyrillic_chars INTEGER;
  total_chars INTEGER;
BEGIN
  total_chars := length(content);
  IF total_chars = 0 THEN RETURN &#39;en&#39;; END IF;
  
  -- Count character ranges
  cjk_chars := length(regexp_replace(content, &#39;[^\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff\uac00-\ud7af]&#39;, &#39;&#39;, &#39;g&#39;));
  arabic_chars := length(regexp_replace(content, &#39;[^\u0600-\u06ff]&#39;, &#39;&#39;, &#39;g&#39;));
  cyrillic_chars := length(regexp_replace(content, &#39;[^\u0400-\u04ff]&#39;, &#39;&#39;, &#39;g&#39;));
  
  -- Threshold-based detection (&gt;10% of content)
  IF cjk_chars::float / total_chars &gt; 0.1 THEN
    -- Distinguish CJK languages by unique characters
    IF content ~ &#39;[\u3040-\u309f\u30a0-\u30ff]&#39; THEN RETURN &#39;ja&#39;; END IF;
    IF content ~ &#39;[\uac00-\ud7af]&#39; THEN RETURN &#39;ko&#39;; END IF;
    RETURN &#39;zh-CN&#39;;
  END IF;
  
  IF arabic_chars::float / total_chars &gt; 0.1 THEN RETURN &#39;ar&#39;; END IF;
  IF cyrillic_chars::float / total_chars &gt; 0.1 THEN RETURN &#39;ru&#39;; END IF;
  
  RETURN &#39;en&#39;;  -- Default
END;
$$ LANGUAGE plpgsql IMMUTABLE;</code></pre>
<p><strong>JavaScript Service</strong>: <code>MultiLanguageSearchService.detectLanguage()</code></p>
<pre class="typescript"><code>private detectLanguage(text: string): string {
  const cjkPattern = /[\u4e00-\u9fff\u3040-\u309f\u30a0-\u30ff\uac00-\ud7af]/;
  const japanesePattern = /[\u3040-\u309f\u30a0-\u30ff]/;
  const koreanPattern = /[\uac00-\ud7af]/;
  const arabicPattern = /[\u0600-\u06ff]/;
  
  if (cjkPattern.test(text)) {
    if (japanesePattern.test(text)) return &#39;ja&#39;;
    if (koreanPattern.test(text)) return &#39;ko&#39;;
    return &#39;zh-CN&#39;;
  }
  if (arabicPattern.test(text)) return &#39;ar&#39;;
  return &#39;en&#39;;
}</code></pre>
<h3 id="unified-search-function">20.5 Unified Search Function</h3>
<p><strong>Database Function</strong>: <code>search_content(query, table_name, tenant_id, limit)</code></p>
<p>Routes queries to appropriate search method based on detected language:</p>
<pre class="sql"><code>CREATE OR REPLACE FUNCTION search_content(
  query TEXT,
  target_table TEXT,
  p_tenant_id UUID,
  p_limit INTEGER DEFAULT 50
) RETURNS TABLE (
  id UUID,
  title TEXT,
  content TEXT,
  relevance FLOAT,
  highlight TEXT
) AS $$
DECLARE
  detected_lang VARCHAR(10);
  is_cjk BOOLEAN;
BEGIN
  detected_lang := detect_text_language(query);
  is_cjk := detected_lang IN (&#39;ja&#39;, &#39;ko&#39;, &#39;zh-CN&#39;, &#39;zh-TW&#39;);
  
  IF is_cjk THEN
    -- Use pg_bigm LIKE search
    RETURN QUERY EXECUTE format(
      &#39;SELECT id, title, content, 
              bigm_similarity(content, $1) as relevance,
              ts_headline(&#39;&#39;simple&#39;&#39;, content, plainto_tsquery(&#39;&#39;simple&#39;&#39;, $1)) as highlight
       FROM %I 
       WHERE tenant_id = $2 AND content LIKE &#39;&#39;%%&#39;&#39; || $1 || &#39;&#39;%%&#39;&#39;
       ORDER BY relevance DESC LIMIT $3&#39;,
      target_table
    ) USING query, p_tenant_id, p_limit;
  ELSE
    -- Use PostgreSQL native FTS
    RETURN QUERY EXECUTE format(
      &#39;SELECT id, title, content,
              ts_rank(search_vector_english, websearch_to_tsquery(&#39;&#39;english&#39;&#39;, $1)) as relevance,
              ts_headline(&#39;&#39;english&#39;&#39;, content, websearch_to_tsquery(&#39;&#39;english&#39;&#39;, $1)) as highlight
       FROM %I
       WHERE tenant_id = $2 AND search_vector_english @@ websearch_to_tsquery(&#39;&#39;english&#39;&#39;, $1)
       ORDER BY relevance DESC LIMIT $3&#39;,
      target_table
    ) USING query, p_tenant_id, p_limit;
  END IF;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;</code></pre>
<h3 id="database-migration-071_multilang_search.sql">20.6 Database Migration (071_multilang_search.sql)</h3>
<p><strong>New Columns</strong>:</p>
<table>
<colgroup>
<col style="width: 23%" />
<col style="width: 26%" />
<col style="width: 20%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr>
<th>Table</th>
<th>Column</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>uds_conversations</code></td>
<td><code>detected_language</code></td>
<td>VARCHAR(10)</td>
<td>Auto-detected content language</td>
</tr>
<tr>
<td><code>uds_conversations</code></td>
<td><code>search_vector_simple</code></td>
<td>TSVECTOR</td>
<td>Fallback search vector</td>
</tr>
<tr>
<td><code>uds_conversations</code></td>
<td><code>search_vector_english</code></td>
<td>TSVECTOR</td>
<td>Language-specific search vector</td>
</tr>
<tr>
<td><code>uds_uploads</code></td>
<td><code>detected_language</code></td>
<td>VARCHAR(10)</td>
<td>Auto-detected content language</td>
</tr>
<tr>
<td><code>cortex_entities</code></td>
<td><code>detected_language</code></td>
<td>VARCHAR(10)</td>
<td>Auto-detected content language</td>
</tr>
<tr>
<td><code>cortex_chunks</code></td>
<td><code>detected_language</code></td>
<td>VARCHAR(10)</td>
<td>Auto-detected content language</td>
</tr>
</tbody>
</table>
<p><strong>New Indexes</strong>:</p>
<table>
<colgroup>
<col style="width: 24%" />
<col style="width: 24%" />
<col style="width: 20%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr>
<th>Index</th>
<th>Table</th>
<th>Type</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>idx_conversations_bigm_title</code></td>
<td><code>uds_conversations</code></td>
<td>GIN (gin_bigm_ops)</td>
<td>CJK title search</td>
</tr>
<tr>
<td><code>idx_conversations_bigm_content</code></td>
<td><code>uds_conversations</code></td>
<td>GIN (gin_bigm_ops)</td>
<td>CJK content search</td>
</tr>
<tr>
<td><code>idx_uploads_bigm_content</code></td>
<td><code>uds_uploads</code></td>
<td>GIN (gin_bigm_ops)</td>
<td>CJK upload search</td>
</tr>
<tr>
<td><code>idx_cortex_entities_bigm</code></td>
<td><code>cortex_entities</code></td>
<td>GIN (gin_bigm_ops)</td>
<td>CJK entity search</td>
</tr>
<tr>
<td><code>idx_cortex_chunks_bigm</code></td>
<td><code>cortex_chunks</code></td>
<td>GIN (gin_bigm_ops)</td>
<td>CJK chunk search</td>
</tr>
<tr>
<td><code>idx_conversations_fts_english</code></td>
<td><code>uds_conversations</code></td>
<td>GIN</td>
<td>English FTS</td>
</tr>
<tr>
<td><code>idx_conversations_fts_simple</code></td>
<td><code>uds_conversations</code></td>
<td>GIN</td>
<td>Simple FTS</td>
</tr>
</tbody>
</table>
<p><strong>Trigger</strong>: Auto-detect language on INSERT/UPDATE</p>
<pre class="sql"><code>CREATE TRIGGER trg_detect_language_conversations
  BEFORE INSERT OR UPDATE OF content ON uds_conversations
  FOR EACH ROW
  EXECUTE FUNCTION update_detected_language();</code></pre>
<h3 id="multi-language-search-service">20.7 Multi-Language Search Service</h3>
<p><strong>Implementation</strong>: <code>lambda/shared/services/search/multilang-search.service.ts</code></p>
<pre class="typescript"><code>export interface SearchResult {
  id: string;
  title: string;
  content: string;
  relevance: number;
  highlight: string;
  detectedLanguage: string;
}

export interface SearchOptions {
  table: &#39;uds_conversations&#39; | &#39;uds_uploads&#39; | &#39;cortex_entities&#39; | &#39;cortex_chunks&#39;;
  tenantId: string;
  limit?: number;
  offset?: number;
  languageHint?: string;
}

export class MultiLanguageSearchService {
  private readonly CJK_LANGUAGES = [&#39;ja&#39;, &#39;ko&#39;, &#39;zh-CN&#39;, &#39;zh-TW&#39;];
  private readonly FTS_CONFIGS: Record&lt;string, string&gt; = {
    en: &#39;english&#39;, es: &#39;spanish&#39;, fr: &#39;french&#39;, de: &#39;german&#39;,
    pt: &#39;portuguese&#39;, it: &#39;italian&#39;, nl: &#39;dutch&#39;, ru: &#39;russian&#39;,
    tr: &#39;turkish&#39;, pl: &#39;simple&#39;, ar: &#39;simple&#39;, hi: &#39;simple&#39;,
    th: &#39;simple&#39;, vi: &#39;simple&#39;
  };

  async search(query: string, options: SearchOptions): Promise&lt;SearchResult[]&gt; {
    const language = options.languageHint || this.detectLanguage(query);
    
    if (this.CJK_LANGUAGES.includes(language)) {
      return this.searchBigram(query, options);
    }
    return this.searchFTS(query, options, this.FTS_CONFIGS[language] || &#39;simple&#39;);
  }

  private async searchBigram(query: string, options: SearchOptions): Promise&lt;SearchResult[]&gt;;
  private async searchFTS(query: string, options: SearchOptions, config: string): Promise&lt;SearchResult[]&gt;;
  private detectLanguage(text: string): string;
}</code></pre>
<h3 id="rtl-support-architecture">20.8 RTL Support Architecture</h3>
<p><strong>Hook</strong>: <code>apps/admin-dashboard/hooks/useRTL.ts</code></p>
<pre class="typescript"><code>export function useRTL() {
  const { currentLanguage, isRTL } = useTranslation();
  
  return {
    dir: isRTL ? &#39;rtl&#39; : &#39;ltr&#39;,
    isRTL,
    // Utility for flipping CSS classes
    flip: (ltrClass: string, rtlClass: string) =&gt; isRTL ? rtlClass : ltrClass,
    // Margin/padding helpers
    marginStart: (value: string) =&gt; isRTL ? `mr-${value}` : `ml-${value}`,
    marginEnd: (value: string) =&gt; isRTL ? `ml-${value}` : `mr-${value}`,
    paddingStart: (value: string) =&gt; isRTL ? `pr-${value}` : `pl-${value}`,
    paddingEnd: (value: string) =&gt; isRTL ? `pl-${value}` : `pr-${value}`,
    // Text alignment
    textStart: isRTL ? &#39;text-right&#39; : &#39;text-left&#39;,
    textEnd: isRTL ? &#39;text-left&#39; : &#39;text-right&#39;,
    // Flex direction
    flexRow: isRTL ? &#39;flex-row-reverse&#39; : &#39;flex-row&#39;,
    // Icon rotation for directional icons
    iconFlip: isRTL ? &#39;scale-x-[-1]&#39; : &#39;&#39;,
  };
}</code></pre>
<p><strong>CSS Utilities</strong>: <code>apps/admin-dashboard/styles/rtl.css</code></p>
<pre class="css"><code>/* RTL automatic flipping */
[dir=&quot;rtl&quot;] .ml-2 { margin-left: 0; margin-right: 0.5rem; }
[dir=&quot;rtl&quot;] .mr-2 { margin-right: 0; margin-left: 0.5rem; }
[dir=&quot;rtl&quot;] .pl-4 { padding-left: 0; padding-right: 1rem; }
[dir=&quot;rtl&quot;] .pr-4 { padding-right: 0; padding-left: 1rem; }
[dir=&quot;rtl&quot;] .text-left { text-align: right; }
[dir=&quot;rtl&quot;] .text-right { text-align: left; }

/* Preserve LTR for specific content */
.preserve-ltr { direction: ltr; unicode-bidi: isolate; }
[dir=&quot;rtl&quot;] input[type=&quot;email&quot;],
[dir=&quot;rtl&quot;] input[type=&quot;password&quot;],
[dir=&quot;rtl&quot;] .font-mono { direction: ltr; text-align: left; }</code></pre>
<h3 id="translation-files">20.9 Translation Files</h3>
<p><strong>Location</strong>: <code>apps/admin-dashboard/locales/auth/</code></p>
<table>
<thead>
<tr>
<th>File</th>
<th>Language</th>
<th>Keys</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>en.json</code></td>
<td>English</td>
<td>~230</td>
</tr>
<tr>
<td><code>zh-CN.json</code></td>
<td>Chinese (Simplified)</td>
<td>~230</td>
</tr>
<tr>
<td><code>ja.json</code></td>
<td>Japanese</td>
<td>~230</td>
</tr>
<tr>
<td><code>ko.json</code></td>
<td>Korean</td>
<td>~230</td>
</tr>
<tr>
<td><code>ar.json</code></td>
<td>Arabic (RTL)</td>
<td>~230</td>
</tr>
</tbody>
</table>
<p><strong>Key Categories</strong>:</p>
<table>
<thead>
<tr>
<th>Namespace</th>
<th>Keys</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>login.*</code></td>
<td>25</td>
<td>Login form, errors, social auth</td>
</tr>
<tr>
<td><code>mfa.*</code></td>
<td>45</td>
<td>Enrollment, verification, backup codes</td>
</tr>
<tr>
<td><code>oauth.*</code></td>
<td>35</td>
<td>Consent screen, scopes, connected apps</td>
</tr>
<tr>
<td><code>password.*</code></td>
<td>30</td>
<td>Reset flow, validation, success</td>
</tr>
<tr>
<td><code>errors.*</code></td>
<td>40</td>
<td>Error messages, validation</td>
</tr>
<tr>
<td><code>common.*</code></td>
<td>55</td>
<td>Buttons, labels, shared text</td>
</tr>
</tbody>
</table>
<h3 id="component-integration">20.10 Component Integration</h3>
<p><strong>Usage Pattern</strong>:</p>
<pre class="typescript"><code>import { useTranslation } from &#39;@/hooks/useTranslation&#39;;
import { useRTL } from &#39;@/hooks/useRTL&#39;;

export function MFAEnrollmentGate() {
  const { t } = useTranslation(&#39;auth&#39;);
  const { dir, isRTL, marginStart } = useRTL();

  return (
    &lt;div dir={dir} className=&quot;...&quot;&gt;
      &lt;h1&gt;{t(&#39;mfa.enrollment.title&#39;)}&lt;/h1&gt;
      &lt;Button className={`flex ${isRTL ? &#39;flex-row-reverse&#39; : &#39;flex-row&#39;}`}&gt;
        &lt;Loader2 className={marginStart(&#39;2&#39;)} /&gt;
        {t(&#39;mfa.enrollment.get_started&#39;)}
      &lt;/Button&gt;
      {/* Preserve LTR for codes */}
      &lt;code className=&quot;preserve-ltr&quot; dir=&quot;ltr&quot;&gt;{secretCode}&lt;/code&gt;
    &lt;/div&gt;
  );
}</code></pre>
<h3 id="performance-considerations-1">20.11 Performance Considerations</h3>
<table>
<thead>
<tr>
<th>Optimization</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Bi-gram indexes</strong></td>
<td>10-50x faster CJK LIKE queries</td>
</tr>
<tr>
<td><strong>Materialized tsvectors</strong></td>
<td>Avoid re-parsing on every search</td>
</tr>
<tr>
<td><strong>Language detection caching</strong></td>
<td>Detect once on insert, reuse</td>
</tr>
<tr>
<td><strong>Index-only scans</strong></td>
<td>GIN indexes support covering queries</td>
</tr>
<tr>
<td><strong>Parallel query</strong></td>
<td>PostgreSQL parallelizes large FTS scans</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="appendix-a-adding-new-documentation">Appendix A: Adding New Documentation</h2>
<p>When implementing new features, add documentation to the appropriate section:</p>
<ol type="1">
<li><strong>Architecture decisions</strong> â†’ Relevant section above</li>
<li><strong>New AWS services</strong> â†’ Section 2</li>
<li><strong>Database changes</strong> â†’ Section 3</li>
<li><strong>New AI capabilities</strong> â†’ Section 4</li>
<li><strong>Lambda handlers</strong> â†’ Section 5</li>
<li><strong>CDK changes</strong> â†’ Section 6</li>
<li><strong>Security features</strong> â†’ Section 7</li>
<li><strong>New dependencies</strong> â†’ Section 8</li>
<li><strong>API specifications</strong> â†’ Section 10.1</li>
<li><strong>Performance guides</strong> â†’ Section 10.2</li>
<li><strong>Security documentation</strong> â†’ Section 10.3</li>
<li><strong>Admin API handlers</strong> â†’ Section 16</li>
</ol>
<p>See <code>/.windsurf/workflows/documentation-consolidation.md</code> for the enforcement policy.</p>

  
  <div class="footer">
    RADIANT Documentation | Version 5.52.29 | Generated January 25, 2026
  </div>
</body>
</html>