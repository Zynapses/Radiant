<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SECTION 25 FOCUS MODES PERSONAS - RADIANT Documentation</title>
  
<style>
@media print {
  body { font-size: 11pt !important; }
  pre { page-break-inside: avoid; }
  h1, h2, h3 { page-break-after: avoid; }
  .no-print { display: none !important; }
}

* { box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  line-height: 1.7;
  color: #1d1d1f;
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 30px;
  background: white;
}

h1 {
  color: #1d1d1f;
  border-bottom: 3px solid #0071e3;
  padding-bottom: 12px;
  font-size: 28px;
  margin-top: 0;
}

h2 {
  color: #1d1d1f;
  border-bottom: 1px solid #d2d2d7;
  padding-bottom: 8px;
  font-size: 22px;
  margin-top: 40px;
}

h3 { color: #1d1d1f; font-size: 18px; margin-top: 30px; }
h4 { color: #1d1d1f; font-size: 16px; margin-top: 25px; }

a { color: #0071e3; text-decoration: none; }
a:hover { text-decoration: underline; }

code {
  background: #f5f5f7;
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
  font-size: 0.9em;
  color: #1d1d1f;
}

pre {
  background: #1d1d1f;
  color: #f5f5f7;
  padding: 20px;
  border-radius: 10px;
  overflow-x: auto;
  font-size: 13px;
  line-height: 1.5;
}

pre code {
  background: transparent;
  padding: 0;
  color: inherit;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
  font-size: 14px;
}

th, td {
  border: 1px solid #d2d2d7;
  padding: 12px 15px;
  text-align: left;
}

th {
  background: #0071e3;
  color: white;
  font-weight: 600;
}

tr:nth-child(even) { background: #f5f5f7; }

blockquote {
  border-left: 4px solid #0071e3;
  margin: 20px 0;
  padding: 15px 25px;
  background: #f5f5f7;
  border-radius: 0 8px 8px 0;
}

blockquote p { margin: 0; }

img { max-width: 100%; height: auto; border-radius: 8px; }

hr {
  border: none;
  border-top: 1px solid #d2d2d7;
  margin: 40px 0;
}

ul, ol { padding-left: 25px; }
li { margin: 8px 0; }

.header-bar {
  background: linear-gradient(135deg, #0071e3 0%, #00c6ff 100%);
  color: white;
  padding: 20px 30px;
  margin: -40px -30px 30px -30px;
  border-radius: 0 0 16px 16px;
}

.header-bar h1 {
  color: white;
  border: none;
  margin: 0;
  padding: 0;
}

.header-bar .meta {
  font-size: 13px;
  opacity: 0.9;
  margin-top: 8px;
}

.print-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #0071e3;
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 4px 12px rgba(0,113,227,0.3);
}

.print-btn:hover { background: #0077ed; }

.mermaid {
  background: #f5f5f7;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  margin: 20px 0;
}

.footer {
  margin-top: 60px;
  padding-top: 20px;
  border-top: 1px solid #d2d2d7;
  color: #86868b;
  font-size: 12px;
  text-align: center;
}
</style>

</head>
<body>
  <button class="print-btn no-print" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
  
  <div class="header-bar">
    <h1>SECTION 25 FOCUS MODES PERSONAS</h1>
    <div class="meta">RADIANT v5.52.29 | docs/sections/SECTION-25-FOCUS-MODES-PERSONAS.md</div>
  </div>
  
  <h1 id="section-25-focus-modes-custom-personas-v3.6.0">SECTION 25: FOCUS MODES &amp; CUSTOM PERSONAS (v3.6.0)</h1>
<h1 id="section">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</h1>
<h2 id="focus-modes-overview">25.1 Focus Modes Overview</h2>
<p>Pre-configured AI behavior profiles and custom persona creation.</p>
<h2 id="personas-database-schema">25.2 Personas Database Schema</h2>
<pre class="sql"><code>-- migrations/034_focus_personas.sql

CREATE TABLE focus_modes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID REFERENCES tenants(id),
    mode_name VARCHAR(100) NOT NULL,
    display_name VARCHAR(200) NOT NULL,
    description TEXT,
    icon VARCHAR(50),
    system_prompt TEXT NOT NULL,
    default_model VARCHAR(100),
    settings JSONB DEFAULT &#39;{}&#39;,
    is_system BOOLEAN DEFAULT false,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE user_personas (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL REFERENCES tenants(id),
    user_id UUID NOT NULL REFERENCES users(id),
    persona_name VARCHAR(100) NOT NULL,
    display_name VARCHAR(200),
    avatar_url VARCHAR(500),
    system_prompt TEXT NOT NULL,
    voice_id VARCHAR(100),
    personality_traits JSONB DEFAULT &#39;[]&#39;,
    knowledge_domains JSONB DEFAULT &#39;[]&#39;,
    conversation_style JSONB DEFAULT &#39;{}&#39;,
    is_public BOOLEAN DEFAULT false,
    usage_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE persona_usage_log (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    persona_id UUID NOT NULL REFERENCES user_personas(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id),
    chat_id UUID REFERENCES chats(id),
    tokens_used INTEGER,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_focus_modes_tenant ON focus_modes(tenant_id) WHERE tenant_id IS NOT NULL;
CREATE INDEX idx_user_personas_user ON user_personas(tenant_id, user_id);
CREATE INDEX idx_persona_usage ON persona_usage_log(persona_id, created_at DESC);

ALTER TABLE focus_modes ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_personas ENABLE ROW LEVEL SECURITY;
ALTER TABLE persona_usage_log ENABLE ROW LEVEL SECURITY;

-- System modes visible to all, tenant modes to tenant only
CREATE POLICY focus_modes_policy ON focus_modes USING (
    is_system = true OR tenant_id IS NULL OR tenant_id = current_setting(&#39;app.current_tenant_id&#39;)::UUID
);
CREATE POLICY user_personas_isolation ON user_personas USING (
    tenant_id = current_setting(&#39;app.current_tenant_id&#39;)::UUID AND 
    (user_id = current_setting(&#39;app.user_id&#39;)::UUID OR is_public = true)
);
CREATE POLICY persona_usage_isolation ON persona_usage_log USING (
    persona_id IN (SELECT id FROM user_personas WHERE tenant_id = current_setting(&#39;app.current_tenant_id&#39;)::UUID)
);

-- Insert default focus modes
INSERT INTO focus_modes (mode_name, display_name, description, icon, system_prompt, is_system) VALUES
(&#39;general&#39;, &#39;General Assistant&#39;, &#39;Versatile AI for any task&#39;, &#39;MessageSquare&#39;, &#39;You are a helpful, harmless, and honest AI assistant.&#39;, true),
(&#39;code&#39;, &#39;Code Expert&#39;, &#39;Programming and development focus&#39;, &#39;Code&#39;, &#39;You are an expert software developer. Focus on clean, efficient, well-documented code. Explain your reasoning and suggest best practices.&#39;, true),
(&#39;writer&#39;, &#39;Creative Writer&#39;, &#39;Creative writing and content creation&#39;, &#39;PenTool&#39;, &#39;You are a creative writing assistant. Help with storytelling, content creation, and writing improvement. Be imaginative and expressive.&#39;, true),
(&#39;analyst&#39;, &#39;Data Analyst&#39;, &#39;Data analysis and insights&#39;, &#39;BarChart&#39;, &#39;You are a data analyst. Focus on extracting insights, identifying patterns, and presenting findings clearly. Be precise and methodical.&#39;, true),
(&#39;researcher&#39;, &#39;Research Assistant&#39;, &#39;Deep research and fact-finding&#39;, &#39;Search&#39;, &#39;You are a research assistant. Provide thorough, well-sourced information. Verify facts and present balanced perspectives.&#39;, true);</code></pre>
<h2 id="persona-service">25.3 Persona Service</h2>
<pre class="typescript"><code>// packages/core/src/services/persona-service.ts

import { Pool } from &#39;pg&#39;;

interface PersonaCreate {
    name: string;
    displayName?: string;
    systemPrompt: string;
    avatarUrl?: string;
    voiceId?: string;
    traits?: string[];
    domains?: string[];
    style?: Record&lt;string, any&gt;;
    isPublic?: boolean;
}

export class PersonaService {
    private pool: Pool;
    
    constructor(pool: Pool) {
        this.pool = pool;
    }
    
    async getFocusModes(tenantId?: string): Promise&lt;any[]&gt; {
        const result = await this.pool.query(`
            SELECT * FROM focus_modes
            WHERE is_active = true AND (is_system = true OR tenant_id IS NULL OR tenant_id = $1)
            ORDER BY is_system DESC, mode_name
        `, [tenantId]);
        
        return result.rows;
    }
    
    async createPersona(tenantId: string, userId: string, persona: PersonaCreate): Promise&lt;string&gt; {
        const result = await this.pool.query(`
            INSERT INTO user_personas (
                tenant_id, user_id, persona_name, display_name, system_prompt,
                avatar_url, voice_id, personality_traits, knowledge_domains,
                conversation_style, is_public
            )
            VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
            RETURNING id
        `, [
            tenantId,
            userId,
            persona.name,
            persona.displayName,
            persona.systemPrompt,
            persona.avatarUrl,
            persona.voiceId,
            JSON.stringify(persona.traits || []),
            JSON.stringify(persona.domains || []),
            JSON.stringify(persona.style || {}),
            persona.isPublic || false
        ]);
        
        return result.rows[0].id;
    }
    
    async getUserPersonas(tenantId: string, userId: string): Promise&lt;any[]&gt; {
        const result = await this.pool.query(`
            SELECT * FROM user_personas
            WHERE tenant_id = $1 AND (user_id = $2 OR is_public = true)
            ORDER BY usage_count DESC
        `, [tenantId, userId]);
        
        return result.rows;
    }
    
    async getPersona(personaId: string): Promise&lt;any&gt; {
        const result = await this.pool.query(`SELECT * FROM user_personas WHERE id = $1`, [personaId]);
        return result.rows[0];
    }
    
    async updatePersona(personaId: string, updates: Partial&lt;PersonaCreate&gt;): Promise&lt;void&gt; {
        const fields: string[] = [];
        const values: any[] = [personaId];
        let paramIndex = 2;
        
        if (updates.name) { fields.push(`persona_name = $${paramIndex++}`); values.push(updates.name); }
        if (updates.displayName) { fields.push(`display_name = $${paramIndex++}`); values.push(updates.displayName); }
        if (updates.systemPrompt) { fields.push(`system_prompt = $${paramIndex++}`); values.push(updates.systemPrompt); }
        if (updates.avatarUrl) { fields.push(`avatar_url = $${paramIndex++}`); values.push(updates.avatarUrl); }
        if (updates.voiceId) { fields.push(`voice_id = $${paramIndex++}`); values.push(updates.voiceId); }
        if (updates.traits) { fields.push(`personality_traits = $${paramIndex++}`); values.push(JSON.stringify(updates.traits)); }
        if (updates.domains) { fields.push(`knowledge_domains = $${paramIndex++}`); values.push(JSON.stringify(updates.domains)); }
        if (updates.style) { fields.push(`conversation_style = $${paramIndex++}`); values.push(JSON.stringify(updates.style)); }
        if (typeof updates.isPublic === &#39;boolean&#39;) { fields.push(`is_public = $${paramIndex++}`); values.push(updates.isPublic); }
        
        fields.push(&#39;updated_at = NOW()&#39;);
        
        await this.pool.query(`UPDATE user_personas SET ${fields.join(&#39;, &#39;)} WHERE id = $1`, values);
    }
    
    async logUsage(personaId: string, userId: string, chatId?: string, tokensUsed?: number): Promise&lt;void&gt; {
        await this.pool.query(`
            INSERT INTO persona_usage_log (persona_id, user_id, chat_id, tokens_used)
            VALUES ($1, $2, $3, $4)
        `, [personaId, userId, chatId, tokensUsed]);
        
        await this.pool.query(`
            UPDATE user_personas SET usage_count = usage_count + 1 WHERE id = $1
        `, [personaId]);
    }
    
    async buildPrompt(personaId: string, userMessage: string): Promise&lt;string&gt; {
        const persona = await this.getPersona(personaId);
        if (!persona) throw new Error(&#39;Persona not found&#39;);
        
        const traits = persona.personality_traits as string[];
        const domains = persona.knowledge_domains as string[];
        
        let prompt = persona.system_prompt;
        
        if (traits.length &gt; 0) {
            prompt += `\n\nPersonality traits: ${traits.join(&#39;, &#39;)}.`;
        }
        
        if (domains.length &gt; 0) {
            prompt += `\n\nAreas of expertise: ${domains.join(&#39;, &#39;)}.`;
        }
        
        return prompt;
    }
}</code></pre>
<h1 id="section-1">‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê</h1>

  
  <div class="footer">
    RADIANT Documentation | Version 5.52.29 | Generated January 25, 2026
  </div>
</body>
</html>